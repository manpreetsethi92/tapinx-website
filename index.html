<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TapinX - Text to Get Connected in Sec</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colors */
            --color-primary: #E50914;
            --color-primary-hover: #c50812;
            --color-text-primary: #0f1419;
            --color-text-secondary: #536471;
            --color-text-muted: #888;
            --color-background: #ffffff;
            --color-background-secondary: #f7f9f9;
            --color-border: #eff3f4;
            --color-success: #00ba7c;
            --color-success-bg: #e8f5e9;
            --color-warning: #f57c00;
            --color-warning-bg: #fff3e0;
            
            /* Modal Design System */
            --modal-overlay-bg: rgba(0, 0, 0, 0.4);
            --modal-border-radius: 12px;
            --modal-max-width: 480px;
            --modal-padding: 24px;
            --modal-header-padding: 20px 24px;
            --modal-footer-padding: 16px 24px;
            
            /* Button Design System */
            --btn-border-radius: 9999px;
            --btn-padding: 12px 24px;
            --btn-font-size: 15px;
            --btn-font-weight: 600;
            
            /* Button Colors */
            --btn-primary-bg: #0f1419;
            --btn-primary-color: #ffffff;
            --btn-secondary-bg: #f7f9f9;
            --btn-secondary-color: #0f1419;
            --btn-secondary-border: #eff3f4;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-title: 20px;
            --font-size-body: 15px;
            --font-size-small: 13px;
            --font-size-label: 12px;
            
            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            /* Shadows */
            --shadow-modal: 0 20px 60px rgba(0, 0, 0, 0.15);
            
            /* Status Colors */
            --status-connected-bg: #e8f5e9;
            --status-connected-color: #2e7d32;
            --status-pending-bg: #fff3e0;
            --status-pending-color: #f57c00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fff;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ========== PAGES ========== */
        .page {
            display: none;
            min-height: 100vh;
        }
        
        .page.active {
            display: block;
        }
        
        /* ========== COMMON HEADER ========== */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 48px;
            height: 72px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
        }
        
        .logo {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 28px;
            font-weight: 600;
            color: #E50914;
            text-decoration: none;
            cursor: pointer;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .header-signin {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .header-signin:hover {
            background: #f5f5f5;
        }
        
        /* Page Back Button (below header) */
        .page-back-btn {
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            padding: 0;
            font-family: inherit;
            margin-bottom: 24px;
            transition: color 0.2s;
        }
        
        .page-back-btn:hover {
            color: #000;
        }
        
        /* Avatar & Dropdown */
        .profile-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        
        .profile-btn:hover {
            background: #f5f5f5;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
        }
        
        .avatar span {
            color: #fff;
            font-weight: 600;
            font-size: 16px;
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }
        
        .dropdown-arrow {
            font-size: 10px;
            color: #999;
        }
        
        .dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 200px;
            padding: 8px 0;
            display: none;
            z-index: 1000;
            animation: dropdownIn 0.2s ease;
        }
        
        .dropdown.active {
            display: block;
        }
        
        @keyframes dropdownIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.2s;
            cursor: pointer;
        }
        
        .dropdown-item:hover {
            background: #f5f5f5;
        }
        
        .dropdown-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .dropdown-divider {
            height: 1px;
            background: #eee;
            margin: 8px 0;
        }
        
        /* ========== LANDING PAGE ========== */
        #landingPage .hero {
            min-height: 100vh;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            gap: 48px;
            padding: 72px 48px 0;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .hero-text {
            max-width: 520px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero h1 {
            font-size: 48px;
            font-weight: 600;
            line-height: 1.1;
            letter-spacing: -0.5px;
            margin-bottom: 18px;
            color: #111111;
        }
        
        .hero h1 span {
            color: #E50914;
        }
        
        .hero .subtitle {
            font-size: 16px;
            font-weight: 400;
            color: #555555;
            margin-bottom: 28px;
            line-height: 1.5;
            max-width: 540px;
            white-space: nowrap;
        }
        
        .rotating-word {
            display: inline-block;
            position: relative;
        }
        
        .rotating-word .word {
            display: none;
            text-decoration: underline;
            text-decoration-color: #E50914;
            text-underline-offset: 4px;
            text-decoration-thickness: 2px;
        }
        
        .rotating-word .word.active {
            display: inline;
        }
        
        .cta-button {
            display: inline-flex;
            align-items: center;
            padding: 14px 28px;
            font-size: 15px;
            font-weight: 500;
            background: #E50914;
            color: #FFFFFF;
            border-radius: 999px;
            cursor: pointer;
            transition: opacity 0.2s ease;
            border: none;
            text-decoration: none;
        }
        
        .cta-button:hover {
            opacity: 0.9;
        }
        
        .signin-link {
            margin-top: 24px;
            font-size: 14px;
            color: #888888;
        }
        
        .signin-link a {
            color: #E50914;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        
        .signin-link a:hover {
            text-decoration: underline;
        }
        
        /* Phone Container */
        .hero-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }
        
        .phone-container {
            position: relative;
            overflow: visible;
        }
        
        .phone-frame {
            position: relative;
        }
        
        .phone-frame img.frame {
            max-width: 100%;
            height: auto;
            max-height: 70vh;
            display: block;
        }
        
        /* Message Bubbles */
        .message-bubble {
            position: absolute;
            padding: 10px 14px;
            border-radius: 14px;
            font-size: 13px;
            font-weight: 400;
            max-width: 140px;
            line-height: 1.45;
            opacity: 0;
            z-index: 10;
        }
        
        .bubble-incoming {
            background: #1F2937;
            color: #FFFFFF;
            border-bottom-left-radius: 4px;
        }
        
        .bubble-outgoing {
            background: #F3F4F6;
            color: #111111;
            border-bottom-right-radius: 4px;
        }
        
        /* Bubble Positions - INSIDE phone, proper vertical spacing */
        /* Convo 1: User(right), Taj(left), User(right), Taj(left) */
        .bubble-1 { top: 18%; right: 12%; animation: bubble1 24s ease-in-out infinite; }
        .bubble-2 { top: 30%; left: 12%; animation: bubble2 24s ease-in-out infinite; }
        .bubble-3 { top: 44%; right: 12%; animation: bubble3 24s ease-in-out infinite; }
        .bubble-4 { top: 58%; left: 12%; animation: bubble4 24s ease-in-out infinite; }
        
        /* Convo 2: Taj(left), User(right), Taj(left), User(right) */
        .bubble-5 { top: 18%; left: 12%; animation: bubble1 24s ease-in-out infinite; animation-delay: 8s; }
        .bubble-6 { top: 32%; right: 12%; animation: bubble2 24s ease-in-out infinite; animation-delay: 8s; }
        .bubble-7 { top: 46%; left: 12%; animation: bubble3 24s ease-in-out infinite; animation-delay: 8s; }
        .bubble-8 { top: 60%; right: 12%; animation: bubble4 24s ease-in-out infinite; animation-delay: 8s; }
        
        /* Convo 3: User(right), Taj(left), User(right), Taj(left) */
        .bubble-9 { top: 18%; right: 12%; animation: bubble1 24s ease-in-out infinite; animation-delay: 16s; }
        .bubble-10 { top: 32%; left: 12%; animation: bubble2 24s ease-in-out infinite; animation-delay: 16s; }
        .bubble-11 { top: 46%; right: 12%; animation: bubble3 24s ease-in-out infinite; animation-delay: 16s; }
        .bubble-12 { top: 60%; left: 12%; animation: bubble4 24s ease-in-out infinite; animation-delay: 16s; }
        
        /* 8s per conversation = 33% of 24s cycle, no overlap */
        @keyframes bubble1 {
            0% { opacity: 0; transform: translateY(6px); }
            2% { opacity: 1; transform: translateY(0); }
            25% { opacity: 1; transform: translateY(0); }
            30% { opacity: 0; transform: translateY(-6px); }
            100% { opacity: 0; }
        }
        
        @keyframes bubble2 {
            0% { opacity: 0; transform: translateY(6px); }
            6% { opacity: 0; transform: translateY(6px); }
            8% { opacity: 1; transform: translateY(0); }
            25% { opacity: 1; transform: translateY(0); }
            30% { opacity: 0; transform: translateY(-6px); }
            100% { opacity: 0; }
        }
        
        @keyframes bubble3 {
            0% { opacity: 0; transform: translateY(6px); }
            12% { opacity: 0; transform: translateY(6px); }
            14% { opacity: 1; transform: translateY(0); }
            25% { opacity: 1; transform: translateY(0); }
            30% { opacity: 0; transform: translateY(-6px); }
            100% { opacity: 0; }
        }
        
        @keyframes bubble4 {
            0% { opacity: 0; transform: translateY(6px); }
            18% { opacity: 0; transform: translateY(6px); }
            20% { opacity: 1; transform: translateY(0); }
            25% { opacity: 1; transform: translateY(0); }
            30% { opacity: 0; transform: translateY(-6px); }
            100% { opacity: 0; }
        }
        
        /* ========== SIGN IN MODAL ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay-bg);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--color-background);
            border-radius: var(--modal-border-radius);
            padding: 40px;
            width: 100%;
            max-width: var(--modal-max-width);
            position: relative;
            box-shadow: var(--shadow-modal);
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: #eee;
        }
        
        .modal-step {
            display: block;
        }
        
        .modal-step.hidden {
            display: none;
        }
        
        .modal-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #000;
        }
        
        .modal-subtitle {
            color: #666;
            margin-bottom: 24px;
            font-size: 14px;
        }
        
        .modal-form-group {
            margin-bottom: 24px;
        }
        
        .modal-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        
        .phone-input-container {
            display: flex;
            align-items: center;
            background: #f7f7f7;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        
        .phone-input-container:focus-within {
            border-color: #E50914;
        }
        
        .country-select {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 14px 12px;
            background: transparent;
            border: none;
            border-right: 1px solid #e0e0e0;
            cursor: pointer;
            font-size: 14px;
        }
        
        .flag {
            font-size: 18px;
        }
        
        .phone-input {
            flex: 1;
            padding: 14px 16px;
            border: none;
            background: transparent;
            font-size: 16px;
            outline: none;
            font-family: inherit;
        }
        
        .phone-input::placeholder {
            color: #999;
        }
        
        .modal-btn {
            width: 100%;
            padding: var(--btn-padding);
            background: #ccc;
            color: #fff;
            border: none;
            border-radius: var(--btn-border-radius);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            cursor: pointer;
            transition: background 0.2s;
            font-family: var(--font-family);
        }
        
        .modal-btn.active {
            background: var(--color-primary);
        }
        
        .modal-btn.active:hover {
            background: var(--color-primary-hover);
        }
        
        .modal-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            padding: 0;
            margin-bottom: 16px;
        }
        
        .back-btn:hover {
            color: #333;
        }
        
        .otp-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .otp-input {
            width: 48px;
            height: 56px;
            text-align: center;
            font-size: 22px;
            font-weight: 600;
            border: 1px solid #ddd;
            border-radius: 8px;
            outline: none;
            font-family: inherit;
        }
        
        .otp-input:focus {
            border-color: #E50914;
        }
        
        .resend-text {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .resend-text a {
            color: #E50914;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Enhanced signup modal styles */
        .modal-content {
            max-width: 500px;
        }
        
        .modal-row {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .modal-row .modal-form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .modal-row .modal-form-group.small {
            flex: 0 0 140px;
        }
        
        .modal-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .modal-input:focus {
            border-color: #E50914;
        }
        
        .modal-input::placeholder {
            color: #999;
        }
        
        .modal-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            font-family: inherit;
            background: #fff;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }
        
        .modal-select:focus {
            border-color: #E50914;
        }
        
        .phone-row {
            display: flex;
            align-items: center;
            background: #f7f7f7;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        
        .phone-row:focus-within {
            border-color: #E50914;
        }
        
        .country-dropdown {
            position: relative;
        }
        
        .country-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 14px 12px;
            background: transparent;
            border: none;
            border-right: 1px solid #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            min-width: 90px;
            transition: background 0.2s;
        }
        
        .country-btn:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .country-list {
            position: absolute;
            top: 100%;
            left: 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-height: 250px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
            min-width: 280px;
        }
        
        .country-list.active {
            display: block;
        }
        
        .country-search {
            padding: 12px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: #fff;
        }
        
        .country-search input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            font-family: inherit;
        }
        
        .country-search input:focus {
            border-color: #E50914;
        }
        
        .country-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .country-item:hover {
            background: #f5f5f5;
        }
        
        .country-item .flag {
            font-size: 20px;
        }
        
        .country-item .name {
            flex: 1;
            font-size: 14px;
        }
        
        .country-item .code {
            color: #666;
            font-size: 14px;
        }
        
        .phone-number-input {
            flex: 1;
            padding: 14px 16px;
            border: none;
            background: transparent;
            font-size: 16px;
            outline: none;
            font-family: inherit;
        }
        
        .phone-number-input::placeholder {
            color: #999;
        }
        
        /* Additional phone input fixes for consistent appearance */
        input[type="tel"] {
            background: transparent;
        }
        
        /* Ensure phone input containers have consistent styling */
        .phone-input-container,
        .phone-row {
            background: #f7f7f7;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* Fix country selector to match container background */
        .country-select,
        .country-btn {
            background: transparent;
            border-radius: 8px 0 0 8px;
        }
        
        /* Ensure country button border matches container */
        .phone-input-container .country-select,
        .phone-row .country-btn {
            border-right-color: #e0e0e0;
        }
        
        .phone-input-container:focus-within .country-select,
        .phone-row:focus-within .country-btn {
            border-right-color: #e0e0e0;
        }
        
        .modal-error {
            color: #E50914;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }
        
        .modal-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 24px;
        }
        
        .modal-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .modal-checkbox label {
            font-size: 13px;
            color: #666;
        }
        
        .modal-checkbox a {
            color: #E50914;
            text-decoration: none;
        }
        
        .resend-timer {
            color: #999;
        }
        
        /* Telegram redirect modal */
        .telegram-modal {
            text-align: center;
            padding: 40px;
        }
        
        .telegram-modal h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        
        .telegram-modal p {
            color: #666;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .telegram-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 16px 32px;
            background: #E50914;
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            text-decoration: none;
            transition: background 0.2s;
        }
        
        .telegram-btn:hover {
            background: #c40812;
        }
        
        .telegram-btn svg {
            width: 24px;
            height: 24px;
        }

        /* ========== EDIT PROFILE PAGE ========== */
        #editProfilePage {
            background: #fafafa;
        }
        
        #editProfilePage .header {
            background: #fff;
            border-bottom: 1px solid #dbdbdb;
            padding: 12px 16px;
        }
        
        .header-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            color: #262626;
            font-family: inherit;
        }
        
        .header-btn.done {
            color: #E50914;
            font-weight: 600;
        }
        
        .header-btn:disabled {
            color: #c7c7c7;
            cursor: not-allowed;
        }
        
        .header-title {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
        }
        
        .profile-main {
            max-width: 600px;
            margin: 0 auto;
            padding-top: 70px;
        }
        
        .photo-section {
            background: #fff;
            padding: 24px 16px;
            text-align: center;
            border-bottom: 1px solid #dbdbdb;
        }
        
        .photo-container {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            margin: 0 auto 12px;
            overflow: visible;
            cursor: pointer;
        }
        
        .photo-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 36px;
            font-weight: 600;
        }
        
        .photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .change-photo-btn {
            color: #E50914;
            font-size: 14px;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .form-section {
            background: #fff;
            border-bottom: 1px solid #dbdbdb;
        }
        
        .form-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #efefef;
        }
        
        .form-row:last-child {
            border-bottom: none;
        }
        
        .form-label {
            width: 100px;
            font-size: 14px;
            color: #262626;
            flex-shrink: 0;
        }
        
        .form-input {
            flex: 1;
            border: none;
            font-size: 14px;
            color: #262626;
            background: transparent;
            outline: none;
            font-family: inherit;
        }
        
        .form-input::placeholder {
            color: #c7c7c7;
        }
        
        .bio-row {
            align-items: flex-start;
        }
        
        .bio-input {
            flex: 1;
            border: none;
            font-size: 14px;
            color: #262626;
            background: transparent;
            outline: none;
            resize: none;
            min-height: 60px;
            font-family: inherit;
        }
        
        .section-header {
            padding: 24px 16px 8px;
            font-size: 14px;
            font-weight: 600;
            color: #262626;
            background: #fafafa;
        }
        
        .social-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #efefef;
            background: #fff;
        }
        
        .social-icon {
            width: 24px;
            margin-right: 12px;
            font-size: 16px;
        }
        
        .social-input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .social-input {
            flex: 1;
            border: none;
            font-size: 14px;
            color: #262626;
            background: transparent;
            outline: none;
            font-family: inherit;
        }
        
        .social-input::placeholder {
            color: #c7c7c7;
        }
        
        .social-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 8px;
        }
        
        .social-status.valid {
            background: #22c55e;
            color: #fff;
        }
        
        .social-status.invalid {
            background: #ef4444;
            color: #fff;
        }
        
        .social-status.empty {
            display: none;
        }
        
        .required-text {
            font-size: 11px;
            color: #E50914;
            margin-left: 4px;
        }
        
        .age-select {
            flex: 1;
            border: none;
            font-size: 14px;
            color: #262626;
            background: transparent;
            outline: none;
            font-family: inherit;
            cursor: pointer;
        }
        
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: #262626;
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
            z-index: 1000;
        }
        
        .toast.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        /* ========================================
           EDIT PROFILE MODAL - WORLD CLASS
           LinkedIn-style overlay pattern
           ======================================== */
        
        .edit-profile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay-bg);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .edit-profile-overlay.active {
            display: flex;
        }
        
        .edit-profile-modal {
            background: var(--color-background);
            border-radius: var(--modal-border-radius);
            width: 100%;
            max-width: var(--modal-max-width);
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: var(--shadow-modal);
            animation: modalIn 0.3s ease;
        }
        
        .edit-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--modal-header-padding);
            border-bottom: 1px solid var(--color-border);
            flex-shrink: 0;
        }
        
        .edit-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-text-primary);
        }
        
        .edit-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border: none;
            background: var(--color-background-secondary);
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-modal-close:hover {
            background: #eee;
        }
        
        .edit-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--modal-padding);
        }
        
        .edit-photo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 32px;
        }
        
        .edit-photo-container {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            margin-bottom: 12px;
        }
        
        .edit-photo-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 40px;
            font-weight: 600;
        }
        
        .edit-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .edit-change-photo {
            font-size: 14px;
            font-weight: 500;
            color: #E50914;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            font-family: inherit;
        }
        
        .edit-change-photo:hover {
            text-decoration: underline;
        }
        
        .edit-section {
            margin-bottom: 28px;
        }
        
        .edit-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #888888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }
        
        .edit-form-group {
            margin-bottom: 20px;
        }
        
        .edit-form-group:last-child {
            margin-bottom: 0;
        }
        
        .edit-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #111111;
            margin-bottom: 8px;
        }
        
        .edit-input {
            width: 100%;
            height: 44px;
            padding: 0 14px;
            border: 1px solid #DDDDDD;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            color: #111111;
            background: #FFFFFF;
            transition: border-color 0.15s;
        }
        
        .edit-input:focus {
            outline: none;
            border-color: #111111;
        }
        
        .edit-input::placeholder {
            color: #888888;
        }
        
        .edit-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px 14px;
            border: 1px solid #DDDDDD;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            color: #111111;
            background: #FFFFFF;
            resize: none;
            transition: border-color 0.15s;
        }
        
        .edit-textarea:focus {
            outline: none;
            border-color: #111111;
        }
        
        .edit-textarea::placeholder {
            color: #888888;
        }
        
        .edit-select {
            width: 100%;
            height: 44px;
            padding: 0 14px;
            border: 1px solid #DDDDDD;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            color: #111111;
            background: #FFFFFF;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23555' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            transition: border-color 0.15s;
        }
        
        .edit-select:focus {
            outline: none;
            border-color: #111111;
        }
        
        .edit-form-row {
            display: flex;
            gap: 16px;
        }
        
        .edit-form-row .edit-form-group {
            flex: 1;
        }
        
        .edit-form-row .edit-form-group.small {
            flex: 0 0 100px;
        }
        
        .edit-link-item {
            margin-bottom: 16px;
        }
        
        .edit-link-item:last-child {
            margin-bottom: 0;
        }
        
        .edit-link-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #111111;
            margin-bottom: 8px;
        }
        
        .edit-link-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .edit-link-icon svg {
            display: block;
        }
        
        .edit-link-required {
            font-size: 11px;
            font-weight: 500;
            color: #E50914;
            margin-left: auto;
        }
        
        .edit-helper-text {
            font-size: 13px;
            color: #888888;
            margin-top: 12px;
            line-height: 1.5;
        }
        
        .edit-input-wrapper {
            position: relative;
        }
        
        .edit-input-wrapper .edit-input {
            padding-right: 40px;
        }
        
        .edit-validation-icon {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }
        
        .edit-validation-icon.valid {
            display: flex;
            background: #22c55e;
            color: #fff;
        }
        
        .edit-validation-icon.invalid {
            display: flex;
            background: #E50914;
            color: #fff;
        }
        
        /* Skills Section */
        .edit-section-desc {
            font-size: 13px;
            color: #536471;
            margin-bottom: 16px;
        }
        
        .skills-input-wrapper {
            position: relative;
            margin-bottom: 12px;
        }
        
        .skills-search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            box-sizing: border-box;
            transition: border-color 0.15s;
        }
        
        .skills-search-input:focus {
            border-color: #0f1419;
        }
        
        .skills-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            margin-top: 4px;
        }
        
        .skills-dropdown.show {
            display: block;
        }
        
        .skills-dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.1s;
        }
        
        .skills-dropdown-item:hover {
            background: #f7f9f9;
        }
        
        .skills-dropdown-item.add-custom {
            color: #E50914;
            font-weight: 500;
            border-top: 1px solid #e1e4e8;
        }
        
        .selected-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
            min-height: 36px;
        }
        
        .skill-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            color: #0f1419;
        }
        
        .skill-tag-remove {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: none;
            background: rgba(0,0,0,0.1);
            color: #536471;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            transition: all 0.15s;
        }
        
        .skill-tag-remove:hover {
            background: #E50914;
            color: white;
        }
        
        .skills-categories {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .skills-category-btn {
            padding: 6px 14px;
            border: 1px solid #e1e4e8;
            border-radius: 20px;
            background: white;
            font-size: 13px;
            font-weight: 500;
            color: #536471;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
        }
        
        .skills-category-btn:hover {
            border-color: #0f1419;
            color: #0f1419;
        }
        
        .skills-category-btn.active {
            background: #0f1419;
            border-color: #0f1419;
            color: white;
        }
        
        .skills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 150px;
            overflow-y: auto;
            padding: 4px 0;
        }
        
        .skill-option {
            padding: 8px 14px;
            border: 1px solid #e1e4e8;
            border-radius: 20px;
            background: white;
            font-size: 13px;
            color: #0f1419;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
        }
        
        .skill-option:hover {
            border-color: #0f1419;
            background: #f7f9f9;
        }
        
        .skill-option.selected {
            background: #E50914;
            border-color: #E50914;
            color: white;
        }
        
        .skill-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Profile Building Overlay */
        .profile-building-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            z-index: 50;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
        }
        
        .profile-building-overlay.show {
            display: flex;
        }
        
        .profile-building-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid #e1e4e8;
            border-top-color: #E50914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .profile-building-text {
            font-size: 16px;
            font-weight: 600;
            color: #0f1419;
            margin-bottom: 8px;
        }
        
        .profile-building-subtext {
            font-size: 14px;
            color: #536471;
        }
        
        .edit-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: var(--spacing-md);
            padding: var(--modal-footer-padding);
            border-top: 1px solid var(--color-border);
            flex-shrink: 0;
        }
        
        .edit-btn-cancel {
            padding: var(--btn-padding);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            color: var(--btn-secondary-color);
            background: var(--btn-secondary-bg);
            border: 1px solid var(--btn-secondary-border);
            cursor: pointer;
            font-family: var(--font-family);
            border-radius: var(--btn-border-radius);
            transition: all 0.2s ease;
        }
        
        .edit-btn-cancel:hover {
            background: var(--color-background-secondary);
        }
        
        .edit-btn-save {
            padding: var(--btn-padding);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            color: var(--btn-primary-color);
            background: var(--btn-primary-bg);
            border: none;
            cursor: pointer;
            font-family: var(--font-family);
            border-radius: var(--btn-border-radius);
            transition: all 0.2s ease;
        }
        
        .edit-btn-save:hover {
            opacity: 0.9;
        }
        
        .edit-btn-save:disabled {
            background: #DDDDDD;
            color: #888888;
            cursor: not-allowed;
        }
        
        @media (max-width: 900px) {
            .edit-profile-modal {
                max-width: calc(100% - 32px);
                max-height: 85vh;
                border-radius: var(--modal-border-radius);
                height: auto;
                margin: auto;
                position: relative;
            }
            
            .edit-modal-body {
                max-height: calc(85vh - 130px);
                overflow-y: auto;
            }
            
            .edit-form-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .edit-form-row .edit-form-group.small {
                flex: 1;
            }
            
            .edit-photo-section {
                padding: 20px 0;
            }
            
            .edit-photo-container {
                width: 80px;
                height: 80px;
            }
            
            .edit-photo-placeholder {
                font-size: 28px;
            }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        /* ========== DASHBOARD PAGE ========== */
        #dashboardPage {
            background: #fff;
        }
        
        #dashboardPage .header {
            border-bottom: none;
        }
        
        .dashboard-main {
            max-width: 800px;
            margin: 0 auto;
            padding: 100px 24px 60px;
        }
        
        .welcome-section {
            text-align: center;
            margin-bottom: 48px;
        }
        
        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            color: #000;
            margin-bottom: 8px;
        }
        
        .welcome-subtitle {
            font-size: 16px;
            color: #666;
        }
        
        .profile-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-bottom: 32px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .profile-card:hover {
            border-color: #ddd;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            overflow: visible;
        }
        
        .profile-avatar-large span {
            color: #fff;
            font-weight: 600;
            font-size: 40px;
        }
        
        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-card-name {
            font-size: 24px;
            font-weight: 600;
            color: #000;
            margin-bottom: 4px;
        }
        
        .profile-card-bio {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
        }
        
        .profile-socials {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .social-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: #f5f5f5;
            border-radius: 20px;
            font-size: 13px;
            color: #333;
            text-decoration: none;
        }
        
        .social-badge:hover {
            background: #eee;
        }
        
        .action-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .action-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 24px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-card:hover {
            border-color: #E50914;
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.1);
        }
        
        .attention-card-highlight {
            border-color: #E50914;
            background: #fef2f2;
        }
        
        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #000;
            margin-bottom: 4px;
        }
        
        .action-desc {
            font-size: 13px;
            color: #666;
        }
        
        /* ========================================
           WORKSPACE LAYOUT SYSTEM
           Shared by Connections & Attention pages
           LinkedIn/Instagram-level density
           ======================================== */
        
        /* Workspace Container */
        .workspace-page {
            background: #FFFFFF;
        }
        
        .workspace-header {
            border-bottom: none;
        }
        
        .workspace-layout {
            display: flex;
            max-width: 1100px;
            margin: 0 auto;
            padding: 88px 24px 40px;
            gap: 0;
        }
        
        /* Context Rail - Left sidebar */
        .context-rail {
            width: 200px;
            flex-shrink: 0;
            padding-right: 32px;
            border-right: 1px solid #EAEAEA;
            position: sticky;
            top: 88px;
            height: fit-content;
        }
        
        .rail-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #EAEAEA;
        }
        
        .rail-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #E5E5E5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888888;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .rail-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .rail-name {
            font-size: 14px;
            font-weight: 500;
            color: #111111;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .rail-nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .rail-link {
            display: block;
            padding: 8px 12px;
            font-size: 13px;
            color: #555555;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .rail-link:hover {
            background: #F5F5F5;
            color: #111111;
        }
        
        .rail-link.active {
            background: #F5F5F5;
            color: #111111;
            font-weight: 500;
        }
        
        .rail-link-count {
            float: right;
            font-size: 12px;
            color: #888888;
            font-weight: 400;
        }
        
        .rail-link.has-action .rail-link-count {
            color: #E50914;
        }
        
        /* Main Content Area */
        .workspace-main {
            flex: 1;
            min-width: 0;
            padding-left: 32px;
        }
        
        /* Page Header - Minimal */
        .workspace-title {
            font-size: 20px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 16px;
        }
        
        /* Controls Row */
        .workspace-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .workspace-search {
            flex: 1;
            max-width: 280px;
        }
        
        .workspace-search-input {
            display: flex;
            align-items: center;
            background: #FFFFFF;
            border: 1px solid #EAEAEA;
            border-radius: 6px;
            padding: 7px 10px;
            gap: 8px;
            transition: border-color 0.15s;
        }
        
        .workspace-search-input:focus-within {
            border-color: #111111;
        }
        
        .workspace-search-input.subdued {
            border-color: #F0F0F0;
        }
        
        .workspace-search-input svg {
            color: #AAAAAA;
            flex-shrink: 0;
            width: 14px;
            height: 14px;
        }
        
        .workspace-search-input input {
            border: none;
            background: none;
            outline: none;
            font-size: 13px;
            flex: 1;
            font-family: inherit;
            color: #111111;
        }
        
        .workspace-search-input input::placeholder {
            color: #AAAAAA;
        }
        
        /* Tabs - Segmented Control */
        .workspace-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #EAEAEA;
            margin-bottom: 0;
        }
        
        .workspace-tab {
            padding: 10px 14px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            color: #888888;
            transition: color 0.1s;
            margin-bottom: -1px;
        }
        
        .workspace-tab:hover {
            color: #555555;
        }
        
        .workspace-tab.active {
            color: #111111;
            border-bottom-color: #111111;
        }
        
        .workspace-tab.active.has-action {
            color: #E50914;
            border-bottom-color: #E50914;
        }
        
        .workspace-tab-count {
            font-size: 11px;
            margin-left: 4px;
            font-weight: 400;
        }
        
        /* List Container - Always visible */
        .workspace-list {
            min-height: 200px;
        }
        
        /* Row - LinkedIn density */
        .workspace-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 0;
            border-bottom: 1px solid #EAEAEA;
            transition: background 0.1s;
        }
        
        .workspace-row:hover {
            background: #FAFAFA;
            margin: 0 -16px;
            padding: 14px 16px;
        }
        
        .workspace-row:last-child {
            border-bottom: 1px solid #EAEAEA;
        }
        
        .workspace-row-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E5E5E5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888888;
            font-weight: 600;
            font-size: 15px;
            flex-shrink: 0;
        }
        
        .workspace-row-content {
            flex: 1;
            min-width: 0;
        }
        
        .workspace-row-name {
            font-size: 14px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 2px;
        }
        
        .workspace-row-context {
            font-size: 13px;
            color: #555555;
            margin-bottom: 2px;
            line-height: 1.3;
        }
        
        .workspace-row-meta {
            font-size: 12px;
            color: #888888;
        }
        
        .workspace-row-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
            align-items: center;
        }
        
        .workspace-btn {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.1s;
            border: none;
        }
        
        .workspace-btn-primary {
            background: #111111;
            color: #FFFFFF;
        }
        
        .workspace-btn-primary:hover {
            background: #333333;
        }
        
        .workspace-btn-secondary {
            background: none;
            color: #555555;
            border: 1px solid #DDDDDD;
        }
        
        .workspace-btn-secondary:hover {
            background: #F5F5F5;
        }
        
        /* Empty State - Inside list, left-aligned */
        .workspace-empty {
            padding: 48px 0 24px;
        }
        
        .workspace-empty-title {
            font-size: 15px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 8px;
        }
        
        .workspace-empty-text {
            font-size: 13px;
            color: #555555;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .workspace-empty-btn {
            display: inline-block;
            padding: 8px 16px;
            background: #E50914;
            color: #FFFFFF;
            border-radius: 4px;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: opacity 0.1s;
            margin-bottom: 12px;
        }
        
        .workspace-empty-btn:hover {
            opacity: 0.9;
        }
        
        .workspace-empty-note {
            font-size: 12px;
            color: #AAAAAA;
        }
        
        /* Skeleton Row */
        .workspace-skeleton {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 0;
            opacity: 0.06;
            pointer-events: none;
        }
        
        .skeleton-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #CCCCCC;
        }
        
        .skeleton-content {
            flex: 1;
        }
        
        .skeleton-line {
            height: 10px;
            background: #CCCCCC;
            border-radius: 3px;
            margin-bottom: 6px;
        }
        
        .skeleton-line.short { width: 35%; }
        .skeleton-line.medium { width: 55%; }
        
        .skeleton-btn {
            width: 60px;
            height: 28px;
            background: #CCCCCC;
            border-radius: 4px;
        }
        
        /* Toast */
        .workspace-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #111111;
            color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.25s ease;
        }
        
        .workspace-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Mobile: Hide rail, full width content */
        @media (max-width: 768px) {
            .workspace-layout {
                padding: 80px 16px 40px;
            }
            
            .context-rail {
                display: none;
            }
            
            .workspace-main {
                padding-left: 0;
            }
            
            .workspace-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .workspace-search {
                max-width: none;
            }
        }
        
        /* ========== CONNECTIONS PAGE SPECIFICS ========== */
        #connectionsPage {
            background: #FFFFFF;
        }
        
        .connections-header {
            border-bottom: none;
        }
        
        /* Hide old styles */
        .connections-main,
        .conn-page-header,
        .conn-page-title,
        .conn-page-subtitle,
        .conn-page-meta,
        .conn-page-divider,
        .conn-controls,
        .conn-search-container,
        .conn-search-bar,
        .conn-status-tabs,
        .conn-status-tab,
        .conn-list,
        .conn-section,
        .conn-empty,
        .conn-filter-pills,
        .conn-pill,
        .connection-row,
        .row-avatar,
        .row-content,
        .row-name,
        .row-context,
        .row-intro-meta,
        .row-actions,
        .row-btn {
            /* Old styles will be overridden by workspace system */
        }
        
        /* ========== ATTENTION PAGE SPECIFICS ========== */
        #attentionPage {
            background: #FFFFFF;
        }
        
        .attention-header {
            border-bottom: none;
        }
        
        /* Attention Row - Inbox style */
        .attn-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 0;
            border-bottom: 1px solid #EAEAEA;
            transition: background 0.1s;
        }
        
        .attn-row:hover {
            background: #FAFAFA;
            margin: 0 -16px;
            padding: 14px 16px;
        }
        
        .attn-row-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E5E5E5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888888;
            font-weight: 600;
            font-size: 15px;
            flex-shrink: 0;
        }
        
        .attn-row-content {
            flex: 1;
            min-width: 0;
        }
        
        .attn-row-name {
            font-size: 14px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 2px;
        }
        
        .attn-row-reason {
            font-size: 13px;
            color: #555555;
            margin-bottom: 2px;
            line-height: 1.3;
        }
        
        .attn-row-meta {
            font-size: 12px;
            color: #888888;
        }
        
        .attn-row-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .attn-btn {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.1s;
            border: none;
        }
        
        .attn-btn-interested {
            background: #111111;
            color: #FFFFFF;
        }
        
        .attn-btn-interested:hover {
            background: #333333;
        }
        
        .attn-btn-pass {
            background: none;
            color: #888888;
            border: 1px solid #DDDDDD;
        }
        
        .attn-btn-pass:hover {
            background: #F5F5F5;
            color: #555555;
        }
        
        /* Hide old attention page styles */
        .attention-main,
        .attn-page-header,
        .attn-page-title,
        .attn-page-subtitle,
        .attn-status-tabs,
        .attn-status-tab,
        .attn-filter-tabs,
        .attn-tab,
        .attn-proposals,
        .proposal-card,
        .attn-empty {
            display: none !important;
        }
        
        /* Remove filter pills - not needed */
        .conn-filter-pills {
            display: none;
        }
        
        /* Connection List */
        .conn-list {
            margin-top: 0;
        }
        
        .conn-section {
            margin-bottom: 0;
        }
        
        .conn-section-header {
            display: none;
        }
        
        /* Connection Row - LinkedIn Grade */
        .connection-row {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 20px 0;
            border-bottom: 1px solid #EAEAEA;
            cursor: default;
            transition: background 0.15s;
            margin: 0;
            border-radius: 0;
        }
        
        .connection-row:hover {
            background: #FAFAFA;
            margin: 0 -24px;
            padding: 20px 24px;
        }
        
        .connection-row:last-child {
            border-bottom: 1px solid #EAEAEA;
        }
        
        .row-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #E5E5E5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888888;
            font-weight: 600;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .row-content {
            flex: 1;
            min-width: 0;
        }
        
        .row-name {
            font-size: 15px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 2px;
        }
        
        .row-context {
            font-size: 14px;
            color: #555555;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .row-intro-meta {
            font-size: 13px;
            color: #888888;
        }
        
        .row-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            align-items: center;
        }
        
        .row-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
            border: none;
        }
        
        .row-btn-primary {
            background: #E50914;
            color: #FFFFFF;
        }
        
        .row-btn-primary:hover {
            opacity: 0.9;
        }
        
        .row-btn-secondary {
            background: none;
            color: #555555;
            border: 1px solid #DDDDDD;
        }
        
        .row-btn-secondary:hover {
            background: #F5F5F5;
            border-color: #CCCCCC;
        }
        
        /* Status indicators */
        .row-status {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 4px;
        }
        
        .row-status.pending {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .row-status.connected {
            color: #888888;
        }
        
        /* Remove old styles */
        .row-info,
        .row-title,
        .row-meta,
        .row-time,
        .row-tag,
        .row-action,
        .conn-time-header,
        .conn-section-title,
        .conn-section-badge,
        .conn-section-link {
            display: none;
        }
        
        /* Empty State - Critical */
        .conn-empty {
            text-align: center;
            padding: 60px 40px 32px;
        }
        
        .conn-empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 10px;
        }
        
        .conn-empty-text {
            font-size: 14px;
            color: #555555;
            margin-bottom: 6px;
            line-height: 1.5;
        }
        
        .conn-empty-meta {
            font-size: 13px;
            color: #888888;
            margin-bottom: 24px;
        }
        
        .conn-empty-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #E50914;
            color: #FFFFFF;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: opacity 0.15s;
            margin-bottom: 16px;
        }
        
        .conn-empty-btn:hover {
            opacity: 0.9;
        }
        
        .conn-empty-notify {
            font-size: 12px;
            color: #AAAAAA;
            margin-bottom: 0;
        }
        
        /* Skeleton Row - Future State Affordance */
        .conn-skeleton-row {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 20px 0;
            opacity: 0.08;
            pointer-events: none;
            margin-top: 24px;
        }
        
        .skeleton-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #E5E5E5;
        }
        
        .skeleton-content {
            flex: 1;
        }
        
        .skeleton-line {
            height: 12px;
            background: #E5E5E5;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .skeleton-line.short {
            width: 40%;
        }
        
        .skeleton-line.medium {
            width: 60%;
        }
        
        .skeleton-btn {
            width: 70px;
            height: 32px;
            background: #E5E5E5;
            border-radius: 6px;
        }
        
        /* Pending Section */
        #pendingSection {
            margin-bottom: 0;
        }
        
        .attention-card {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 20px 0;
            background: transparent;
            border: none;
            border-bottom: 1px solid #EAEAEA;
            border-radius: 0;
            margin-bottom: 0;
            cursor: default;
            transition: background 0.15s;
        }
        
        .attention-card:hover {
            background: #FAFAFA;
            margin: 0 -24px;
            padding: 20px 24px;
            box-shadow: none;
        }
        
        .attention-card.intro {
            background: transparent;
            border-color: #EAEAEA;
        }
        
        .attention-card.intro:hover {
            background: #FAFAFA;
            border-color: #EAEAEA;
        }
        
        .attention-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #E5E5E5;
            color: #888888;
        }
        
        .attention-info {
            flex: 1;
            min-width: 0;
        }
        
        .attention-name {
            font-size: 15px;
            font-weight: 600;
            color: #111111;
            margin-bottom: 4px;
        }
        
        .attention-context {
            font-size: 14px;
            color: #555555;
            margin-bottom: 4px;
        }
        
        .attention-text {
            font-size: 13px;
            color: #888888;
        }
        
        .attention-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .attention-action {
            padding: 8px 16px;
            background: #E50914;
            color: #FFFFFF;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
            transition: opacity 0.15s;
        }
        
        .attention-action:hover {
            opacity: 0.9;
            background: #E50914;
        }
        
        .attention-action.secondary {
            background: none;
            color: #555555;
            border: 1px solid #DDDDDD;
        }
        
        .attention-action.secondary:hover {
            background: #F5F5F5;
            opacity: 1;
        }
        
        .attention-action.decline {
            background: none;
            color: #888888;
            border: 1px solid #DDDDDD;
        }
        
        .attention-action.decline:hover {
            background: #F5F5F5;
            color: #555555;
        }
        
        /* Toast */
        .conn-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #111111;
            color: #fff;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .conn-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        }
        
        .conn-filter-pills::-webkit-scrollbar {
            display: none;
        }
        
        .conn-pill {
            padding: 8px 16px;
            background: #f5f5f5;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
            transition: all 0.2s;
            color: #666;
        }
        
        .conn-pill:hover {
            background: #eee;
        }
        
        .conn-pill.active {
            background: #000;
            color: #fff;
        }
        
        /* Connection Status Tabs */
        .conn-status-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 24px;
            border-bottom: 1px solid #eee;
        }
        
        .conn-status-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            color: #666;
            transition: all 0.2s;
        }
        
        .conn-status-tab:hover {
            color: #333;
        }
        
        .conn-status-tab.active {
            color: #E50914;
            border-bottom-color: #E50914;
        }
        
        .conn-status-count {
            background: #eee;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 6px;
        }
        
        .conn-status-tab.active .conn-status-count {
            background: #fef2f2;
            color: #E50914;
        }
        
        .conn-section {
            margin-bottom: 32px;
        }
        
        .conn-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .conn-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .conn-section-badge {
            background: #E50914;
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .conn-section-link {
            font-size: 13px;
            color: #E50914;
            text-decoration: none;
            font-weight: 500;
        }
        
        .conn-section-link:hover {
            text-decoration: underline;
        }
        
        .attention-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: #fffbeb;
            border: 1px solid #fef3c7;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .attention-card:hover {
            border-color: #fcd34d;
            box-shadow: 0 2px 8px rgba(252, 211, 77, 0.2);
        }
        
        .attention-card.intro {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .attention-card.intro:hover {
            border-color: #E50914;
        }
        
        .attention-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .attention-info {
            flex: 1;
            min-width: 0;
        }
        
        .attention-name {
            font-size: 15px;
            font-weight: 600;
            color: #000;
            margin-bottom: 2px;
        }
        
        .attention-text {
            font-size: 13px;
            color: #666;
        }
        
        .attention-action {
            padding: 8px 16px;
            background: #E50914;
            color: #fff;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
        }
        
        .attention-action:hover {
            background: #c40812;
        }
        
        .attention-action.secondary {
            background: #000;
        }
        
        .attention-action.secondary:hover {
            background: #333;
        }
        
        .attention-action.decline {
            background: #f5f5f5;
            color: #666;
        }
        
        .attention-action.decline:hover {
            background: #eee;
        }
        
        /* Connection card animations */
        .attention-card {
            transition: all 0.3s ease;
        }
        
        .attention-card.accepting {
            opacity: 0;
            transform: translateX(20px);
        }
        
        .attention-card.declining {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        /* Connected status card */
        .attention-card.connected {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .attention-card.connected:hover {
            border-color: #86efac;
        }
        
        .attention-text.connected {
            color: #16a34a;
        }
        
        /* Connection toast */
        .conn-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: #fff;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .conn-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Empty state for connections */
        .conn-empty {
            text-align: center;
            padding: 60px 20px;
        }
        
        .conn-empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
        }
        
        .conn-empty-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .conn-time-header {
            font-size: 12px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 16px 0 8px;
            border-bottom: 1px solid #f0f0f0;
            margin-bottom: 8px;
        }
        
        .connection-row {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 8px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            transition: all 0.15s;
            margin: 0 -8px;
            border-radius: 8px;
        }
        
        .connection-row:hover {
            background: #f9f9f9;
            border-color: transparent;
        }
        
        .connection-row:last-child {
            border-bottom: none;
        }
        
        .row-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .row-info {
            flex: 1;
            min-width: 0;
        }
        
        .row-name {
            font-size: 15px;
            font-weight: 600;
            color: #000;
            margin-bottom: 2px;
        }
        
        .row-title {
            font-size: 13px;
            color: #666;
            white-space: nowrap;
            overflow: visible;
            text-overflow: ellipsis;
        }
        
        .row-meta {
            text-align: right;
            flex-shrink: 0;
        }
        
        .row-time {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
        }
        
        .row-tag {
            display: inline-block;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 10px;
            font-size: 11px;
            color: #666;
        }
        
        .row-action {
            display: none;
            padding: 8px 14px;
            background: #E50914;
            color: #fff;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }
        
        .row-action:hover {
            background: #c40812;
        }
        
        .connection-row:hover .row-meta {
            display: none;
        }
        
        .connection-row:hover .row-action {
            display: block;
        }
        
        /* ========== ATTENTION REQUIRED PAGE ========== */
        #attentionPage {
            background: #fff;
        }
        
        .attention-header {
            border-bottom: none;
        }
        
        .attention-main {
            max-width: 700px;
            margin: 0 auto;
            padding: 100px 16px 60px;
        }
        
        .attn-page-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .attn-page-title {
            font-size: 28px;
            font-weight: 700;
            color: #000;
            margin-bottom: 8px;
        }
        
        .attn-page-subtitle {
            font-size: 15px;
            color: #666;
        }
        
        .attn-filter-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: 16px;
            -webkit-overflow-scrolling: touch;
        }
        
        .attn-filter-tabs::-webkit-scrollbar {
            display: none;
        }
        
        /* Status Tabs (Needs Response / Interested / Passed) */
        .attn-status-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 24px;
            border-bottom: 1px solid #eee;
        }
        
        .attn-status-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            color: #666;
            transition: all 0.2s;
        }
        
        .attn-status-tab:hover {
            color: #333;
        }
        
        .attn-status-tab.active {
            color: #E50914;
            border-bottom-color: #E50914;
        }
        
        .attn-status-count {
            background: #eee;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 6px;
        }
        
        .attn-status-tab.active .attn-status-count {
            background: #fef2f2;
            color: #E50914;
        }
        
        .attn-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: #f5f5f5;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            white-space: nowrap;
            transition: all 0.2s;
            color: #666;
        }
        
        .attn-tab:hover {
            background: #eee;
        }
        
        .attn-tab.active {
            background: #E50914;
            color: #fff;
        }
        
        .attn-tab-count {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
        }
        
        .attn-tab.active .attn-tab-count {
            background: rgba(255,255,255,0.2);
        }
        
        .attn-proposals {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .proposal-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.2s;
        }
        
        .proposal-card:hover {
            border-color: #ddd;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .proposal-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .proposal-badge.job {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .proposal-badge.collab {
            background: #fce7f3;
            color: #be185d;
        }
        
        .proposal-badge.speaking {
            background: #d1fae5;
            color: #047857;
        }
        
        .proposal-badge.advisory {
            background: #fef3c7;
            color: #b45309;
        }
        
        .proposal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .proposal-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 16px;
        }
        
        .proposal-from {
            font-size: 13px;
            color: #666;
        }
        
        .proposal-from strong {
            color: #E50914;
        }
        
        .proposal-title {
            font-size: 18px;
            font-weight: 600;
            color: #000;
            margin-bottom: 4px;
        }
        
        .proposal-company {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }
        
        .proposal-desc {
            font-size: 14px;
            color: #444;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .proposal-details {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .proposal-detail {
            font-size: 13px;
            color: #666;
            background: #f5f5f5;
            padding: 6px 12px;
            border-radius: 16px;
        }
        
        .proposal-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .proposal-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            border: none;
        }
        
        .proposal-btn.primary {
            background: #E50914;
            color: #fff;
        }
        
        .proposal-btn.primary:hover {
            background: #c40812;
        }
        
        .proposal-btn.secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .proposal-btn.secondary:hover {
            background: #eee;
        }
        
        .proposal-btn.tertiary {
            background: transparent;
            color: #E50914;
            border: 1px solid #E50914;
        }
        
        .proposal-btn.tertiary:hover {
            background: #fef2f2;
        }
        
        /* Card animations */
        .proposal-card {
            transition: all 0.3s ease;
        }
        
        .proposal-card.removing {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .proposal-card.interested {
            opacity: 0;
            transform: translateX(20px);
        }
        
        /* Status indicator for interested/passed cards */
        .proposal-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: #f8f8f8;
            border-radius: 12px;
            margin-top: 16px;
            gap: 16px;
        }
        
        .proposal-status-text {
            font-size: 14px;
            color: #666;
            flex: 1;
        }
        
        .proposal-status-text.interested {
            color: #16a34a;
        }
        
        .proposal-status-text.passed {
            color: #666;
        }
        
        .proposal-status-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            border: none;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .proposal-status-btn.restore {
            background: #f5f5f5;
            color: #666;
        }
        
        .proposal-status-btn.restore:hover {
            background: #eee;
        }
        
        .proposal-status-btn.message {
            background: #E50914;
            color: #fff;
        }
        
        .proposal-status-btn.message:hover {
            background: #c40812;
        }
        
        /* Toast notification */
        .attn-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: #fff;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .attn-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .attn-empty {
            text-align: center;
            padding: 60px 20px;
        }
        
        .attn-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .attn-empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
        }
        
        .attn-empty-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .attn-empty-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #E50914;
            color: #fff;
            border-radius: 25px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        
        .attn-empty-btn:hover {
            background: #c40812;
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 900px) {
            .header {
                padding: 0 24px;
            }
            
            #landingPage .hero {
                grid-template-columns: 1fr;
                text-align: center;
                padding: 120px 24px 48px;
                gap: 48px;
            }
            
            .hero-text {
                max-width: 100%;
            }
            
            .hero h1 {
                font-size: 34px;
            }
            
            .hero .subtitle {
                font-size: 15px;
            }
            
            .hero-visual {
                order: -1;
            }
            
            .phone-frame img.frame {
                max-height: 70vh;
            }
            
            /* Scale and position bubbles to fit inside phone on mobile */
            .phone-container {
                display: flex;
                justify-content: center;
                position: relative;
            }
            
            .message-bubble {
                font-size: 11px;
                padding: 8px 12px;
                max-width: 120px;
                line-height: 1.3;
                border-radius: 12px;
            }
            
            /* 
             * Mobile bubble positioning - INSIDE the phone screen
             * User messages (outgoing/light) = RIGHT side
             * Taj messages (incoming/dark) = LEFT side
             */
            
            /* Convo 1: User(right), Taj(left), User(right), Taj(left) */
            .bubble-1 { top: 20%; right: 22% !important; left: auto !important; }
            .bubble-2 { top: 33%; left: 22% !important; right: auto !important; }
            .bubble-3 { top: 48%; right: 22% !important; left: auto !important; }
            .bubble-4 { top: 63%; left: 22% !important; right: auto !important; }
            
            /* Convo 2: Taj(left), User(right), Taj(left), User(right) */
            .bubble-5 { top: 20%; left: 22% !important; right: auto !important; }
            .bubble-6 { top: 33%; right: 22% !important; left: auto !important; }
            .bubble-7 { top: 48%; left: 22% !important; right: auto !important; }
            .bubble-8 { top: 63%; right: 22% !important; left: auto !important; }
            
            /* Convo 3: User(right), Taj(left), User(right), Taj(left) */
            .bubble-9 { top: 20%; right: 22% !important; left: auto !important; }
            .bubble-10 { top: 33%; left: 22% !important; right: auto !important; }
            .bubble-11 { top: 48%; right: 22% !important; left: auto !important; }
            .bubble-12 { top: 63%; left: 22% !important; right: auto !important; }
            
            .action-cards {
                grid-template-columns: 1fr;
            }
            
            .profile-name {
                display: none;
            }
            
            .conn-search-shortcut {
                display: none;
            }
            
            .row-action {
                display: block;
                padding: 6px 12px;
            }
            
            .connection-row:hover .row-meta {
                display: block;
            }
            
            .row-meta {
                display: none;
            }
        }
        
        /* Extra small phones - adjust bubble size only, positioning inherited from 900px */
        @media (max-width: 480px) {
            .message-bubble {
                font-size: 9px;
                padding: 5px 8px;
                max-width: 90px;
                line-height: 1.2;
                border-radius: 10px;
            }
        }
        
        /* ========== NEW X.COM-STYLE APP LAYOUT ========== */
        .new-app-container {
            display: flex;
            max-width: 1280px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        /* Page loading states */
        .page-loading {
            opacity: 0.6;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        
        .page-loaded {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* New Sidebar - Instagram-style with centered nav */
        .new-sidebar {
            width: 275px;
            height: 100vh;
            position: sticky;
            top: 0;
            display: flex;
            flex-direction: column;
            padding: 12px;
            border-right: 1px solid #eff3f4;
            background: linear-gradient(180deg, #fafafa 0%, #ffffff 50%, #fafafa 100%);
        }
        
        /* TOP ZONE - Logo (fixed at top) */
        .new-sidebar-logo {
            padding: 16px 12px;
            flex-shrink: 0;
        }
        
        .new-sidebar-logo-text {
            font-size: 28px;
            font-weight: 700;
            color: #E50914;
            cursor: pointer;
            transition: opacity 0.15s ease;
        }
        
        .new-sidebar-logo-text:hover {
            opacity: 0.8;
        }
        
        /* MIDDLE ZONE - Nav (vertically centered) */
        .new-sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2px;
            padding: 24px 0;
        }
        
        .new-sidebar-section {
            margin-bottom: 2px;
        }
        
        .new-sidebar-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
            color: #536471;
            position: relative;
        }
        
        .new-sidebar-link:hover {
            background: rgba(0, 0, 0, 0.04);
            color: #0f1419;
        }
        
        .new-sidebar-link.active {
            color: #0f1419;
            font-weight: 600;
            background: transparent;
        }
        
        .new-sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 24px;
            background: #E50914;
            border-radius: 0 3px 3px 0;
        }
        
        .new-sidebar-icon {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            stroke-width: 1.75;
            fill: none;
            flex-shrink: 0;
            transition: stroke 0.15s ease;
        }
        
        .new-sidebar-link.active .new-sidebar-icon {
            stroke-width: 2;
        }
        
        .new-sidebar-label {
            font-size: 15px;
            letter-spacing: -0.1px;
        }
        
        .new-sidebar-badge {
            background: #E50914;
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 9999px;
            margin-left: auto;
        }
        
        .new-sidebar-expand {
            padding-left: 54px;
            margin-top: 2px;
        }
        
        .new-sidebar-sublink {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #536471;
            font-size: 14px;
        }
        
        .new-sidebar-sublink:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #0f1419;
        }
        
        .new-sidebar-sublink.active {
            color: #0f1419;
            font-weight: 600;
        }
        
        /* BOTTOM ZONE - CTA + Profile (fixed at bottom) */
        .new-sidebar-bottom {
            flex-shrink: 0;
            padding-top: 16px;
        }
        
        .new-sidebar-cta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            margin: 0 0 12px 0;
            background: #E50914;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: opacity 0.2s;
            text-decoration: none;
            width: 100%;
        }
        
        .new-sidebar-cta:hover {
            opacity: 0.9;
        }
        
        .new-sidebar-cta svg {
            width: 20px;
            height: 20px;
        }
        
        .new-sidebar-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .new-sidebar-profile:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .new-sidebar-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .new-sidebar-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .new-sidebar-profile-info {
            flex: 1;
            min-width: 0;
        }
        
        .new-sidebar-profile-name {
            font-size: 14px;
            font-weight: 600;
            color: #0f1419;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .new-sidebar-profile-handle {
            font-size: 15px;
            color: #536471;
        }
        
        /* Main Column */
        .new-main-column {
            flex: 1;
            max-width: 600px;
            border-right: 1px solid #eff3f4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .new-main-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            z-index: 100;
            padding: 12px 16px;
            min-height: 53px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-bottom: 1px solid #eff3f4;
            flex-shrink: 0;
        }
        
        .new-main-title {
            font-size: 20px;
            font-weight: 700;
            color: #0f1419;
        }
        
        .new-main-subtitle {
            font-size: 13px;
            color: #536471;
            margin-top: 2px;
        }
        
        /* CENTERED CANVAS - For action/empty state pages */
        .centered-canvas {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 32px;
            text-align: center;
            min-height: calc(100vh - 53px);
        }
        
        .centered-canvas-inner {
            max-width: 400px;
            width: 100%;
        }
        
        /* TOP-ALIGNED CANVAS - For lists/browse pages */
        .top-canvas {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Right Column */
        .new-right-column {
            width: 350px;
            padding: 12px 24px;
        }
        
        .new-right-card {
            background: #f7f9f9;
            border-radius: 16px;
            padding: 12px 0;
            margin-bottom: 16px;
        }
        
        .new-right-card-title {
            font-size: 20px;
            font-weight: 800;
            color: #0f1419;
            padding: 12px 16px;
        }
        
        .new-right-card-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.15s ease;
        }
        
        .new-right-card-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .new-right-card-item-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .new-right-card-check {
            font-size: 16px;
            color: #cfd9de;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .new-right-card-check.done {
            color: #00ba7c;
        }
        
        .new-right-card-item-title {
            font-size: 15px;
            font-weight: 600;
            color: #0f1419;
        }
        
        .new-right-card-item.done .new-right-card-item-title {
            color: #536471;
            text-decoration: line-through;
        }
        
        .new-right-card-item-desc {
            font-size: 13px;
            color: #536471;
            margin-top: 2px;
        }
        
        /* Tasks System */
        .new-right-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
        }
        
        .new-right-card-header .new-right-card-title {
            padding: 0;
        }
        
        .new-task-add-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #536471;
            transition: all 0.15s ease;
        }
        
        .new-task-add-btn:hover {
            background: rgba(0, 0, 0, 0.08);
            color: #0f1419;
        }
        
        /* Task Modal */
        .task-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay-bg);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .task-modal-overlay.show {
            display: flex;
        }
        
        .task-modal {
            background: var(--color-background);
            border-radius: var(--modal-border-radius);
            width: 100%;
            max-width: var(--modal-max-width);
            position: relative;
            box-shadow: var(--shadow-modal);
            animation: modalIn 0.3s ease;
        }
        
        .task-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--modal-header-padding);
            border-bottom: 1px solid var(--color-border);
        }
        
        .task-modal-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin: 0;
        }
        
        .task-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border: none;
            background: var(--color-background-secondary);
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-modal-close:hover {
            background: #eee;
        }
        
        .task-modal-body {
            padding: var(--modal-padding);
        }
        
        .task-modal-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #eff3f4;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s ease;
            box-sizing: border-box;
        }
        
        .task-modal-input:focus {
            border-color: #0f1419;
        }
        
        .task-modal-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #eff3f4;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s ease;
            box-sizing: border-box;
            margin-top: 12px;
            min-height: 80px;
            resize: none;
            color: #536471;
        }
        
        .task-modal-textarea:focus {
            border-color: #0f1419;
            color: #0f1419;
        }
        
        .task-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            padding: var(--modal-footer-padding);
            border-top: 1px solid var(--color-border);
        }
        
        .task-modal-cancel {
            padding: var(--btn-padding);
            border: 1px solid var(--btn-secondary-border);
            border-radius: var(--btn-border-radius);
            background: var(--btn-secondary-bg);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            font-family: var(--font-family);
            color: var(--btn-secondary-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .task-modal-cancel:hover {
            background: var(--color-background-secondary);
        }
        
        .task-modal-submit {
            padding: var(--btn-padding);
            border: none;
            border-radius: var(--btn-border-radius);
            background: var(--btn-primary-bg);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            font-family: var(--font-family);
            color: var(--btn-primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .task-modal-submit:hover {
            opacity: 0.9;
        }
        
        /* Connection Modal */
        .connection-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay-bg);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .connection-modal-overlay.show {
            display: flex;
        }
        
        .connection-modal {
            background: var(--color-background);
            border-radius: var(--modal-border-radius);
            width: 100%;
            max-width: var(--modal-max-width);
            max-height: 80vh;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow-modal);
            animation: modalIn 0.3s ease;
        }
        
        .connection-modal-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--modal-header-padding);
            border-bottom: 1px solid var(--color-border);
        }
        
        .connection-modal-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary), #ff4757);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }
        
        .connection-modal-info {
            flex: 1;
        }
        
        .connection-modal-name {
            font-size: var(--font-size-title);
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 var(--spacing-xs) 0;
        }
        
        .connection-modal-status {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--modal-border-radius);
            font-size: var(--font-size-label);
            font-weight: 500;
        }
        
        .connection-modal-status.connected {
            background: var(--status-connected-bg);
            color: var(--status-connected-color);
        }
        
        .connection-modal-status.pending {
            background: var(--status-pending-bg);
            color: var(--status-pending-color);
        }
        
        .connection-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border: none;
            background: var(--color-background-secondary);
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .connection-modal-close:hover {
            background: #eee;
        }
        
        .connection-modal-body {
            padding: var(--modal-padding);
        }
        
        .connection-modal-section {
            margin-bottom: var(--spacing-lg);
        }
        
        .connection-modal-label {
            font-size: var(--font-size-label);
            font-weight: 600;
            color: var(--color-text-muted);
            text-transform: uppercase;
            margin-bottom: var(--spacing-sm);
        }
        
        .connection-modal-value {
            font-size: var(--font-size-body);
            color: var(--color-text-primary);
            line-height: 1.5;
        }
        
        .connection-modal-skills {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .connection-modal-skill {
            background: var(--color-background-secondary);
            color: var(--color-text-secondary);
            padding: 6px var(--spacing-md);
            border-radius: var(--modal-border-radius);
            font-size: var(--font-size-small);
        }
        
        .connection-modal-message {
            background: var(--color-background-secondary);
            border-radius: var(--modal-border-radius);
            padding: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .connection-modal-message.success {
            background: var(--status-connected-bg);
        }
        
        .connection-modal-message.waiting {
            background: var(--status-pending-bg);
        }
        
        .connection-modal-message-icon {
            font-size: 24px;
            margin-bottom: var(--spacing-sm);
        }
        
        .connection-modal-message-title {
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .connection-modal-message-text {
            font-size: var(--font-size-small);
            color: var(--color-text-secondary);
            line-height: 1.5;
        }
        
        .connection-modal-footer {
            padding: var(--modal-footer-padding);
            display: flex;
            gap: var(--spacing-md);
        }
        
        /* Request Modal Styles */
        .request-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .request-modal-overlay.show {
            display: flex;
        }
        
        .request-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 480px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        .request-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #f5f5f5;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .request-modal-body {
            padding: 24px;
        }
        
        .request-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f1419;
            margin: 0 0 8px 0;
        }
        
        .request-modal-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
            background: #f0f0f0;
            color: #536471;
            margin-bottom: 20px;
        }
        
        .request-modal-section {
            margin-bottom: 16px;
        }
        
        .request-modal-label {
            font-size: 12px;
            font-weight: 600;
            color: #536471;
            margin-bottom: 4px;
        }
        
        .request-modal-value {
            font-size: 15px;
            color: #0f1419;
        }
        
        .request-modal-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .request-modal-skill {
            background: #f0f0f0;
            color: #536471;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
        }
        
        .request-modal-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
        }
        
        .request-modal-btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 9999px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }
        
        .request-modal-btn.primary {
            background: #e4e4e4;
            color: #0f1419;
        }
        
        .request-modal-btn.secondary {
            background: white;
            color: #0f1419;
            border: 1px solid #e4e4e4;
        }
        
        .connection-modal-btn {
            flex: 1;
            padding: var(--btn-padding);
            border-radius: var(--btn-border-radius);
            font-size: var(--btn-font-size);
            font-weight: var(--btn-font-weight);
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            font-family: var(--font-family);
        }
        
        .connection-modal-btn.secondary {
            background: var(--btn-secondary-bg);
            color: var(--btn-secondary-color);
            border: 1px solid var(--btn-secondary-border);
        }
        
        .connection-modal-btn.secondary:hover {
            background: var(--color-background-secondary);
        }
        
        .connection-modal-btn.primary {
            background: var(--btn-primary-bg);
            color: var(--btn-primary-color);
        }
        
        .connection-modal-btn.primary:hover {
            opacity: 0.9;
        }
        
        .new-task-input-wrapper {
            padding: 0 16px 12px;
            display: flex;
            gap: 8px;
        }
        
        .new-task-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #eff3f4;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s ease;
        }
        
        .new-task-input:focus {
            border-color: #E50914;
        }
        
        .new-task-input-btn {
            padding: 10px 16px;
            background: #0f1419;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.15s ease;
        }
        
        .new-task-input-btn:hover {
            opacity: 0.9;
        }
        
        .new-tasks-list {
            padding: 0;
        }
        
        .new-task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.15s ease;
        }
        
        .new-task-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .new-task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cfd9de;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1px;
            transition: all 0.15s ease;
            font-size: 12px;
            color: transparent;
        }
        
        .new-task-item:hover .new-task-checkbox {
            border-color: #E50914;
        }
        
        .new-task-item.done .new-task-checkbox {
            background: #00ba7c;
            border-color: #00ba7c;
            color: white;
        }
        
        .new-task-content {
            flex: 1;
            min-width: 0;
        }
        
        .new-task-title {
            font-size: 14px;
            font-weight: 500;
            color: #0f1419;
            transition: all 0.15s ease;
        }
        
        .new-task-item.done .new-task-title {
            color: #536471;
            text-decoration: line-through;
        }
        
        .new-task-meta {
            font-size: 12px;
            color: #536471;
            margin-top: 2px;
        }
        
        .new-task-type {
            display: inline-block;
            font-size: 11px;
            font-weight: 500;
            color: #536471;
            background: #eff3f4;
            padding: 2px 8px;
            border-radius: 4px;
            margin-top: 4px;
        }
        
        .new-task-type.system {
            background: rgba(229, 9, 20, 0.08);
            color: #E50914;
        }
        
        .new-task-dismiss {
            opacity: 0;
            padding: 4px;
            background: none;
            border: none;
            color: #536471;
            cursor: pointer;
            transition: opacity 0.15s ease;
        }
        
        .new-task-item:hover .new-task-dismiss {
            opacity: 1;
        }
        
        .new-task-dismiss:hover {
            color: #f4212e;
        }
        
        .new-tasks-empty {
            padding: 24px 16px;
            text-align: center;
        }
        
        .new-tasks-empty p {
            font-size: 14px;
            color: #536471;
            margin: 0;
        }
        
        .new-tasks-divider {
            font-size: 12px;
            font-weight: 600;
            color: #536471;
            padding: 8px 16px 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Referral Note */
        .new-referral-note {
            font-size: 13px;
            color: #536471;
            text-align: center;
            margin-top: 16px;
        }
        
        /* Tabs */
        .new-tabs {
            display: flex;
            border-bottom: 1px solid #eff3f4;
        }
        
        .new-tab {
            flex: 1;
            padding: 16px 0;
            font-size: 15px;
            font-weight: 500;
            color: #536471;
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
            position: relative;
            transition: background 0.2s;
        }
        
        .new-tab:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .new-tab.active {
            color: #0f1419;
            font-weight: 700;
        }
        
        .new-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 56px;
            height: 4px;
            background: #E50914;
            border-radius: 2px;
        }
        
        /* Speak to Taj Page - CENTERED CANVAS */
        .new-speak-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 32px;
            text-align: center;
            min-height: calc(100vh - 53px);
        }
        
        .new-speak-inner {
            max-width: 400px;
            width: 100%;
        }
        
        .new-speak-title {
            font-size: 28px;
            font-weight: 700;
            color: #0f1419;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
            line-height: 1.3;
        }
        
        .new-speak-subtitle {
            font-size: 15px;
            color: #536471;
            line-height: 1.5;
            margin-bottom: 32px;
        }
        
        .new-speak-cta {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            background: #0f1419;
            color: white;
            border: none;
            border-radius: 9999px;
            font-size: 17px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: opacity 0.2s;
            text-decoration: none;
            margin-bottom: 24px;
        }
        
        .new-speak-cta:hover {
            opacity: 0.9;
        }
        
        .new-speak-meta {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }
        
        .new-speak-meta-line {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #536471;
        }
        
        .new-speak-meta-line svg {
            width: 18px;
            height: 18px;
            stroke: #536471;
            flex-shrink: 0;
        }
        
        /* Feed Items */
        .new-feed-item {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid #eff3f4;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .new-feed-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .new-feed-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }
        
        .new-feed-content {
            flex: 1;
            min-width: 0;
        }
        
        .new-feed-header {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 2px;
        }
        
        .new-feed-name {
            font-size: 15px;
            font-weight: 700;
            color: #0f1419;
        }
        
        .new-feed-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .new-feed-status.connected {
            background: #d1fae5;
            color: #065f46;
        }
        
        .new-feed-status.pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .new-feed-text {
            font-size: 15px;
            color: #0f1419;
            line-height: 1.4;
            margin-top: 4px;
        }
        
        .new-feed-context {
            font-size: 15px;
            color: #536471;
            line-height: 1.4;
        }
        
        .new-feed-time {
            font-size: 13px;
            color: #536471;
            margin-top: 8px;
        }
        
        .new-feed-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .new-feed-btn {
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 700;
            font-family: inherit;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .new-feed-btn.primary {
            background: #0f1419;
            color: white;
            border: none;
        }
        
        .opportunity-refer-btn {
            background: transparent;
            color: #0f1419;
            border: 1px solid #cfd9de;
            padding: 8px 20px;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .opportunity-refer-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .new-feed-btn.primary:hover {
            opacity: 0.9;
        }
        
        .new-feed-btn.secondary {
            background: transparent;
            color: #0f1419;
            border: 1px solid #cfd9de;
        }
        
        .new-feed-btn.secondary:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        /* Archive Status Styles */
        .archive-status {
            font-size: 12px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 12px;
        }
        
        .archive-status.declined {
            background: #ffebee;
            color: #c62828;
        }
        
        .archive-status.referred {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .new-feed-item.archived {
            opacity: 0.8;
        }
        
        .new-feed-item.archived .new-feed-content {
            color: #666;
        }
        
        .archive-empty {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .archive-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            text-transform: uppercase;
        }
        
        .archive-badge.declined {
            background: #ffebee;
            color: #c62828;
        }
        
        .archive-badge.referred {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .archive-btn {
            padding: 8px 16px;
            border-radius: 9999px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            background: white;
            color: #0f1419;
            border: 1px solid #ddd;
            transition: all 0.2s;
        }
        
        .archive-btn:hover {
            background: #f7f7f7;
            border-color: #ccc;
        }
        
        /* ========== OPPORTUNITY MODALS ========== */
        
        /* Shared overlay styles */
        .opp-detail-overlay,
        .refer-confirm-overlay,
        .refer-success-overlay,
        .decline-confirm-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .opp-detail-overlay.show,
        .refer-confirm-overlay.show,
        .refer-success-overlay.show,
        .decline-confirm-overlay.show {
            display: flex;
        }
        
        /* Shared modal styles */
        .opp-detail-modal,
        .refer-confirm-modal,
        .refer-success-modal,
        .decline-confirm-modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: modalSlideIn 0.2s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .opp-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #f5f5f5;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            transition: background 0.2s;
            z-index: 1;
        }
        
        .opp-modal-close:hover {
            background: #e0e0e0;
        }
        
        /* Detail Modal Styles */
        .opp-detail-body {
            padding: 24px;
        }
        
        .opp-detail-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .opp-detail-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
        }
        
        .opp-detail-info {
            flex: 1;
        }
        
        .opp-detail-name {
            font-size: 20px;
            font-weight: 600;
            color: #0f1419;
            margin: 0 0 4px 0;
        }
        
        .opp-detail-bio {
            font-size: 14px;
            color: #536471;
            margin: 0;
        }
        
        .opp-detail-section {
            margin-bottom: 20px;
        }
        
        .opp-detail-label {
            font-size: 11px;
            font-weight: 600;
            color: #536471;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .opp-detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #0f1419;
            margin: 0;
        }
        
        .opp-detail-desc {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
            margin: 0;
        }
        
        .opp-detail-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .opp-detail-skill {
            background: #f0f0f0;
            color: #536471;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
        }
        
        .opp-detail-score {
            font-size: 18px;
            font-weight: 700;
            color: #E50914;
        }
        
        .opp-detail-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
            border-top: 1px solid #eee;
        }
        
        .opp-detail-btn {
            flex: 1;
            padding: 14px 20px;
            border-radius: 9999px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .opp-detail-btn.primary {
            background: #0f1419;
            color: white;
        }
        
        .opp-detail-btn.primary:hover {
            background: #2a2a2a;
        }
        
        .opp-detail-btn.secondary {
            background: #f0f0f0;
            color: #0f1419;
        }
        
        .opp-detail-btn.secondary:hover {
            background: #e0e0e0;
        }
        
        .opp-detail-btn.tertiary {
            background: white;
            color: #536471;
            border: 1px solid #ddd;
        }
        
        .opp-detail-btn.tertiary:hover {
            background: #f7f7f7;
            border-color: #ccc;
        }
        
        /* Confirmation Modal Styles */
        .refer-confirm-body,
        .refer-success-body,
        .decline-confirm-body {
            padding: 32px 24px;
            text-align: center;
        }
        
        .refer-confirm-icon,
        .refer-success-icon,
        .decline-confirm-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .refer-confirm-title,
        .refer-success-title,
        .decline-confirm-title {
            font-size: 22px;
            font-weight: 700;
            color: #0f1419;
            margin: 0 0 8px 0;
        }
        
        .refer-confirm-subtitle,
        .refer-success-subtitle,
        .decline-confirm-subtitle {
            font-size: 15px;
            color: #536471;
            margin: 0;
            line-height: 1.5;
        }
        
        .refer-confirm-input-group {
            margin-top: 24px;
            text-align: left;
        }
        
        .refer-confirm-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #536471;
            margin-bottom: 8px;
        }
        
        .refer-confirm-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            box-sizing: border-box;
        }
        
        .refer-confirm-input:focus {
            outline: none;
            border-color: #0f1419;
        }
        
        .refer-confirm-footer,
        .refer-success-footer,
        .decline-confirm-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 480px) {
            .opp-detail-footer,
            .refer-confirm-footer,
            .refer-success-footer,
            .decline-confirm-footer {
                flex-direction: column;
            }
            
            .opp-detail-btn {
                width: 100%;
            }
        }
        
        /* Empty States - Centered within content area */
        .new-empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 32px;
            text-align: center;
            min-height: 400px;
        }
        
        .new-empty-icon {
            width: 56px;
            height: 56px;
            margin-bottom: 20px;
            stroke: #cfd9de;
            stroke-width: 1.5;
        }
        
        .new-empty-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f1419;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .new-empty-text {
            font-size: 15px;
            color: #536471;
            margin-bottom: 24px;
            line-height: 1.5;
            max-width: 320px;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }
        
        .new-empty-cta {
            display: inline-block;
            padding: 12px 24px;
            background: #E50914;
            color: white;
            border: none;
            border-radius: 9999px;
            font-size: 15px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            text-decoration: none;
            transition: opacity 0.2s;
        }
        
        .new-empty-cta:hover {
            opacity: 0.9;
        }
        
        /* ========== MY REQUESTS ROW STYLES ========== */
        .new-request-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid #eff3f4;
            transition: background-color 0.15s;
        }
        
        .new-request-row:hover {
            background-color: #f7f9f9;
        }
        
        .new-request-content {
            flex: 1;
            min-width: 0;
        }
        
        .new-request-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 4px;
            flex-wrap: wrap;
        }
        
        .new-request-title {
            font-size: 15px;
            font-weight: 600;
            color: #0f1419;
        }
        
        .new-request-badges {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .new-request-intent {
            font-size: 12px;
            color: #536471;
            background: #eff3f4;
            padding: 2px 8px;
            border-radius: 9999px;
        }
        
        .new-request-status {
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 9999px;
        }
        
        .new-request-status.active,
        .new-request-status.waiting {
            color: #1d9bf0;
            background: rgba(29, 155, 240, 0.1);
        }
        
        .new-request-status.matched {
            color: #00ba7c;
            background: rgba(0, 186, 124, 0.1);
        }
        
        .new-request-status.completed {
            color: #536471;
            background: #eff3f4;
        }
        
        .new-request-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .new-request-time {
            font-size: 13px;
            color: #536471;
        }
        
        .new-request-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .new-request-action {
            font-size: 13px;
            color: #536471;
            background: none;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-family: inherit;
            transition: background-color 0.15s, color 0.15s;
        }
        
        .new-request-action:hover {
            background: #eff3f4;
            color: #0f1419;
        }
        
        /* Referrals Page - CENTERED CANVAS when empty */
        .new-referral-centered {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 32px;
            text-align: center;
            min-height: calc(100vh - 53px);
        }
        
        .new-referral-inner {
            max-width: 400px;
            width: 100%;
        }
        
        .new-referral-intro {
            margin-bottom: 32px;
        }
        
        .new-referral-intro-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f1419;
            margin-bottom: 8px;
        }
        
        .new-referral-intro-text {
            font-size: 15px;
            color: #536471;
        }
        
        .new-referral-form {
            padding: 16px;
            font-size: 15px;
            color: #536471;
        }
        
        .new-referral-form {
            text-align: left;
        }
        
        .new-referral-input {
            width: 100%;
            padding: 14px 16px;
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            color: #0f1419;
            outline: none;
            transition: all 0.2s;
            margin-bottom: 12px;
        }
        
        .new-referral-input:focus {
            border-color: #E50914;
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
        }
        
        .new-referral-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .new-referral-submit {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 24px;
            background: #E50914;
            color: white;
            border: none;
            border-radius: 9999px;
            font-size: 16px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: 8px;
        }
        
        .new-referral-submit:hover {
            opacity: 0.9;
        }
        
        /* Settings Page */
        .new-settings-section {
            border-bottom: 1px solid #eff3f4;
        }
        
        .new-settings-section-title {
            font-size: 20px;
            font-weight: 800;
            color: #0f1419;
            padding: 12px 16px;
        }
        
        .new-settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .new-settings-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }
        
        .new-settings-item-title {
            font-size: 15px;
            font-weight: 500;
            color: #0f1419;
        }
        
        .new-settings-item-desc {
            font-size: 13px;
            color: #536471;
            margin-top: 2px;
        }
        
        .new-settings-toggle {
            width: 44px;
            height: 24px;
            background: #cfd9de;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .new-settings-toggle.active {
            background: #E50914;
        }
        
        .new-settings-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        
        .new-settings-toggle.active::after {
            transform: translateX(20px);
        }
        
        /* Intent Segmented Control */
        .intent-segmented {
            display: flex;
            background: #eff3f4;
            border-radius: 8px;
            padding: 3px;
            gap: 2px;
        }
        
        .intent-seg-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #536471;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .intent-seg-btn:hover {
            color: #0f1419;
        }
        
        .intent-seg-btn.active {
            background: #fff;
            color: #0f1419;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .new-settings-arrow {
            color: #536471;
        }
        
        /* Profile Modal */
        .new-profile-modal {
            max-width: 480px;
            border-radius: 12px;
        }
        
        .new-profile-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #eff3f4;
        }
        
        .new-profile-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #0f1419;
        }
        
        .new-profile-modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: none;
            border-radius: 50%;
            cursor: pointer;
            color: #536471;
            transition: background 0.2s;
        }
        
        .new-profile-modal-close:hover {
            background: #eff3f4;
        }
        
        .new-profile-modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .new-profile-photo-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .new-profile-photo-large {
            width: 88px;
            height: 88px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 600;
            color: white;
            overflow: hidden;
            cursor: pointer;
        }
        
        .new-profile-photo-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .new-profile-change-photo {
            margin-top: 12px;
            background: none;
            border: none;
            color: #E50914;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
        }
        
        .new-profile-section {
            margin-bottom: 24px;
        }
        
        .new-profile-section-label {
            font-size: 11px;
            font-weight: 600;
            color: #536471;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }
        
        .new-profile-form-row {
            display: flex;
            gap: 12px;
        }
        
        .new-profile-form-group {
            margin-bottom: 16px;
        }
        
        .new-profile-form-group.flex-1 {
            flex: 1;
        }
        
        .new-profile-field-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #0f1419;
            margin-bottom: 8px;
        }
        
        .new-profile-input {
            width: 100%;
            padding: 12px 14px;
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            color: #0f1419;
            outline: none;
            transition: all 0.2s;
        }
        
        .new-profile-input:focus {
            border-color: #E50914;
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
        }
        
        .new-profile-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .new-profile-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23536471' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
            cursor: pointer;
        }
        
        .new-profile-link-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .new-profile-link-icon {
            font-size: 16px;
        }
        
        .new-profile-required {
            margin-left: auto;
            font-size: 12px;
            color: #E50914;
            font-weight: 500;
        }
        
        .new-profile-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid #eff3f4;
        }
        
        .new-profile-btn-cancel {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #536471;
            font-size: 15px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            border-radius: 8px;
        }
        
        .new-profile-btn-save {
            padding: 10px 24px;
            background: #e1e4e8;
            border: none;
            color: #8b98a5;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: not-allowed;
            border-radius: 8px;
        }
        
        .new-profile-btn-save.enabled {
            background: #0f1419;
            color: white;
            cursor: pointer;
        }
        
        /* Intent Selector */
        .new-intent-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .new-intent-option {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            border: 1px solid #cfd9de;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            color: #536471;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .new-intent-option:hover {
            border-color: #0f1419;
            color: #0f1419;
        }
        
        .new-intent-option.active {
            background: #0f1419;
            border-color: #0f1419;
            color: white;
            font-weight: 700;
        }
        
        .new-intent-helper {
            font-size: 13px;
            color: #536471;
            margin-bottom: 8px;
        }
        
        .new-intent-refine-btn {
            background: none;
            border: none;
            color: #E50914;
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            padding: 0;
            margin-bottom: 12px;
        }
        
        .new-intent-refine-panel {
            padding: 16px;
            background: #f7f9f9;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .new-collab-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .new-collab-tag {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #cfd9de;
            border-radius: 9999px;
            font-size: 14px;
            font-family: inherit;
            color: #536471;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .new-collab-tag:hover {
            border-color: #0f1419;
            color: #0f1419;
        }
        
        .new-collab-tag.active {
            background: #eff3f4;
            border-color: #0f1419;
            color: #0f1419;
        }
        
        /* Match type badges */
        .new-match-type {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 4px;
            margin-right: 8px;
        }
        
        .new-match-type.professional {
            background: rgba(29, 155, 240, 0.15);
            color: #1d9bf0;
        }
        
        .new-match-type.community {
            background: rgba(0, 186, 124, 0.15);
            color: #00ba7c;
        }
        
        /* New App Mobile Styles */
        @media (max-width: 1024px) {
            .new-right-column {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .new-app-container {
                flex-direction: column;
            }
            
            /* Hide sidebar by default on mobile - slides in from right */
            .new-sidebar {
                position: fixed;
                top: 0;
                right: 0;
                left: auto;
                bottom: 0;
                width: 280px;
                height: 100%;
                flex-direction: column;
                justify-content: flex-start;
                padding: 20px;
                border-left: 1px solid #eff3f4;
                border-right: none;
                background: white;
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            
            .new-sidebar.mobile-open {
                transform: translateX(0);
            }
            
            /* Show all sidebar elements when open */
            .new-sidebar .new-sidebar-logo,
            .new-sidebar .new-sidebar-label,
            .new-sidebar .new-sidebar-profile,
            .new-sidebar .new-sidebar-cta,
            .new-sidebar .new-sidebar-sublink,
            .new-sidebar .new-sidebar-bottom {
                display: flex;
            }
            
            .new-sidebar-logo {
                display: none;
            }
            
            .new-sidebar-expand {
                display: none;
            }
            
            .new-sidebar-nav {
                flex-direction: column;
                width: 100%;
            }
            
            .new-sidebar-link {
                padding: 14px 12px;
            }
            
            .new-sidebar-label {
                display: inline !important;
            }
            
            .new-sidebar-bottom {
                margin-top: auto;
                display: flex !important;
                flex-direction: column;
            }
            
            .new-sidebar-cta {
                display: flex !important;
            }
            
            .new-sidebar-profile {
                display: flex !important;
            }
            
            .new-main-column {
                max-width: 100%;
                border-right: none;
                padding-bottom: 20px;
            }
            
            /* Hide page-level headers on mobile - we use mobile header instead */
            .new-main-header {
                display: none;
            }
            
            /* Mobile header with hamburger */
            .mobile-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 16px;
                background: white;
                border-bottom: 1px solid #eff3f4;
                position: sticky;
                top: 0;
                z-index: 99;
            }
            
            .mobile-hamburger {
                width: 40px;
                height: 40px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 5px;
                background: none;
                border: none;
                cursor: pointer;
                padding: 8px;
                order: 2;
            }
            
            .mobile-hamburger span {
                display: block;
                width: 22px;
                height: 2px;
                background: #0f1419;
                border-radius: 2px;
                transition: all 0.3s ease;
            }
            
            .mobile-header-title {
                font-size: 18px;
                font-weight: 700;
                color: #0f1419;
                order: 1;
            }
            
            .mobile-header-spacer {
                display: none;
            }
            
            /* Overlay when menu is open */
            .mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }
            
            .mobile-overlay.active {
                display: block;
            }
        }
        
        /* Hide mobile header on desktop */
        @media (min-width: 769px) {
            .mobile-header,
            .mobile-overlay {
                display: none !important;
            }
        }
    </style>
    <link rel="stylesheet" href="mobile-fix.css">
</head>
<body>
    <!-- ========== LANDING PAGE ========== -->
    <div class="page active" id="landingPage">
        <header class="header">
            <span class="logo" onclick="handleLogoClick()">T</span>
            <a class="header-signin" onclick="openSignIn()">Sign in</a>
        </header>
        
        <section class="hero">
            <div class="hero-text">
                <h1>Tell Taj <span>who</span> you need.<br>Get introduced.</h1>
                <p class="subtitle">One message. Real human connections  connecting <span class="rotating-word"><span class="word active">artists</span><span class="word">creators</span><span class="word">operators</span><span class="word">singers</span><span class="word">producers</span></span></p>
                
                <button class="cta-button" onclick="openSignUp()">Request an introduction</button>
                <p class="signin-link">Already have an account? <a onclick="openSignIn()">Sign in</a></p>
            </div>
            
            <div class="hero-visual">
                <div class="phone-container">
                    <!-- Conversation 1: Music Producer (User starts) -->
                    <div class="message-bubble bubble-outgoing bubble-1">I need a producer for my R&B track</div>
                    <div class="message-bubble bubble-incoming bubble-2">What's your budget?</div>
                    <div class="message-bubble bubble-outgoing bubble-3">$2-3k, ready to start next week</div>
                    <div class="message-bubble bubble-incoming bubble-4">Found 2 producers. Connecting you now.</div>
                    
                    <!-- Conversation 2: Makeup Artist (Taj starts) -->
                    <div class="message-bubble bubble-incoming bubble-5">Makeup artist needed for music video. $800/day. Interested?</div>
                    <div class="message-bubble bubble-outgoing bubble-6">When's the shoot?</div>
                    <div class="message-bubble bubble-incoming bubble-7">This Saturday</div>
                    <div class="message-bubble bubble-outgoing bubble-8">I'm in</div>
                    
                    <!-- Conversation 3: Video Editor (User starts) -->
                    <div class="message-bubble bubble-outgoing bubble-9">Looking for a video editor for my YouTube channel</div>
                    <div class="message-bubble bubble-incoming bubble-10">What type of content?</div>
                    <div class="message-bubble bubble-outgoing bubble-11">Vlogs, 10-15 min episodes</div>
                    <div class="message-bubble bubble-incoming bubble-12">Got 3 editors. Sending intros now.</div>
                    
                    <div class="phone-frame">
                        <img class="frame" src="Iphone_Telegram_Photo.png" alt="TapinX">
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- ========== EDIT PROFILE PAGE ========== -->
    <div class="page" id="editProfilePage">
        <header class="header">
            <button class="header-btn" onclick="showPage('dashboard')">Cancel</button>
            <h1 class="header-title">Edit Profile</h1>
            <button class="header-btn done" id="doneBtn" onclick="saveProfile()">Done</button>
        </header>
        
        <main class="profile-main">
            <section class="photo-section">
                <div class="photo-container" onclick="document.getElementById('photoInput').click()">
                    <div class="photo-placeholder" id="photoPlaceholder">T</div>
                    <img id="photoPreview" style="display: none;">
                </div>
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhoto(this)">
                <button class="change-photo-btn" onclick="document.getElementById('photoInput').click()">Change Profile Photo</button>
            </section>
            
            <section class="form-section">
                <div class="form-row">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="nameInput" placeholder="Name" oninput="checkForm()">
                </div>
                <div class="form-row">
                    <label class="form-label">Age</label>
                    <select class="age-select" id="ageInput">
                        <option value="">Select</option>
                        <script>for(let i=18;i<=80;i++)document.write('<option value="'+i+'">'+i+'</option>');</script>
                    </select>
                </div>
                <div class="form-row bio-row">
                    <label class="form-label">Bio</label>
                    <textarea class="bio-input" id="bioInput" placeholder="Bio"></textarea>
                </div>
            </section>
            
            <div class="section-header">Links</div>
            <section class="form-section">
                <div class="social-row">
                    <div class="social-icon"></div>
                    <div class="social-input-wrapper">
                        <input type="url" class="social-input" id="linkedinInput" placeholder="LinkedIn URL" oninput="validateAllSocials()">
                        <span class="required-text" id="linkedinRequired">Required</span>
                        <span class="social-status empty" id="linkedinStatus"></span>
                    </div>
                </div>
                <div class="social-row">
                    <div class="social-icon"></div>
                    <div class="social-input-wrapper">
                        <input type="url" class="social-input" id="instagramInput" placeholder="Instagram URL" oninput="validateAllSocials()">
                        <span class="social-status empty" id="instagramStatus"></span>
                    </div>
                </div>
                <div class="social-row">
                    <div class="social-icon"></div>
                    <div class="social-input-wrapper">
                        <input type="url" class="social-input" id="twitterInput" placeholder="X (Twitter) URL" oninput="validateAllSocials()">
                        <span class="social-status empty" id="twitterStatus"></span>
                    </div>
                </div>
                <div class="social-row">
                    <div class="social-icon"></div>
                    <div class="social-input-wrapper">
                        <input type="url" class="social-input" id="soundcloudInput" placeholder="SoundCloud URL" oninput="validateAllSocials()">
                        <span class="social-status empty" id="soundcloudStatus"></span>
                    </div>
                </div>
                <div class="social-row">
                    <div class="social-icon"></div>
                    <div class="social-input-wrapper">
                        <input type="url" class="social-input" id="imdbInput" placeholder="IMDB URL" oninput="validateAllSocials()">
                        <span class="social-status empty" id="imdbStatus"></span>
                    </div>
                </div>
            </section>
            <div style="height: 50px;"></div>
        </main>
        
        <div class="toast" id="toast">Profile saved!</div>
    </div>
    
    <!-- ========== DASHBOARD PAGE ========== -->
    <div class="page" id="dashboardPage">
        <div class="new-app-container">
            <!-- Mobile Overlay -->
            <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
            
            <!-- Mobile Header -->
            <div class="mobile-header">
                <button class="mobile-hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <span class="mobile-header-title" id="mobileHeaderTitle">Speak to Taj</span>
                <div class="mobile-header-spacer"></div>
            </div>
            
            <!-- Left Sidebar -->
            <aside class="new-sidebar" id="mobileSidebar">
                <div class="new-sidebar-logo">
                    <span class="new-sidebar-logo-text" onclick="handleLogoClick()">T</span>
                </div>
                
                <nav class="new-sidebar-nav">
                    <div class="new-sidebar-section">
                        <div class="new-sidebar-link active" id="navOpportunities" onclick="showNewAppPage('opportunities'); closeMobileMenu();">
                            <svg class="new-sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                            <span class="new-sidebar-label">Opportunities</span>
                            <span class="new-sidebar-badge" id="opportunitiesBadge" style="display: none;">0</span>
                        </div>
                        <div class="new-sidebar-expand" id="opportunitiesExpand" style="display: none;">
                            <div class="new-sidebar-sublink active" onclick="filterOpportunitiesFromSidebar('all')">All</div>
                            <div class="new-sidebar-sublink" onclick="filterOpportunitiesFromSidebar('professional')">Professional</div>
                            <div class="new-sidebar-sublink" onclick="filterOpportunitiesFromSidebar('community')">Community</div>
                            <div class="new-sidebar-sublink" onclick="filterOpportunitiesFromSidebar('archive')">Archive</div>
                        </div>
                    </div>
                    
                    <div class="new-sidebar-section">
                        <div class="new-sidebar-link" id="navRequests" onclick="showNewAppPage('requests'); closeMobileMenu();">
                            <svg class="new-sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            <span class="new-sidebar-label">My Requests</span>
                            <span class="new-sidebar-badge" id="requestsBadge" style="display: none;">0</span>
                        </div>
                        <div class="new-sidebar-expand" id="requestsExpand">
                            <div class="new-sidebar-sublink active" onclick="filterRequestsFromSidebar('all')">All</div>
                            <div class="new-sidebar-sublink" onclick="filterRequestsFromSidebar('active')">Active</div>
                            <div class="new-sidebar-sublink" onclick="filterRequestsFromSidebar('matched')">Matched</div>
                            <div class="new-sidebar-sublink" onclick="filterRequestsFromSidebar('completed')">Completed</div>
                        </div>
                    </div>
                    
                    <div class="new-sidebar-section">
                        <div class="new-sidebar-link" id="navConnections" onclick="showNewAppPage('connections'); closeMobileMenu();">
                            <svg class="new-sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <span class="new-sidebar-label">My Connections</span>
                        </div>
                        <div class="new-sidebar-expand" id="connectionsExpand">
                            <div class="new-sidebar-sublink active" onclick="filterNewConnections('all')">All</div>
                            <div class="new-sidebar-sublink" onclick="filterNewConnections('connected')">Connected</div>
                            <div class="new-sidebar-sublink" onclick="filterNewConnections('pending')">Pending</div>
                        </div>
                    </div>
                    
                    <div class="new-sidebar-section">
                        <div class="new-sidebar-link" id="navSettings" onclick="showNewAppPage('settings'); closeMobileMenu();">
                            <svg class="new-sidebar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                            </svg>
                            <span class="new-sidebar-label">Settings</span>
                        </div>
                    </div>
                </nav>
                
                <!-- BOTTOM ZONE - CTA + Profile (fixed at bottom) -->
                <div class="new-sidebar-bottom">
                    <a href="https://t.me/TapinXBot" target="_blank" class="new-sidebar-cta">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>
                        Start Texting
                    </a>
                    
                    <div class="new-sidebar-profile" onclick="openNewEditProfile()">
                        <div class="new-sidebar-avatar">
                            <span id="newSidebarAvatarInitial">T</span>
                            <img id="newSidebarAvatarImg" style="display: none;">
                        </div>
                        <div class="new-sidebar-profile-info">
                            <div class="new-sidebar-profile-name" id="newSidebarName">User</div>
                            <div class="new-sidebar-profile-handle">Edit profile</div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Main Column -->
            <main class="new-main-column">
                <!-- Speak to Taj Page - CENTERED CANVAS -->
                <div id="newSpeakPage" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">Speak to Taj</h1>
                    </header>
                    <div class="new-speak-content">
                        <div class="new-speak-inner">
                            <h2 class="new-speak-title">One message.<br>Real introductions.</h2>
                            <p class="new-speak-subtitle">Tell Taj who you're looking for. Taj finds the right person and makes the introduction.</p>
                            <a href="https://t.me/TapinXBot" target="_blank" class="new-speak-cta">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                </svg>
                                Message Taj on Telegram
                            </a>
                            <div class="new-speak-meta">
                                <div class="new-speak-meta-line">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                    </svg>
                                    <span>Secure on Telegram</span>
                                </div>
                                <div class="new-speak-meta-line">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    <span>Typically responds within 24 hours</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- My Connections Page - TOP-ALIGNED -->
                <div id="newConnectionsPage" class="top-canvas" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">My Connections</h1>
                    </header>
                    <div class="new-tabs">
                        <button class="new-tab active" onclick="setNewConnectionsTab(this, 'all')">All</button>
                        <button class="new-tab" onclick="setNewConnectionsTab(this, 'connected')">Connected</button>
                        <button class="new-tab" onclick="setNewConnectionsTab(this, 'pending')">Pending</button>
                    </div>
                    <div id="newConnectionsList"></div>
                    <div class="new-empty-state" id="newConnectionsEmpty">
                        <svg class="new-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <h3 class="new-empty-title">Your network starts here</h3>
                        <p class="new-empty-text">Tell Taj who you're looking to meet. Once an introduction is made, your connections will appear here.</p>
                        <a href="https://t.me/TapinXBot" target="_blank" class="new-empty-cta">Message Taj</a>
                    </div>
                </div>
                
                <!-- Opportunities Page -->
                <div id="newOpportunitiesPage" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">Opportunities</h1>
                    </header>
                    <div class="new-tabs">
                        <button class="new-tab active" onclick="filterNewOpportunities('all', this)">All</button>
                        <button class="new-tab" onclick="filterNewOpportunities('professional', this)">Professional</button>
                        <button class="new-tab" onclick="filterNewOpportunities('community', this)">Community</button>
                        <button class="new-tab" onclick="filterNewOpportunities('archive', this)">Archive</button>
                    </div>
                    <div class="invite-banner" style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #f8f9fa; border-radius: 10px; margin-bottom: 16px;">
                        <span style="color: #536471; font-size: 14px;">Know someone who'd benefit from TapinX?</span>
                        <button onclick="inviteFriend()" style="background: #0f1419; color: white; border: none; padding: 8px 16px; border-radius: 9999px; font-size: 13px; font-weight: 600; cursor: pointer;">Invite a Friend</button>
                    </div>
                    <div id="newOpportunitiesList"></div>
                    <div class="new-empty-state" id="newOpportunitiesEmpty">
                        <svg class="new-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                        <h3 class="new-empty-title">You're all caught up</h3>
                        <p class="new-empty-text">Taj will surface opportunities aligned with your intent. Check back soon or update your preferences in Settings.</p>
                        
                        <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #eee;">
                            <p style="color: #536471; font-size: 14px; margin-bottom: 12px;">Know someone who'd benefit from TapinX?</p>
                            <button onclick="inviteFriend()" style="background: #0f1419; color: white; border: none; padding: 12px 24px; border-radius: 9999px; font-size: 15px; font-weight: 600; cursor: pointer;">Invite a Friend</button>
                        </div>
                    </div>
                </div>
                
                <!-- Referrals Page - CENTERED CANVAS -->
                <div id="newReferralsPage" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">Referrals</h1>
                    </header>
                    <div class="new-referral-centered">
                        <div class="new-referral-inner">
                            <div class="new-referral-intro">
                                <div class="new-referral-intro-title">Know someone who'd benefit?</div>
                                <div class="new-referral-intro-text">We'll introduce them if it aligns with their intent.</div>
                            </div>
                            <div class="new-referral-form">
                                <input type="text" class="new-referral-input" id="newReferralName" placeholder="Their name">
                                <input type="text" class="new-referral-input" id="newReferralContact" placeholder="Phone number">
                                <textarea class="new-referral-input new-referral-textarea" id="newReferralContext" placeholder="What are they looking for? How can Taj help them?"></textarea>
                                <button class="new-referral-submit" onclick="submitNewReferral()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                        <polyline points="16 6 12 2 8 6"/>
                                        <line x1="12" y1="2" x2="12" y2="15"/>
                                    </svg>
                                    Send Referral
                                </button>
                                <p class="new-referral-note">Taj will reach out to them directly via text.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- My Requests Page -->
                <div id="newRequestsPage" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">My Requests</h1>
                        <p class="new-main-subtitle">Track all the introductions you've asked Taj to make.</p>
                    </header>
                    <div class="new-tabs">
                        <button class="new-tab active" onclick="filterRequests('all', this)">All</button>
                        <button class="new-tab" onclick="filterRequests('active', this)">Active</button>
                        <button class="new-tab" onclick="filterRequests('matched', this)">Matched</button>
                        <button class="new-tab" onclick="filterRequests('completed', this)">Completed</button>
                    </div>
                    <div id="newRequestsList"></div>
                    <div class="new-empty-state" id="newRequestsEmpty">
                        <svg class="new-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <h3 class="new-empty-title">You haven't made any requests yet</h3>
                        <p class="new-empty-text">Tell Taj who you're looking to meet and your requests will appear here.</p>
                        <a href="https://t.me/TapinXBot" target="_blank" class="new-empty-cta">Message Taj</a>
                    </div>
                </div>
                
                <!-- Settings Page - TOP-ALIGNED -->
                <div id="newSettingsPage" class="top-canvas" style="display: none;">
                    <header class="new-main-header">
                        <h1 class="new-main-title">Settings</h1>
                    </header>
                    
                    <div class="new-settings-section">
                        <div class="new-settings-section-title">Matching Preferences</div>
                        
                        <!-- Primary Intent Selector - Segmented Control -->
                        <div class="new-settings-item">
                            <div>
                                <div class="new-settings-item-title">Primary Intent</div>
                                <div class="new-settings-item-desc">What type of connections are you looking for?</div>
                            </div>
                            <div class="intent-segmented">
                                <button class="intent-seg-btn active" data-intent="professional" onclick="setIntent('professional', this)">
                                    Professional
                                </button>
                                <button class="intent-seg-btn" data-intent="community" onclick="setIntent('community', this)">
                                    Community
                                </button>
                            </div>
                        </div>
                        
                        <div class="new-settings-item">
                            <div>
                                <div class="new-settings-item-title">Pause matching</div>
                                <div class="new-settings-item-desc">Temporarily stop receiving opportunities</div>
                            </div>
                            <div class="new-settings-toggle" onclick="this.classList.toggle('active')"></div>
                        </div>
                    </div>
                    
                    <div class="new-settings-section">
                        <div class="new-settings-section-title">Privacy</div>
                        <div class="new-settings-item">
                            <div>
                                <div class="new-settings-item-title">Profile visibility</div>
                                <div class="new-settings-item-desc">Allow others to discover your profile</div>
                            </div>
                            <div class="new-settings-toggle active" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="new-settings-item" onclick="showBlockedContacts()">
                            <div>
                                <div class="new-settings-item-title">Blocked contacts</div>
                                <div class="new-settings-item-desc">Manage people you've blocked</div>
                            </div>
                            <svg class="new-settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                        </div>
                    </div>
                    
                    <div class="new-settings-section">
                        <div class="new-settings-section-title">Notifications</div>
                        <div class="new-settings-item">
                            <div>
                                <div class="new-settings-item-title">New opportunities</div>
                                <div class="new-settings-item-desc">Get notified when Taj finds a match</div>
                            </div>
                            <div class="new-settings-toggle active" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="new-settings-item">
                            <div>
                                <div class="new-settings-item-title">Connection updates</div>
                                <div class="new-settings-item-desc">When someone accepts your introduction</div>
                            </div>
                            <div class="new-settings-toggle active" onclick="this.classList.toggle('active')"></div>
                        </div>
                    </div>
                    
                    <div class="new-settings-section">
                        <div class="new-settings-section-title">Account</div>
                        <div class="new-settings-item" onclick="openNewEditProfile()">
                            <div>
                                <div class="new-settings-item-title">Edit profile</div>
                                <div class="new-settings-item-desc">Update your information and links</div>
                            </div>
                            <svg class="new-settings-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                        </div>
                        <div class="new-settings-item" onclick="logout()">
                            <div>
                                <div class="new-settings-item-title" style="color: #f4212e;">Log out</div>
                            </div>
                        </div>
                        <div class="new-settings-item" onclick="confirmDeleteAccount()">
                            <div>
                                <div class="new-settings-item-title" style="color: #536471;">Delete account</div>
                                <div class="new-settings-item-desc">Permanently remove your data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Right Column -->
            <aside class="new-right-column">
                <div class="new-right-card">
                    <div class="new-right-card-header">
                        <div class="new-right-card-title">Tasks</div>
                        <button class="new-task-add-btn" onclick="openAddTaskModal()" title="Add task">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Dynamic Tasks List -->
                    <div class="new-tasks-list" id="tasksList">
                        <!-- System tasks will be injected here -->
                    </div>
                    
                    <!-- Empty state -->
                    <div class="new-tasks-empty" id="tasksEmpty" style="display: none;">
                        <p>You're all caught up!</p>
                    </div>
                </div>
            </aside>
        </div>
        
        <!-- Add Task Modal -->
        <div class="task-modal-overlay" id="addTaskModal" onclick="closeAddTaskModal(event)">
            <div class="task-modal" onclick="event.stopPropagation()">
                <div class="task-modal-header">
                    <h3>Add Task</h3>
                    <button class="task-modal-close" onclick="closeAddTaskModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="task-modal-body">
                    <input type="text" class="task-modal-input" id="taskModalInput" placeholder="What do you need to do?" onkeypress="handleTaskModalKeypress(event)">
                    <textarea class="task-modal-textarea" id="taskModalNote" placeholder="Add a note (optional)"></textarea>
                </div>
                <div class="task-modal-footer">
                    <button class="task-modal-cancel" onclick="closeAddTaskModal()">Cancel</button>
                    <button class="task-modal-submit" onclick="addCustomTaskFromModal()">Add Task</button>
                </div>
            </div>
        </div>
        
        <!-- Connection Modal -->
        <div class="connection-modal-overlay" id="connectionModal" onclick="closeConnectionModal(event)">
            <div class="connection-modal" onclick="event.stopPropagation()">
                <div class="connection-modal-header">
                    <div class="connection-modal-avatar" id="connModalAvatar">M</div>
                    <div class="connection-modal-info">
                        <h3 class="connection-modal-name" id="connModalName">Name</h3>
                        <span class="connection-modal-status" id="connModalStatus">Connected</span>
                    </div>
                    <button class="connection-modal-close" onclick="closeConnectionModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="connection-modal-body">
                    <div class="connection-modal-section">
                        <div class="connection-modal-label">Connection Context</div>
                        <div class="connection-modal-value" id="connModalContextText"></div>
                    </div>
                    <div class="connection-modal-section" id="connModalBio" style="display: none;">
                        <div class="connection-modal-label">About</div>
                        <div class="connection-modal-value" id="connModalBioText"></div>
                    </div>
                    <div class="connection-modal-section" id="connModalSkills" style="display: none;">
                        <div class="connection-modal-label">Skills</div>
                        <div class="connection-modal-skills" id="connModalSkillsList"></div>
                    </div>
                    <div class="connection-modal-message" id="connModalMessage"></div>
                </div>
                <div class="connection-modal-footer" id="connModalFooter"></div>
            </div>
        </div>
        
        <!-- Request Details Modal -->
        <div class="request-modal-overlay" id="requestModal" onclick="closeRequestModal(event)">
            <div class="request-modal" onclick="event.stopPropagation()">
                <button class="request-modal-close" onclick="closeRequestModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
                <div class="request-modal-body">
                    <h2 class="request-modal-title" id="requestModalTitle">Graphic Designer</h2>
                    <span class="request-modal-status" id="requestModalStatus">In progress</span>
                    
                    <div class="request-modal-section">
                        <div class="request-modal-label">CATEGORY</div>
                        <div class="request-modal-value" id="requestModalCategory">Professional</div>
                    </div>
                    
                    <div class="request-modal-section">
                        <div class="request-modal-label">SKILLS NEEDED</div>
                        <div class="request-modal-skills" id="requestModalSkills"></div>
                    </div>
                    
                    <div class="request-modal-section">
                        <div class="request-modal-label">REQUESTED</div>
                        <div class="request-modal-value" id="requestModalDate">Dec 20, 2025</div>
                    </div>
                    
                    <div class="request-modal-section" id="requestModalMatchSection" style="display: none;">
                        <div class="request-modal-label">MATCH FOUND</div>
                        <div class="request-modal-value" id="requestModalMatch"></div>
                    </div>
                </div>
                <div class="request-modal-footer">
                    <button class="request-modal-btn primary" onclick="followUpRequestFromModal()">Follow up with Taj</button>
                    <button class="request-modal-btn secondary" onclick="closeRequestModal()">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== OPPORTUNITY DETAIL MODAL ========== -->
    <div class="opp-detail-overlay" id="oppDetailModal" onclick="closeOppDetailModal(event)">
        <div class="opp-detail-modal" onclick="event.stopPropagation()">
            <button class="opp-modal-close" onclick="closeOppDetailModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="opp-detail-body">
                <div class="opp-detail-header">
                    <div class="opp-detail-avatar" id="oppDetailAvatar">S</div>
                    <div class="opp-detail-info">
                        <h2 class="opp-detail-name" id="oppDetailName">Sarah Johnson</h2>
                        <p class="opp-detail-bio" id="oppDetailBio">Marketing agency owner</p>
                    </div>
                </div>
                
                <div class="opp-detail-section">
                    <div class="opp-detail-label">LOOKING FOR</div>
                    <h3 class="opp-detail-title" id="oppDetailTitle">Video Editor for Social Media</h3>
                </div>
                
                <div class="opp-detail-section">
                    <div class="opp-detail-label">DESCRIPTION</div>
                    <p class="opp-detail-desc" id="oppDetailDesc">Looking for a video editor who can create engaging short-form content for TikTok and Instagram Reels.</p>
                </div>
                
                <div class="opp-detail-section" id="oppDetailSkillsSection">
                    <div class="opp-detail-label">SKILLS NEEDED</div>
                    <div class="opp-detail-skills" id="oppDetailSkills"></div>
                </div>
                
                <div class="opp-detail-section">
                    <div class="opp-detail-label">MATCH SCORE</div>
                    <div class="opp-detail-score" id="oppDetailScore">88% match</div>
                </div>
            </div>
            
            <div class="opp-detail-footer">
                <button class="opp-detail-btn primary" onclick="handleOppInterested()">I'm Interested</button>
                <button class="opp-detail-btn secondary" onclick="handleOppDecline()">Not for me</button>
                <button class="opp-detail-btn tertiary" onclick="handleOppRefer()">Refer a Friend</button>
            </div>
        </div>
    </div>
    
    <!-- ========== REFERRAL CONFIRMATION MODAL ========== -->
    <div class="refer-confirm-overlay" id="referConfirmModal" onclick="closeReferConfirmModal(event)">
        <div class="refer-confirm-modal" onclick="event.stopPropagation()">
            <button class="opp-modal-close" onclick="closeReferConfirmModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="refer-confirm-body">
                <div class="refer-confirm-icon"></div>
                <h2 class="refer-confirm-title">Refer this opportunity</h2>
                <p class="refer-confirm-subtitle">You're about to refer "<span id="referConfirmOppTitle">Video Editor</span>" to a friend.</p>
                
                <div class="refer-confirm-input-group">
                    <label class="refer-confirm-label">Friend's name (optional)</label>
                    <input type="text" class="refer-confirm-input" id="referFriendName" placeholder="Enter their name">
                </div>
            </div>
            
            <div class="refer-confirm-footer">
                <button class="opp-detail-btn primary" onclick="sendReferral()">Send Referral</button>
                <button class="opp-detail-btn secondary" onclick="closeReferConfirmModal()">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- ========== SUCCESS CELEBRATION MODAL ========== -->
    <div class="refer-success-overlay" id="referSuccessModal" onclick="closeReferSuccessModal(event)">
        <div class="refer-success-modal" onclick="event.stopPropagation()">
            <div class="refer-success-body">
                <div class="refer-success-icon"></div>
                <h2 class="refer-success-title">Referral Sent!</h2>
                <p class="refer-success-subtitle">This opportunity has been moved to your Archive. Your friend will receive a link to check it out.</p>
            </div>
            
            <div class="refer-success-footer">
                <button class="opp-detail-btn primary" onclick="goToArchive()">View Archive</button>
                <button class="opp-detail-btn secondary" onclick="closeReferSuccessModal()">Done</button>
            </div>
        </div>
    </div>
    
    <!-- ========== DECLINE CONFIRMATION MODAL ========== -->
    <div class="decline-confirm-overlay" id="declineConfirmModal" onclick="closeDeclineConfirmModal(event)">
        <div class="decline-confirm-modal" onclick="event.stopPropagation()">
            <button class="opp-modal-close" onclick="closeDeclineConfirmModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="decline-confirm-body">
                <div class="decline-confirm-icon"></div>
                <h2 class="decline-confirm-title">Pass on this opportunity?</h2>
                <p class="decline-confirm-subtitle">This will move "<span id="declineConfirmOppTitle">Video Editor</span>" to your Archive.</p>
            </div>
            
            <div class="decline-confirm-footer">
                <button class="opp-detail-btn secondary" onclick="confirmDecline()">Yes, pass</button>
                <button class="opp-detail-btn primary" onclick="closeDeclineConfirmModal()">Keep it</button>
            </div>
        </div>
    </div>
    
    <!-- ========== CONNECTIONS PAGE ========== -->
    <div class="page workspace-page" id="connectionsPage">
        <header class="header workspace-header">
            <span class="logo" onclick="handleLogoClick()">T</span>
            <div class="profile-btn" onclick="toggleConnectionsDropdown(event)">
                <div class="avatar">
                    <span id="connAvatarInitial">T</span>
                    <img id="connAvatarImg" style="display: none;">
                </div>
                <span class="profile-name" id="connHeaderName">User</span>
                <span class="dropdown-arrow"></span>
                
                <div class="dropdown" id="connDropdown">
                    <div class="dropdown-item" onclick="openEditProfileModal()">
                        Edit Profile
                    </div>
                    <div class="dropdown-item" onclick="showPage('connections')">
                        Connections
                    </div>
                    <div class="dropdown-item" onclick="showPage('attention')">
                        Attention Required
                    </div>
                    <a href="https://t.me/TapinXBot" target="_blank" class="dropdown-item">
                        Speak to Taj
                    </a>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="logout()">
                        Logout
                    </div>
                </div>
            </div>
        </header>
        
        <div class="workspace-layout">
            <!-- Context Rail -->
            <aside class="context-rail">
                <div class="rail-profile">
                    <div class="rail-avatar">
                        <span id="connRailInitial">T</span>
                        <img id="connRailImg" style="display: none; width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                    </div>
                    <span class="rail-name" id="connRailName">User</span>
                </div>
                <nav class="rail-nav">
                    <div class="rail-link active" onclick="showPage('connections')">
                        My Connections
                        <span class="rail-link-count" id="railConnCount">0</span>
                    </div>
                    <div class="rail-link" id="railAttnLink" onclick="showPage('attention')">
                        Attention Required
                        <span class="rail-link-count" id="railAttnCount">0</span>
                    </div>
                </nav>
            </aside>
            
            <!-- Main Content -->
            <main class="workspace-main">
                <h1 class="workspace-title">My Connections</h1>
                
                <!-- Controls -->
                <div class="workspace-controls">
                    <div class="workspace-search">
                        <div class="workspace-search-input" id="connSearchBar">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                            <input type="text" placeholder="Search connections..." id="connSearchInput" oninput="filterConnections()">
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="workspace-tabs">
                    <button class="workspace-tab active" onclick="setConnStatus(this, 'all')">All<span class="workspace-tab-count" id="connAllCount">0</span></button>
                    <button class="workspace-tab" onclick="setConnStatus(this, 'pending')">Pending<span class="workspace-tab-count" id="connPendingCount">0</span></button>
                    <button class="workspace-tab" onclick="setConnStatus(this, 'connected')">Connected<span class="workspace-tab-count" id="connConnectedCount">0</span></button>
                </div>
                
                <!-- List Container -->
                <div class="workspace-list" id="connList">
                    <!-- Rows render here -->
                </div>
                
                <!-- Empty State -->
                <div class="workspace-empty" id="emptyConnections">
                    <div class="workspace-empty-title">No introductions yet</div>
                    <p class="workspace-empty-text">When Taj connects you with someone, they'll appear here.</p>
                    <a href="https://t.me/TapinXBot" target="_blank" class="workspace-empty-btn">Message Taj</a>
                    <p class="workspace-empty-note">You'll be notified when there's an update.</p>
                    
                    <!-- Skeleton -->
                    <div class="workspace-skeleton">
                        <div class="skeleton-avatar"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-line short"></div>
                            <div class="skeleton-line medium"></div>
                        </div>
                        <div class="skeleton-btn"></div>
                    </div>
                </div>
                
                <!-- Toast -->
                <div class="workspace-toast" id="connToast"></div>
            </main>
        </div>
    </div>
    
    <!-- ========== ATTENTION REQUIRED PAGE ========== -->
    <div class="page" id="attentionPage">
        <header class="header attention-header">
            <span class="logo" onclick="handleLogoClick()">T</span>
            <div class="profile-btn" onclick="toggleAttentionDropdown(event)">
                <div class="avatar">
                    <span id="attnAvatarInitial">T</span>
                    <img id="attnAvatarImg" style="display: none;">
                </div>
                <span class="profile-name" id="attnHeaderName">User</span>
                <span class="dropdown-arrow"></span>
                
                <div class="dropdown" id="attnDropdown">
                    <div class="dropdown-item" onclick="openEditProfileModal()">
                        Edit Profile
                    </div>
                    <div class="dropdown-item" onclick="showPage('connections')">
                        Connections
                    </div>
                    <div class="dropdown-item" onclick="showPage('attention')">
                        Attention Required
                    </div>
                    <a href="https://t.me/TapinXBot" target="_blank" class="dropdown-item">
                        Speak to Taj
                    </a>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="logout()">
                        Logout
                    </div>
                </div>
            </div>
        </header>
        
        <div class="workspace-layout">
            <!-- Context Rail -->
            <aside class="context-rail">
                <div class="rail-profile">
                    <div class="rail-avatar">
                        <span id="attnRailInitial">T</span>
                        <img id="attnRailImg" style="display: none; width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                    </div>
                    <span class="rail-name" id="attnRailName">User</span>
                </div>
                <nav class="rail-nav">
                    <div class="rail-link" onclick="showPage('connections')">
                        My Connections
                        <span class="rail-link-count" id="attnRailConnCount">0</span>
                    </div>
                    <div class="rail-link active" id="attnRailAttnLink" onclick="showPage('attention')">
                        Attention Required
                        <span class="rail-link-count" id="attnRailAttnCount">0</span>
                    </div>
                </nav>
            </aside>
            
            <!-- Main Content -->
            <main class="workspace-main">
                <h1 class="workspace-title">Attention Required</h1>
                
                <!-- Tabs -->
                <div class="workspace-tabs">
                    <button class="workspace-tab active" id="attnTabNeeds" onclick="setAttnStatusNew(this, 'active')">Needs Response<span class="workspace-tab-count" id="attnNeedsCount">0</span></button>
                    <button class="workspace-tab" onclick="setAttnStatusNew(this, 'interested')">Interested<span class="workspace-tab-count" id="attnInterestedCount">0</span></button>
                    <button class="workspace-tab" onclick="setAttnStatusNew(this, 'passed')">Passed<span class="workspace-tab-count" id="attnPassedCount">0</span></button>
                </div>
                
                <!-- List Container -->
                <div class="workspace-list" id="attnList">
                    <!-- Rows render here -->
                </div>
                
                <!-- Empty State - Needs Response -->
                <div class="workspace-empty" id="emptyAttnActive">
                    <div class="workspace-empty-title">You're all caught up</div>
                    <p class="workspace-empty-text">There are no introductions waiting right now.</p>
                    <p class="workspace-empty-note">Taj will notify you when there's something to review.</p>
                </div>
                
                <!-- Empty State - Interested -->
                <div class="workspace-empty" id="emptyAttnInterested" style="display: none;">
                    <div class="workspace-empty-title">No interested introductions</div>
                    <p class="workspace-empty-text">When you express interest, they'll appear here.</p>
                </div>
                
                <!-- Empty State - Passed -->
                <div class="workspace-empty" id="emptyAttnPassed" style="display: none;">
                    <div class="workspace-empty-title">No passed introductions</div>
                    <p class="workspace-empty-text">Introductions you pass on will appear here.</p>
                </div>
                
                <!-- Toast -->
                <div class="workspace-toast" id="attnToast"></div>
            </main>
        </div>
            
            <!-- Status Tabs -->
            <div class="attn-status-tabs">
                <button class="attn-status-tab active" onclick="setAttnStatus(this, 'active')">Needs Response<span class="attn-status-count" id="activeCount">6</span></button>
                <button class="attn-status-tab" onclick="setAttnStatus(this, 'interested')">Interested<span class="attn-status-count" id="interestedCount">0</span></button>
                <button class="attn-status-tab" onclick="setAttnStatus(this, 'passed')">Passed<span class="attn-status-count" id="passedCount">0</span></button>
            </div>
            
            <!-- Category Filter -->
            <div class="attn-filter-tabs">
                <button class="attn-tab active" onclick="setAttnFilter(this, 'all')">All <span class="attn-tab-count">6</span></button>
                <button class="attn-tab" onclick="setAttnFilter(this, 'jobs')">Jobs <span class="attn-tab-count">2</span></button>
                <button class="attn-tab" onclick="setAttnFilter(this, 'collabs')">Collabs <span class="attn-tab-count">2</span></button>
                <button class="attn-tab" onclick="setAttnFilter(this, 'speaking')">Speaking <span class="attn-tab-count">1</span></button>
                <button class="attn-tab" onclick="setAttnFilter(this, 'advisory')">Advisory <span class="attn-tab-count">1</span></button>
            </div>
            
            <div class="attn-proposals" id="attnProposals">
                <div class="proposal-card" data-type="jobs" data-status="active" data-id="1">
                    <div class="proposal-badge job">Job Opportunity</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  2 hours ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Head of Growth at TechFlow</h3>
                    <p class="proposal-company">TechFlow  Series A  B2B SaaS</p>
                    <p class="proposal-desc">Marcus is looking for a Head of Growth to lead their GTM strategy. Equity + competitive salary. Remote-friendly.</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">Remote</span>
                        <span class="proposal-detail">$150-180k + equity</span>
                        <span class="proposal-detail">Full-time</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Head of Growth at TechFlow')">Ask Taj more</button>
                    </div>
                </div>
                
                <div class="proposal-card" data-type="collabs" data-status="active" data-id="2">
                    <div class="proposal-badge collab">Collaboration</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  5 hours ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Co-write an EP with Kunaal Sharma</h3>
                    <p class="proposal-company">Music Collaboration  R&B/Soul</p>
                    <p class="proposal-desc">Kunaal is working on a 5-track EP and needs a female vocalist for 2 songs. He loved your SoundCloud demos!</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">2 tracks</span>
                        <span class="proposal-detail">Revenue split</span>
                        <span class="proposal-detail">Remote/Studio</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Co-write an EP with Kunaal Sharma')">Ask Taj more</button>
                    </div>
                </div>
                
                <div class="proposal-card" data-type="speaking" data-status="active" data-id="3">
                    <div class="proposal-badge speaking">Speaking</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  1 day ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Guest on "Future of Work" Podcast</h3>
                    <p class="proposal-company">50k+ listeners  Tech/Business</p>
                    <p class="proposal-desc">The host wants you to discuss AI in healthcare and your startup journey. 45-minute episode, recorded remotely.</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">Next Thursday</span>
                        <span class="proposal-detail">45 mins</span>
                        <span class="proposal-detail">Remote</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Guest on Future of Work Podcast')">Ask Taj more</button>
                    </div>
                </div>
                
                <div class="proposal-card" data-type="advisory" data-status="active" data-id="4">
                    <div class="proposal-badge advisory">Advisory</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  2 days ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Technical Advisor for FinanceAI</h3>
                    <p class="proposal-company">FinanceAI  Pre-seed  Fintech</p>
                    <p class="proposal-desc">Early-stage fintech startup needs a technical advisor. 2-3 hours/month, equity compensation.</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">2-3 hrs/month</span>
                        <span class="proposal-detail">0.25% equity</span>
                        <span class="proposal-detail">Remote</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Technical Advisor for FinanceAI')">Ask Taj more</button>
                    </div>
                </div>
                
                <div class="proposal-card" data-type="jobs" data-status="active" data-id="5">
                    <div class="proposal-badge job">Job Opportunity</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  3 days ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Founding Designer at Stealth Startup</h3>
                    <p class="proposal-company">Stealth  Seed  Consumer App</p>
                    <p class="proposal-desc">Ex-Google founders building a consumer social app. Looking for founding designer. Significant equity.</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">SF or Remote</span>
                        <span class="proposal-detail">$130-160k + 1-2%</span>
                        <span class="proposal-detail">Full-time</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Founding Designer at Stealth Startup')">Ask Taj more</button>
                    </div>
                </div>
                
                <div class="proposal-card" data-type="collabs" data-status="active" data-id="6">
                    <div class="proposal-badge collab">Collaboration</div>
                    <div class="proposal-header">
                        <div class="proposal-avatar" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">T</div>
                        <div class="proposal-meta">
                            <div class="proposal-from">From <strong>Taj</strong>  4 days ago</div>
                        </div>
                    </div>
                    <h3 class="proposal-title">Co-found AI Sales Tool</h3>
                    <p class="proposal-company">Looking for Technical Co-founder</p>
                    <p class="proposal-desc">Sarah has domain expertise in sales and $50k to bootstrap. Looking for a technical co-founder.</p>
                    <div class="proposal-details">
                        <span class="proposal-detail">50/50 equity</span>
                        <span class="proposal-detail">Ready to start</span>
                        <span class="proposal-detail">Remote-first</span>
                    </div>
                    <div class="proposal-actions">
                        <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                        <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                        <button class="proposal-btn tertiary" onclick="askTajMore(this, 'Co-found AI Sales Tool')">Ask Taj more</button>
                    </div>
                </div>
            </div>
            
            <!-- Empty states -->
            <div class="attn-empty" id="emptyActive" style="display: none;">
                <div class="attn-empty-title">All caught up!</div>
                <p class="attn-empty-text">No new opportunities right now. Check back soon or tell Taj what you're looking for.</p>
                <a href="https://t.me/TapinXBot" target="_blank" class="attn-empty-btn">Message Taj</a>
            </div>
            
            <div class="attn-empty" id="emptyInterested" style="display: none;">
                <div class="attn-empty-title">No interested opportunities yet</div>
                <p class="attn-empty-text">When you mark opportunities as interested, they'll appear here.</p>
            </div>
            
            <div class="attn-empty" id="emptyPassed" style="display: none;">
                <div class="attn-empty-title">No passed opportunities</div>
                <p class="attn-empty-text">Opportunities you pass on will appear here in case you change your mind.</p>
            </div>
            
            <!-- Toast notification -->
            <div class="attn-toast" id="attnToast"></div>
        </main>
    </div>
    
    <!-- ========== EDIT PROFILE MODAL (LinkedIn-style) ========== -->
    <div class="edit-profile-overlay" id="editProfileOverlay" onclick="closeEditProfileModal(event)">
        <div class="edit-profile-modal" onclick="event.stopPropagation()">
            <!-- Profile Building Overlay -->
            <div class="profile-building-overlay" id="profileBuildingOverlay">
                <div class="profile-building-spinner"></div>
                <div class="profile-building-text">Building your profile...</div>
                <div class="profile-building-subtext">Fetching data from your social links</div>
            </div>
            
            <div class="edit-modal-header">
                <h2 class="edit-modal-title">Edit Profile</h2>
                <button class="edit-modal-close" onclick="closeEditProfileModal()"></button>
            </div>
            
            <div class="edit-modal-body">
                <!-- Photo Section -->
                <div class="edit-photo-section">
                    <div class="edit-photo-container" onclick="document.getElementById('editPhotoInput').click()">
                        <div class="edit-photo-placeholder" id="editPhotoPlaceholder">T</div>
                        <img id="editPhotoPreview" style="display: none;">
                    </div>
                    <input type="file" id="editPhotoInput" accept="image/*" style="display: none;" onchange="handleEditPhoto(this)">
                    <button class="edit-change-photo" onclick="document.getElementById('editPhotoInput').click()">Change photo</button>
                </div>
                
                <!-- Identity Section -->
                <div class="edit-section">
                    <div class="edit-section-title">Identity</div>
                    
                    <div class="edit-form-row">
                        <div class="edit-form-group">
                            <label class="edit-label">Name</label>
                            <input type="text" class="edit-input" id="editNameInput" placeholder="Your full name" oninput="checkEditForm()">
                        </div>
                        <div class="edit-form-group small">
                            <label class="edit-label">Age</label>
                            <select class="edit-select" id="editAgeInput" onchange="checkEditForm()">
                                <option value=""></option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- About Section -->
                <div class="edit-section">
                    <div class="edit-section-title">About</div>
                    
                    <div class="edit-form-group">
                        <label class="edit-label">Bio</label>
                        <textarea class="edit-textarea" id="editBioInput" placeholder="Tell people about yourself..."></textarea>
                    </div>
                </div>
                
                <!-- Skills Section -->
                <div class="edit-section">
                    <div class="edit-section-title">Top Skills</div>
                    <p class="edit-section-desc">Select up to 5 skills you want to be known for</p>
                    
                    <div class="skills-input-wrapper">
                        <input type="text" class="skills-search-input" id="skillsSearchInput" placeholder="Search or add a skill..." oninput="filterSkills(this.value)" onfocus="showSkillsDropdown()" autocomplete="off">
                        <div class="skills-dropdown" id="skillsDropdown"></div>
                    </div>
                    
                    <div class="selected-skills" id="selectedSkills">
                        <!-- Selected skill tags will appear here -->
                    </div>
                    
                    <div class="skills-categories">
                        <button class="skills-category-btn active" onclick="showSkillCategory('all', this)">All</button>
                        <button class="skills-category-btn" onclick="showSkillCategory('tech', this)">Tech</button>
                        <button class="skills-category-btn" onclick="showSkillCategory('creative', this)">Creative</button>
                        <button class="skills-category-btn" onclick="showSkillCategory('business', this)">Business</button>
                        <button class="skills-category-btn" onclick="showSkillCategory('other', this)">Other</button>
                    </div>
                    
                    <div class="skills-grid" id="skillsGrid">
                        <!-- Skill options will be populated by JS -->
                    </div>
                </div>
                
                <!-- Links Section -->
                <div class="edit-section">
                    <div class="edit-section-title">Links</div>
                    
                    <div class="edit-link-item">
                        <div class="edit-link-label">
                            <span class="edit-link-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#E4405F">
                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                </svg>
                            </span>
                            Instagram
                            <span class="edit-link-required">Required</span>
                        </div>
                        <div class="edit-input-wrapper">
                            <input type="url" class="edit-input" id="editInstagramInput" placeholder="instagram.com/yourprofile" oninput="validateEditLinks()">
                            <span class="edit-validation-icon" id="editInstagramStatus"></span>
                        </div>
                    </div>
                    
                    <div class="edit-link-item">
                        <div class="edit-link-label">
                            <span class="edit-link-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#0A66C2">
                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                </svg>
                            </span>
                            LinkedIn
                        </div>
                        <div class="edit-input-wrapper">
                            <input type="url" class="edit-input" id="editLinkedinInput" placeholder="linkedin.com/in/yourprofile" oninput="validateEditLinks()">
                            <span class="edit-validation-icon" id="editLinkedinStatus"></span>
                        </div>
                    </div>
                    
                    <div class="edit-link-item">
                        <div class="edit-link-label">
                            <span class="edit-link-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#000000">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                            </span>
                            X (Twitter)
                        </div>
                        <div class="edit-input-wrapper">
                            <input type="url" class="edit-input" id="editTwitterInput" placeholder="x.com/yourprofile" oninput="validateEditLinks()">
                            <span class="edit-validation-icon" id="editTwitterStatus"></span>
                        </div>
                    </div>
                    
                    <div class="edit-link-item">
                        <div class="edit-link-label">
                            <span class="edit-link-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#FF5500">
                                    <path d="M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154c-.009.064.03.124.093.138l.334.071c.063.014.117.068.126.132l.037.235c.008.063.061.117.123.131l1.633.347c.063.014.12-.032.13-.098l.163-1.099c.01-.066.068-.116.134-.115l.09.001c.066.001.12.049.133.114l.088.503c.012.065.072.111.138.104l.195-.023c.066-.008.119-.059.13-.125l.11-.665c.011-.066.069-.115.135-.114l.239.004c.066.001.123.05.133.115l.111.645c.01.065.067.113.132.113l.154-.001c.065-.001.121-.05.131-.115l.094-.603c.01-.065.066-.114.131-.116l.26-.007c.066-.002.122.045.134.11l.143.769c.011.065.071.11.137.103l.183-.018c.066-.006.12-.057.132-.122l.093-.547c.012-.066.07-.113.136-.111l.257.008c.065.002.12.051.13.116l.108.627c.01.065.067.113.132.114l.137.003c.066.001.122-.046.134-.111l.12-.669c.012-.065.068-.112.134-.112h.23c.066 0 .122.048.133.113l.095.559c.011.065.068.112.134.112h.129c.066 0 .123-.047.134-.113l.104-.612c.011-.065.068-.112.134-.112l.313-.001c.066 0 .123.047.134.112l.104.617c.011.066.068.113.134.113h.118c.066 0 .123-.047.134-.113l.108-.642c.011-.065.068-.112.134-.112l.376-.001c.066 0 .123.047.134.112l.109.655c.011.066.068.113.134.113h.107c.066 0 .123-.047.135-.113l.115-.689c.011-.066.068-.113.134-.113l.464-.001c.066 0 .123.047.134.112l.12.725c.011.066.069.113.135.112l.091-.002c.066-.001.123-.049.133-.114l.082-.528c.01-.065.066-.114.132-.116l.574-.014c.066-.002.124.044.136.109l.14.776c.012.065.071.111.137.105l.054-.006c.066-.007.122-.057.133-.123l.075-.47c.011-.065.067-.114.133-.116l.674-.019c.066-.002.124.043.137.108l.165.915c.012.065.072.11.138.103l.025-.003c.066-.008.12-.059.131-.125l.054-.354c.011-.066.067-.115.133-.117l.846-.028c.066-.002.125.042.137.107l.184 1.019c.013.065.073.109.139.101a.133.133 0 0 0 .119-.131l-.01-.333c-.002-.066.045-.124.11-.137l.926-.188c.065-.013.127.027.14.091l.217 1.046c.013.064.075.107.14.097l.017-.003c.065-.01.116-.065.124-.131l.04-.345c.008-.066.059-.12.124-.131l1.147-.269c.065-.015.13.024.145.089l.266 1.136c.014.064.077.104.142.092a.134.134 0 0 0 .109-.14l-.039-.608c-.004-.066.041-.126.105-.14l1.393-.316c.064-.014.129.023.145.087l.328 1.287c.015.064.079.102.144.088a.134.134 0 0 0 .1-.145l-.103-.904c-.007-.066.036-.128.1-.144l1.612-.397c.063-.016.129.02.147.083l.417 1.449c.017.063.081.1.146.083a.134.134 0 0 0 .091-.15l-.199-1.2c-.011-.066.031-.13.094-.148l1.716-.459c.063-.017.128.017.148.079l.479 1.513c.019.063.084.099.148.081a.134.134 0 0 0 .086-.153l-.309-1.468c-.013-.065.027-.131.088-.15l.4-.124c.062-.019.126.013.148.074l.535 1.539c.021.062.087.096.15.077a.134.134 0 0 0 .081-.155l-.491-1.759a.134.134 0 0 1 .084-.16l.11-.037c.063-.021.13.011.152.071l.599 1.597c.022.061.089.094.152.074a.134.134 0 0 0 .077-.159l-.738-2.097a.134.134 0 0 1 .079-.165l.04-.015c.063-.023.131.007.155.067l.668 1.667c.024.06.092.091.155.07a.134.134 0 0 0 .074-.161l-1.024-2.467a.134.134 0 0 1 .073-.17l.016-.006c.063-.025.133.003.158.062l.726 1.713c.025.06.094.088.156.066a.134.134 0 0 0 .07-.165l-1.376-2.847a.134.134 0 0 1 .067-.175c.061-.027.134-.001.161.058l.792 1.743c.027.059.096.085.158.062a.134.134 0 0 0 .067-.168l-1.791-3.27c-.031-.057-.01-.129.046-.161.056-.032.129-.014.163.041l.867 1.766c.029.058.098.083.159.058a.134.134 0 0 0 .063-.171l-2.276-3.739a.134.134 0 0 1 .036-.172c.052-.038.124-.027.163.023l.943 1.775c.031.057.1.08.16.054a.134.134 0 0 0 .06-.175l-2.835-4.27a.134.134 0 0 1 .025-.18c.049-.042.122-.035.164.015l1.028 1.782c.032.056.102.077.161.049a.134.134 0 0 0 .056-.179l-3.479-4.868a.134.134 0 0 1 .013-.186.133.133 0 0 1 .166.005l1.117 1.783c.034.055.104.074.162.044a.134.134 0 0 0 .053-.183l-4.223-5.559a.134.134 0 0 1 .001-.192.133.133 0 0 1 .168-.004l1.21 1.781c.035.054.106.071.163.039a.134.134 0 0 0 .049-.186l-5.09-6.383a.134.134 0 0 1-.011-.199.133.133 0 0 1 .17-.013l1.306 1.776c.037.053.108.068.164.034a.134.134 0 0 0 .046-.19L17.96 2.42a.134.134 0 0 1-.023-.206.133.133 0 0 1 .172-.022l1.406 1.768c.038.052.11.066.165.029a.134.134 0 0 0 .042-.193l-2.09-2.735a.134.134 0 0 1-.01-.155c.031-.048.095-.062.144-.033l.398.238c.05.03.114.016.148-.031l.079-.108a.134.134 0 0 0-.024-.188l-2.365-1.84a.134.134 0 0 0-.178.017l-.257.297a.133.133 0 0 1-.18.018l-.14-.113a.134.134 0 0 0-.182.015l-.333.373a.133.133 0 0 1-.18.015l-.127-.109a.134.134 0 0 0-.184.012l-.412.449a.133.133 0 0 1-.182.012l-.114-.104a.134.134 0 0 0-.186.009l-.495.527a.133.133 0 0 1-.184.009l-.1-.098a.134.134 0 0 0-.187.007l-.583.609a.133.133 0 0 1-.186.006l-.085-.091a.134.134 0 0 0-.189.004l-.676.695a.133.133 0 0 1-.187.003l-.069-.083a.134.134 0 0 0-.191.001l-.776.785a.133.133 0 0 1-.188 0l-.052-.074a.134.134 0 0 0-.192-.002l-.883.882a.133.133 0 0 1-.19-.003l-.034-.063a.134.134 0 0 0-.194-.007l-.999.985a.133.133 0 0 1-.191-.006l-.014-.05a.134.134 0 0 0-.196-.01l-1.125 1.096a.133.133 0 0 1-.192-.01l.008-.035a.134.134 0 0 0-.198-.015l-1.263 1.217a.133.133 0 0 1-.193-.013l.033-.019a.134.134 0 0 0-.201-.02l-1.417 1.351a.133.133 0 0 1-.195-.017c.02.004.04.003.06-.002a.134.134 0 0 0-.203-.025l-1.588 1.498a.133.133 0 0 1-.197-.022c.028.013.058.018.089.015a.134.134 0 0 0-.206-.031l-1.783 1.664a.133.133 0 0 1-.199-.027c.038.024.082.036.126.033a.134.134 0 0 0-.208-.037z"/>
                                </svg>
                            </span>
                            SoundCloud
                        </div>
                        <div class="edit-input-wrapper">
                            <input type="url" class="edit-input" id="editSoundcloudInput" placeholder="soundcloud.com/yourprofile" oninput="validateEditLinks()">
                            <span class="edit-validation-icon" id="editSoundcloudStatus"></span>
                        </div>
                    </div>
                    
                    <div class="edit-link-item">
                        <div class="edit-link-label">
                            <span class="edit-link-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#F5C518">
                                    <path d="M14.31 9.588v.005c-.077-.048-.227-.07-.42-.07v4.815c.27 0 .44-.022.5-.065.062-.043.092-.162.092-.357V9.89c0-.192-.06-.258-.172-.302zm-6.57 3.755c0 .322-.022.55-.065.685-.043.135-.12.202-.232.202-.096 0-.168-.057-.217-.17-.048-.114-.072-.337-.072-.668v-1.73c0-.304.027-.516.082-.636.055-.12.13-.18.227-.18.103 0 .178.063.225.19.047.126.07.35.07.672l-.018 1.635zm9.04-3.807c-.193 0-.337.058-.435.175-.098.117-.147.31-.147.58v.347h1.182v-.347c0-.27-.05-.463-.148-.58-.098-.117-.245-.175-.453-.175zM24 4.5v15c0 2.485-2.015 4.5-4.5 4.5h-15A4.502 4.502 0 0 1 0 19.5v-15C0 2.015 2.015 0 4.5 0h15C21.985 0 24 2.015 24 4.5zM9.602 8.197H6.352v.625h1.14v5.46h.968v-5.46h1.14l.002-.625zm3.062 1.89c0-.387-.058-.67-.173-.85-.114-.18-.303-.27-.566-.27-.226 0-.403.075-.53.227-.128.152-.192.375-.192.67v2.953c0 .327.062.57.185.727.123.157.3.235.533.235.217 0 .398-.066.543-.2.145-.133.218-.31.218-.527h-.005v.4h.942V8.197h-.955v1.89zm3.847 2.132c0 .28-.017.487-.05.622-.033.135-.095.202-.186.202-.062 0-.117-.024-.167-.072a.395.395 0 0 1-.103-.177.899.899 0 0 1-.032-.245l-.01-.363v-2.4h-.943v2.663c0 .45.062.775.186.975.124.2.328.3.612.3.188 0 .347-.058.475-.172.128-.115.22-.26.275-.436v.532h.887V9.785h-.944v2.434zm3.847-1.133v-.093c0-.27-.023-.46-.07-.568-.047-.108-.127-.163-.24-.163-.117 0-.2.055-.247.165-.047.11-.07.3-.07.57v.088h.627zm.938 1.345h-.938v.075c0 .26-.02.438-.057.535-.038.097-.103.145-.195.145-.103 0-.176-.04-.22-.12-.044-.08-.066-.24-.066-.478v-.742h1.476v-.765c0-.47-.082-.812-.245-1.025-.163-.213-.424-.32-.783-.32-.35 0-.614.112-.792.337-.178.224-.267.562-.267 1.013v1.768c0 .457.094.797.282 1.02.188.224.46.335.816.335.367 0 .637-.108.81-.326.173-.218.26-.565.26-1.042l-.08-.41z"/>
                                </svg>
                            </span>
                            IMDb
                        </div>
                        <div class="edit-input-wrapper">
                            <input type="url" class="edit-input" id="editImdbInput" placeholder="imdb.com/name/nm..." oninput="validateEditLinks()">
                            <span class="edit-validation-icon" id="editImdbStatus"></span>
                        </div>
                    </div>
                    
                    <p class="edit-helper-text">Used to verify your work and improve introductions.</p>
                </div>
            </div>
            
            <div class="edit-modal-footer">
                <button class="edit-btn-cancel" onclick="closeEditProfileModal()">Cancel</button>
                <button class="edit-btn-save" id="editSaveBtn" onclick="saveEditProfile()" disabled>Save</button>
            </div>
        </div>
    </div>
    
    <!-- ========== SIGN UP / SIGN IN MODAL ========== -->
    <div class="modal-overlay" id="signInModal" onclick="closeSignIn(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeSignIn()">&times;</button>
            
            <!-- Step 1: Basic Info -->
            <div class="modal-step" id="signupStep">
                <h2 class="modal-title">Join Tapinx</h2>
                
                <div class="modal-row">
                    <div class="modal-form-group">
                        <label class="modal-label">What's your name?</label>
                        <input type="text" class="modal-input" id="signupName" placeholder="Full name" oninput="validateSignupForm()">
                        <p class="modal-error" id="nameError">Please enter your full name</p>
                    </div>
                    <div class="modal-form-group small">
                        <label class="modal-label">How old are you?</label>
                        <select class="modal-select" id="signupAge" onchange="validateSignupForm()">
                            <option value="">Age</option>
                            <script>
                                for(let i = 18; i <= 80; i++) {
                                    document.write('<option value="'+i+'">'+i+'</option>');
                                }
                            </script>
                        </select>
                        <p class="modal-error" id="ageError">Required</p>
                    </div>
                </div>
                
                <div class="modal-form-group">
                    <label class="modal-label">Phone Number</label>
                    <div class="phone-row">
                        <div class="country-dropdown">
                            <button type="button" class="country-btn" onclick="toggleCountryList()">
                                <span class="flag" id="selectedFlag"></span>
                                <span id="selectedCode">+1</span>
                                <span style="color:#999;font-size:10px;"></span>
                            </button>
                            <div class="country-list" id="countryList">
                                <div class="country-search">
                                    <input type="text" placeholder="Search country..." id="countrySearch" oninput="filterCountries()">
                                </div>
                                <div id="countryItems"></div>
                            </div>
                        </div>
                        <input type="tel" class="phone-number-input" id="phoneInput" placeholder="(123) 456-7890" oninput="formatPhoneNumber(this); validateSignupForm();">
                    </div>
                    <p class="modal-error" id="phoneError">Please enter a valid phone number</p>
                </div>
                
                <div class="modal-checkbox">
                    <input type="checkbox" id="termsCheckbox" onchange="validateSignupForm()">
                    <label for="termsCheckbox">You must be 18 or above to use Tapinx. <a href="#">View our TOS.</a></label>
                </div>
                
                <button class="modal-btn" id="submitBtn" onclick="submitSignup()">Submit</button>
                <div id="recaptcha-container"></div>
            </div>
            
            <!-- Step 2: OTP Verification -->
            <div class="modal-step hidden" id="otpStep">
                <button class="back-btn" onclick="showSignupStep()"> Back</button>
                <h2 class="modal-title">Enter Code</h2>
                <p class="modal-subtitle">We sent a 6-digit code to <span id="phoneDisplay">+1 (123) 456-7890</span></p>
                <div class="otp-inputs">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp1" oninput="otpInput(this, 'otp2', null)" onkeydown="otpKeydown(event, null)">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp2" oninput="otpInput(this, 'otp3', 'otp1')" onkeydown="otpKeydown(event, 'otp1')">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp3" oninput="otpInput(this, 'otp4', 'otp2')" onkeydown="otpKeydown(event, 'otp2')">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp4" oninput="otpInput(this, 'otp5', 'otp3')" onkeydown="otpKeydown(event, 'otp3')">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp5" oninput="otpInput(this, 'otp6', 'otp4')" onkeydown="otpKeydown(event, 'otp4')">
                    <input type="text" inputmode="numeric" class="otp-input" maxlength="1" id="otp6" oninput="otpInput(this, null, 'otp5')" onkeydown="otpKeydown(event, 'otp5')">
                </div>
                <p class="resend-text"><span class="resend-timer" id="resendTimer">Resend code in 60s</span><a id="resendLink" style="display:none;" onclick="resendCode()">Resend code</a></p>
                <button class="modal-btn active" onclick="verifyOtp()">Verify</button>
            </div>
            
            <!-- Step 3: Sign In (for returning users) -->
            <div class="modal-step hidden" id="signinStep">
                <h2 class="modal-title">Welcome back!</h2>
                <div class="modal-form-group">
                    <label class="modal-label">Phone Number</label>
                    <div class="phone-row">
                        <div class="country-dropdown">
                            <button type="button" class="country-btn" onclick="toggleCountryList2()">
                                <span class="flag" id="selectedFlag2"></span>
                                <span id="selectedCode2">+1</span>
                                <span style="color:#999;font-size:10px;"></span>
                            </button>
                            <div class="country-list" id="countryList2">
                                <div class="country-search">
                                    <input type="text" placeholder="Search country..." id="countrySearch2" oninput="filterCountries2()">
                                </div>
                                <div id="countryItems2"></div>
                            </div>
                        </div>
                        <input type="tel" class="phone-number-input" id="phoneInput2" placeholder="(123) 456-7890" oninput="formatPhoneNumber(this)">
                    </div>
                    <p class="modal-error" id="phoneError2">Please enter a valid phone number</p>
                </div>
                <button class="modal-btn active" id="signinBtn" onclick="sendSigninCode()">Send Code</button>
                <p style="text-align:center;margin-top:16px;font-size:14px;color:#666;">New to Tapinx? <a style="color:#E50914;cursor:pointer;" onclick="showSignupStep()">Sign up</a></p>
            </div>
        </div>
    </div>
    
    <!-- ========== TELEGRAM REDIRECT MODAL ========== -->
    <div class="modal-overlay" id="telegramModal" onclick="closeTelegramModal(event)">
        <div class="modal-content telegram-modal" onclick="event.stopPropagation()">
            <h2>Let's Message Taj!</h2>
            <p>Your AI friend who will walk you through everything and help you make amazing connections </p>
            <a href="https://t.me/TapinXBot?start=welcome" target="_blank" class="telegram-btn" onclick="goToTelegram()">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                </svg>
                Chat with Taj on Telegram
            </a>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // ============================================
        // PROFESSIONAL URL ROUTER
        // Complete routing system with all edge cases
        // ============================================
        
        const Router = {
            // Valid routes
            routes: {
                '/': { page: 'landing', title: 'TapinX - Text to Get Connected', requiresAuth: false },
                '/opportunities': { page: 'opportunities', title: 'Opportunities - TapinX', requiresAuth: true },
                '/requests': { page: 'requests', title: 'My Requests - TapinX', requiresAuth: true },
                '/connections': { page: 'connections', title: 'My Connections - TapinX', requiresAuth: true },
                '/settings': { page: 'settings', title: 'Settings - TapinX', requiresAuth: true },
                '/referrals': { page: 'referrals', title: 'Referrals - TapinX', requiresAuth: true }
            },
            
            // Track if this is first load
            isFirstLoad: true,
            
            // Track current page to prevent duplicate navigation
            currentPage: null,
            
            // Check if user is authenticated
            isAuthenticated: function() {
                return !!(localStorage.getItem('tapinx_user_id') || localStorage.getItem('tapinx_user_phone'));
            },
            
            // Get route info from path
            getRoute: function(path) {
                return this.routes[path] || null;
            },
            
            // Get current path
            getCurrentPath: function() {
                return window.location.pathname;
            },
            
            // Navigate to a page (user action - adds to history)
            navigate: function(page, options = {}) {
                const path = page === 'landing' ? '/' : '/' + page;
                const route = this.getRoute(path);
                
                console.log('[Router] Navigate to:', page, 'Path:', path);
                
                // Check if route exists
                if (!route && page !== 'landing') {
                    console.log('[Router] Invalid route, redirecting to opportunities');
                    this.navigate('opportunities');
                    return;
                }
                
                // Check authentication
                if (route && route.requiresAuth && !this.isAuthenticated()) {
                    console.log('[Router] Auth required, redirecting to landing');
                    this.navigate('landing');
                    return;
                }
                
                // Don't navigate if already on this page (prevents duplicate history)
                if (this.currentPage === page && !options.force) {
                    console.log('[Router] Already on page:', page);
                    return;
                }
                
                // Update history
                if (this.isFirstLoad || options.replace) {
                    history.replaceState({ page: page, path: path }, '', path);
                } else {
                    history.pushState({ page: page, path: path }, '', path);
                }
                
                // Update page title
                document.title = route ? route.title : 'TapinX';
                
                // Show the page
                this.showPage(page);
                
                // Update state
                this.currentPage = page;
                this.isFirstLoad = false;
            },
            
            // Show page (internal - doesn't modify history)
            showPage: function(page) {
                console.log('[Router] Showing page:', page);
                
                if (page === 'landing') {
                    if (typeof showPage === 'function') showPage('landing');
                } else {
                    if (typeof showPage === 'function') showPage('dashboard');
                    this.showAppPage(page);
                }
            },
            
            // Show app page without history modification
            showAppPage: function(page) {
                console.log('[Router] Showing app page:', page);
                
                // Add loading state
                const mainColumn = document.querySelector('.new-main-column');
                if (mainColumn) mainColumn.classList.add('page-loading');
                
                // Close mobile menu
                try {
                    if (typeof closeMobileMenu === 'function') closeMobileMenu();
                } catch(e) {}
                
                // Page ID mapping
                const pageIds = {
                    'opportunities': 'newOpportunitiesPage',
                    'requests': 'newRequestsPage',
                    'connections': 'newConnectionsPage',
                    'settings': 'newSettingsPage',
                    'referrals': 'newReferralsPage'
                };
                
                // Hide all pages
                Object.values(pageIds).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
                
                // Show target page
                const targetId = pageIds[page];
                if (targetId) {
                    const el = document.getElementById(targetId);
                    if (el) {
                        // Use 'block' for most pages, 'flex' only if needed
                        el.style.display = 'block';
                    }
                }
                
                // Update mobile header title
                const titles = {
                    'requests': 'My Requests',
                    'connections': 'My Connections',
                    'opportunities': 'Opportunities',
                    'referrals': 'Referrals',
                    'settings': 'Settings'
                };
                if (typeof updateMobileHeader === 'function') {
                    updateMobileHeader(titles[page] || 'TapinX');
                }
                
                // Update sidebar active states
                document.querySelectorAll('.new-sidebar-link').forEach(link => {
                    link.classList.remove('active');
                    const onclick = link.getAttribute('onclick');
                    if (onclick && onclick.includes("'" + page + "'")) {
                        link.classList.add('active');
                    }
                });
                
                // Update sidebar nav by ID
                const navLink = document.getElementById('nav' + page.charAt(0).toUpperCase() + page.slice(1));
                if (navLink) navLink.classList.add('active');
                
                // Update sublinks
                document.querySelectorAll('.new-sidebar-sublink').forEach(l => l.classList.remove('active'));
                
                // Handle expand sections
                document.querySelectorAll('.new-sidebar-expand').forEach(e => {
                    e.style.display = 'none';
                });
                if (page === 'requests') {
                    const expand = document.getElementById('requestsExpand');
                    if (expand) expand.style.display = 'block';
                    // Reset tabs to "All" when showing page
                    const tabs = document.querySelectorAll('#newRequestsPage .new-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    if (tabs[0]) tabs[0].classList.add('active');
                    // Reset sidebar sublinks for requests
                    document.querySelectorAll('#requestsExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
                    const requestSublinks = document.querySelectorAll('#requestsExpand .new-sidebar-sublink');
                    if (requestSublinks[0]) requestSublinks[0].classList.add('active');
                }
                if (page === 'connections') {
                    const expand = document.getElementById('connectionsExpand');
                    if (expand) expand.style.display = 'block';
                    // Reset tabs to "All" when showing page
                    const tabs = document.querySelectorAll('#newConnectionsPage .new-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    if (tabs[0]) tabs[0].classList.add('active');
                    // Reset sidebar sublinks for connections
                    document.querySelectorAll('#connectionsExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
                    const connectionSublinks = document.querySelectorAll('#connectionsExpand .new-sidebar-sublink');
                    if (connectionSublinks[0]) connectionSublinks[0].classList.add('active');
                }
                if (page === 'opportunities') {
                    const expand = document.getElementById('opportunitiesExpand');
                    if (expand) expand.style.display = 'block';
                    // Reset tabs to "All" when showing page
                    const tabs = document.querySelectorAll('#newOpportunitiesPage .new-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    if (tabs[0]) tabs[0].classList.add('active');
                    // Reset sidebar sublinks for opportunities
                    document.querySelectorAll('#opportunitiesExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
                    const opportunitySublinks = document.querySelectorAll('#opportunitiesExpand .new-sidebar-sublink');
                    if (opportunitySublinks[0]) opportunitySublinks[0].classList.add('active');
                }
                
                // Load page data
                this.loadPageData(page);
                
                // Update current page tracker
                if (typeof currentNewAppPage !== 'undefined') {
                    currentNewAppPage = page;
                }
                
                // Remove loading state after data loads
                setTimeout(() => {
                    if (mainColumn) mainColumn.classList.remove('page-loading');
                }, 300);
            },
            
            // Load data for the page
            loadPageData: function(page) {
                console.log('[Router] Loading data for:', page);
                
                try {
                    if (page === 'requests' && typeof loadNewRequests === 'function') {
                        loadNewRequests();
                    }
                    if (page === 'connections' && typeof loadNewConnections === 'function') {
                        loadNewConnections();
                    }
                    if (page === 'opportunities' && typeof loadNewOpportunities === 'function') {
                        loadNewOpportunities();
                    }
                } catch(e) {
                    console.error('[Router] Error loading page data:', e);
                }
            },
            
            // Handle browser back/forward
            handlePopState: function(event) {
                console.log('[Router] PopState event:', event.state);
                
                let page = 'landing';
                
                if (event.state && event.state.page) {
                    page = event.state.page;
                } else {
                    // Derive from URL
                    const path = window.location.pathname;
                    const route = this.getRoute(path);
                    page = route ? route.page : 'landing';
                }
                
                // Check auth for protected pages
                if (page !== 'landing' && !this.isAuthenticated()) {
                    window.location.replace('/');
                    return;
                }
                
                // Update title
                const route = this.getRoute(page === 'landing' ? '/' : '/' + page);
                document.title = route ? route.title : 'TapinX';
                
                // Show page without modifying history
                this.currentPage = page;
                this.showPage(page);
            },
            
            // Initialize router
            init: function() {
                console.log('[Router] Initializing...');
                
                // Handle legacy hash URLs (redirect #page to /page)
                if (window.location.hash) {
                    const hashPage = window.location.hash.replace('#', '');
                    if (this.routes['/' + hashPage]) {
                        window.location.replace('/' + hashPage);
                        return;
                    }
                }
                
                const path = this.getCurrentPath();
                const route = this.getRoute(path);
                const isAuthenticated = this.isAuthenticated();
                
                console.log('[Router] Path:', path, 'Authenticated:', isAuthenticated);
                
                // Handle routing logic
                if (!route) {
                    // Invalid URL - redirect
                    if (isAuthenticated) {
                        window.location.replace('/opportunities');
                    } else {
                        window.location.replace('/');
                    }
                    return;
                }
                
                if (route.requiresAuth && !isAuthenticated) {
                    // Needs auth but not logged in
                    window.location.replace('/');
                    return;
                }
                
                if (path === '/' && isAuthenticated) {
                    // On landing but logged in - go to opportunities
                    this.navigate('opportunities', { replace: true });
                    return;
                }
                
                // Show the current page
                this.navigate(route.page, { replace: true });
                
                console.log('[Router] Initialization complete');
            }
        };
        
        // Set up popstate listener for back/forward buttons
        window.addEventListener('popstate', function(event) {
            Router.handlePopState(event);
        });
        
        // Network status handlers
        window.addEventListener('online', function() {
            console.log('[Network] Back online');
            // Optionally reload current page data
            if (Router.currentPage) {
                Router.loadPageData(Router.currentPage);
            }
        });
        
        window.addEventListener('offline', function() {
            console.log('[Network] Went offline');
            // Optionally show offline indicator
        });
        
        // ========== API CONFIGURATION ==========
        const API_URL = 'https://tapinx-backend-production.up.railway.app/api';
        
        // Fetch and sync profile from backend
        async function fetchProfileFromBackend() {
            const phone = localStorage.getItem('tapinx_user_phone');
            if (!phone) return null;
            
            try {
                const response = await fetch(`${API_URL}/users/${encodeURIComponent(phone)}/profile`);
                if (!response.ok) return null;
                
                const profile = await response.json();
                
                // Sync to localStorage
                if (profile.name) localStorage.setItem('tapinx_user_name', profile.name);
                if (profile.age) localStorage.setItem('tapinx_user_age', profile.age);
                if (profile.bio) localStorage.setItem('tapinx_user_bio', profile.bio);
                if (profile.linkedin) localStorage.setItem('tapinx_user_linkedin', profile.linkedin);
                if (profile.instagram) localStorage.setItem('tapinx_user_instagram', profile.instagram);
                if (profile.twitter) localStorage.setItem('tapinx_user_twitter', profile.twitter);
                if (profile.soundcloud) localStorage.setItem('tapinx_user_soundcloud', profile.soundcloud);
                if (profile.imdb) localStorage.setItem('tapinx_user_imdb', profile.imdb);
                if (profile.photo) localStorage.setItem('tapinx_user_photo', profile.photo);
                if (profile.skills) localStorage.setItem('tapinx_user_skills', JSON.stringify(profile.skills));
                
                console.log('[TapinX] Profile synced from backend');
                return profile;
            } catch (error) {
                console.error('[TapinX] Error fetching profile:', error);
                return null;
            }
        }
        
        // Fetch matches (Attention Required) from API
        async function fetchMatches() {
            const userId = localStorage.getItem('tapinx_user_id');
            const phone = localStorage.getItem('tapinx_user_phone');
            const identifier = userId || phone;
            if (!identifier) return { matches: [], count: 0 };
            
            try {
                const response = await fetch(`${API_URL}/opportunities/${encodeURIComponent(identifier)}`);
                const data = await response.json();
                if (data.success) {
                    // Map opportunities to match format expected by UI
                    const matches = data.opportunities.map(opp => ({
                        id: opp.id,
                        other_name: opp.requester_name,
                        match_type: opp.match_type || 'professional',
                        intro_reason: opp.ask_title,
                        created_at: opp.created_at
                    }));
                    return { matches, count: data.count };
                }
            } catch (error) {
                console.error('Error fetching opportunities:', error);
            }
            return { matches: [], count: 0 };
        }
        
        // Fetch connections from API
        async function fetchConnections() {
            let userId = null;
            let phone = null;
            
            // Safely access localStorage (handles mobile browsers and private mode)
            try {
                userId = localStorage.getItem('tapinx_user_id');
                phone = localStorage.getItem('tapinx_user_phone');
            } catch (error) {
                console.error('[TapinX] Error accessing localStorage:', error);
            }
            
            // If userId is not in localStorage, try to get it from API using phone number
            if (!userId && phone) {
                try {
                    console.log('[TapinX] userId not found in localStorage, fetching from API using phone:', phone);
                    const profileResponse = await fetch(`${API_URL}/users/${encodeURIComponent(phone)}/profile`);
                    if (profileResponse.ok) {
                        const profileData = await profileResponse.json();
                        // Check multiple possible field names for userId
                        if (profileData.id) {
                            userId = profileData.id;
                            try {
                                localStorage.setItem('tapinx_user_id', userId);
                                console.log('[TapinX] userId retrieved from profileData.id and stored:', userId);
                            } catch (e) {
                                console.warn('[TapinX] Could not store userId in localStorage:', e);
                            }
                        } else if (profileData.user_id) {
                            userId = profileData.user_id;
                            try {
                                localStorage.setItem('tapinx_user_id', userId);
                                console.log('[TapinX] userId retrieved from profileData.user_id and stored:', userId);
                            } catch (e) {
                                console.warn('[TapinX] Could not store userId in localStorage:', e);
                            }
                        } else if (profileData.user?.id) {
                            userId = profileData.user.id;
                            try {
                                localStorage.setItem('tapinx_user_id', userId);
                                console.log('[TapinX] userId retrieved from profileData.user.id and stored:', userId);
                            } catch (e) {
                                console.warn('[TapinX] Could not store userId in localStorage:', e);
                            }
                        } else {
                            console.warn('[TapinX] Profile API response does not contain userId field:', profileData);
                        }
                    } else {
                        console.warn('[TapinX] Profile API response not OK:', profileResponse.status, profileResponse.statusText);
                    }
                } catch (error) {
                    console.error('[TapinX] Error fetching userId from profile API:', error);
                }
            }
            
            const identifier = userId || phone;
            if (!identifier) {
                console.warn('[TapinX] No identifier available for fetching connections (userId or phone missing)');
                return { connections: [], count: 0 };
            }
            
            try {
                console.log('[TapinX] Fetching connections for identifier:', identifier);
                const response = await fetch(`${API_URL}/connections/${encodeURIComponent(identifier)}`);
                
                if (!response.ok) {
                    console.error('[TapinX] Connections API response not OK:', response.status, response.statusText);
                    return { connections: [], count: 0 };
                }
                
                const data = await response.json();
                console.log('[TapinX] Connections API response:', data);
                
                if (data.success) {
                    console.log('[TapinX] Successfully fetched connections:', data.count);
                    return { connections: data.connections || [], count: data.count || 0 };
                } else {
                    console.warn('[TapinX] Connections API returned success=false:', data);
                    return { connections: [], count: 0 };
                }
            } catch (error) {
                console.error('[TapinX] Error fetching connections:', error);
                return { connections: [], count: 0 };
            }
        }
        
        // Respond to a match (accept/decline)
        async function respondToMatch(matchId, action) {
            const userId = localStorage.getItem('tapinx_user_id');
            if (!userId) return false;
            
            try {
                const response = await fetch(`${API_URL}/matches/${matchId}/respond`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        response: action === 'accept' ? 'yes' : 'no',
                        user_id: userId
                    })
                });
                const data = await response.json();
                return data.success;
            } catch (error) {
                console.error('Error responding to match:', error);
                return false;
            }
        }
        // ========== FIREBASE CONFIGURATION ==========
        let auth = null;
        let recaptchaVerifier = null;
        let confirmationResult = null;
        let firebaseReady = false;
        
        // Initialize Firebase when ready
        function initFirebase() {
            if (typeof firebase === 'undefined') {
                console.log('Firebase SDK not loaded yet, using demo mode');
                return false;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyDqV46aMnuk3OzF-VjQ_AtCiH3RxQ4RYUs",
                    authDomain: "tapinx-e6a04.firebaseapp.com",
                    projectId: "tapinx-e6a04",
                    storageBucket: "tapinx-e6a04.firebasestorage.app",
                    messagingSenderId: "898635790224",
                    appId: "1:898635790224:web:0c2f5bcde9f20c27cb6515",
                    measurementId: "G-95VQG4X74F"
                };
                
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                firebaseReady = true;
                console.log('Firebase initialized successfully');
                return true;
            } catch (error) {
                console.error('Firebase init error:', error);
                return false;
            }
        }
        
        // Try to initialize Firebase on page load
        // Check for referral parameters
        function checkReferralParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const refUserId = urlParams.get('ref');
            const refOppId = urlParams.get('opp');
            
            if (refUserId) {
                localStorage.setItem('tapinx_referred_by', refUserId);
                console.log('[Referral] Referred by user:', refUserId);
            }
            if (refOppId) {
                localStorage.setItem('tapinx_referred_opportunity', refOppId);
                console.log('[Referral] Referred for opportunity:', refOppId);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check for referral parameters first
            checkReferralParams();
            
            // Initialize Firebase first
            if (typeof initFirebase === 'function') {
                initFirebase();
            }
            
            // Initialize router
            Router.init();
        });
        
        // Also try immediately in case DOM is already ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            if (typeof initFirebase === 'function') {
                initFirebase();
            }
            Router.init();
        }
        
        function initRecaptcha() {
            if (!firebaseReady) return;
            
            // Clear any existing verifier
            if (recaptchaVerifier) {
                try {
                    recaptchaVerifier.clear();
                } catch(e) {}
                recaptchaVerifier = null;
            }
            
            try {
                recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'invisible',
                    'siteKey': '6Lfq8issAAAAADs1c6CAivmsgzIVlV1W4uaYTLR7'
                });
                recaptchaVerifier.render().then(function(widgetId) {
                    console.log('reCAPTCHA rendered successfully');
                }).catch(function(error) {
                    console.error('reCAPTCHA render error:', error);
                    recaptchaVerifier = null;
                });
            } catch (error) {
                console.error('reCAPTCHA init error:', error);
                recaptchaVerifier = null;
            }
        }
        
        // ========== PAGE NAVIGATION ==========
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            if (page === 'landing') {
                document.getElementById('landingPage').classList.add('active');
            } else if (page === 'editProfile') {
                document.getElementById('editProfilePage').classList.add('active');
                loadProfileData();
            } else if (page === 'dashboard') {
                document.getElementById('dashboardPage').classList.add('active');
                loadDashboard();
            } else if (page === 'connections') {
                document.getElementById('connectionsPage').classList.add('active');
                loadConnections();
            } else if (page === 'attention') {
                document.getElementById('attentionPage').classList.add('active');
                loadAttention();
            }
        }
        
        function goBack() {
            if (localStorage.getItem('tapinx_logged_in') === 'true') {
                showPage('dashboard');
            } else {
                showPage('landing');
            }
        }
        
        // ========== COUNTRY DATA ==========
        const countries = [
            { name: 'United States', code: '+1', flag: '' },
            { name: 'United Kingdom', code: '+44', flag: '' },
            { name: 'Canada', code: '+1', flag: '' },
            { name: 'India', code: '+91', flag: '' },
            { name: 'Australia', code: '+61', flag: '' },
            { name: 'Germany', code: '+49', flag: '' },
            { name: 'France', code: '+33', flag: '' },
            { name: 'Italy', code: '+39', flag: '' },
            { name: 'Spain', code: '+34', flag: '' },
            { name: 'Brazil', code: '+55', flag: '' },
            { name: 'Mexico', code: '+52', flag: '' },
            { name: 'Japan', code: '+81', flag: '' },
            { name: 'South Korea', code: '+82', flag: '' },
            { name: 'China', code: '+86', flag: '' },
            { name: 'Singapore', code: '+65', flag: '' },
            { name: 'United Arab Emirates', code: '+971', flag: '' },
            { name: 'Netherlands', code: '+31', flag: '' },
            { name: 'Sweden', code: '+46', flag: '' },
            { name: 'Switzerland', code: '+41', flag: '' },
            { name: 'Ireland', code: '+353', flag: '' },
            { name: 'New Zealand', code: '+64', flag: '' },
            { name: 'South Africa', code: '+27', flag: '' },
            { name: 'Nigeria', code: '+234', flag: '' },
            { name: 'Kenya', code: '+254', flag: '' },
            { name: 'Israel', code: '+972', flag: '' },
            { name: 'Poland', code: '+48', flag: '' },
            { name: 'Portugal', code: '+351', flag: '' },
            { name: 'Russia', code: '+7', flag: '' },
            { name: 'Turkey', code: '+90', flag: '' },
            { name: 'Argentina', code: '+54', flag: '' },
            { name: 'Chile', code: '+56', flag: '' },
            { name: 'Colombia', code: '+57', flag: '' },
            { name: 'Philippines', code: '+63', flag: '' },
            { name: 'Thailand', code: '+66', flag: '' },
            { name: 'Vietnam', code: '+84', flag: '' },
            { name: 'Indonesia', code: '+62', flag: '' },
            { name: 'Malaysia', code: '+60', flag: '' },
            { name: 'Pakistan', code: '+92', flag: '' },
            { name: 'Bangladesh', code: '+880', flag: '' },
            { name: 'Egypt', code: '+20', flag: '' }
        ];
        
        let selectedCountry = countries[0];
        let resendTimer = null;
        let isSigningIn = false; // Track if signing in vs signing up
        
        // Initialize country list
        function initCountryList() {
            const container = document.getElementById('countryItems');
            if (!container) return;
            container.innerHTML = countries.map(c => `
                <div class="country-item" onclick="selectCountry('${c.code}', '${c.flag}', '${c.name}')">
                    <span class="flag">${c.flag}</span>
                    <span class="name">${c.name}</span>
                    <span class="code">${c.code}</span>
                </div>
            `).join('');
        }
        
        function toggleCountryList() {
            const list = document.getElementById('countryList');
            list.classList.toggle('active');
            if (list.classList.contains('active')) {
                document.getElementById('countrySearch').focus();
            }
        }
        
        function toggleCountryList2() {
            const list = document.getElementById('countryList2');
            list.classList.toggle('active');
            if (list.classList.contains('active')) {
                document.getElementById('countrySearch2').focus();
            }
        }
        
        function selectCountry(code, flag, name) {
            selectedCountry = { code, flag, name };
            document.getElementById('selectedFlag').textContent = flag;
            document.getElementById('selectedCode').textContent = code;
            document.getElementById('countryList').classList.remove('active');
            var phoneInput = document.getElementById('phoneInput');
            if (phoneInput) {
                phoneInput.value = '';
                var formats = {'+1':'(000) 000-0000', '+91':'00000 00000', '+44':'0000 000000', '+61':'000 000 000', '+971':'00 000 0000'};
                phoneInput.placeholder = formats[code] || '0000000000';
            }
        }
        
        function selectCountry2(code, flag, name) {
            selectedCountry = { code, flag, name };
            document.getElementById('selectedFlag2').textContent = flag;
            document.getElementById('selectedCode2').textContent = code;
            document.getElementById('countryList2').classList.remove('active');
            var phoneInput = document.getElementById('phoneInput2');
            if (phoneInput) {
                phoneInput.value = '';
                var formats = {'+1':'(000) 000-0000', '+91':'00000 00000', '+44':'0000 000000', '+61':'000 000 000', '+971':'00 000 0000'};
                phoneInput.placeholder = formats[code] || '0000000000';
            }
        }
        
        function filterCountries() {
            const query = document.getElementById('countrySearch').value.toLowerCase();
            const items = document.querySelectorAll('#countryItems .country-item');
            items.forEach(item => {
                const name = item.querySelector('.name').textContent.toLowerCase();
                item.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }
        
        function filterCountries2() {
            const query = document.getElementById('countrySearch2').value.toLowerCase();
            const items = document.querySelectorAll('#countryItems2 .country-item');
            items.forEach(item => {
                const name = item.querySelector('.name').textContent.toLowerCase();
                item.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }
        
        function initCountryList2() {
            const container = document.getElementById('countryItems2');
            if (!container) return;
            container.innerHTML = countries.map(c => `
                <div class="country-item" onclick="selectCountry2('${c.code}', '${c.flag}', '${c.name}')">
                    <span class="flag">${c.flag}</span>
                    <span class="name">${c.name}</span>
                    <span class="code">${c.code}</span>
                </div>
            `).join('');
        }
        
        // Close country list when clicking outside
        document.addEventListener('click', function(e) {
            const countryList = document.getElementById('countryList');
            const countryList2 = document.getElementById('countryList2');
            const countryBtns = document.querySelectorAll('.country-btn');
            let clickedBtn = false;
            countryBtns.forEach(btn => { if (btn.contains(e.target)) clickedBtn = true; });
            if (!clickedBtn) {
                if (countryList && !countryList.contains(e.target)) countryList.classList.remove('active');
                if (countryList2 && !countryList2.contains(e.target)) countryList2.classList.remove('active');
            }
        });
        
        // ========== SIGN UP / SIGN IN MODAL ==========
        function openSignUp() {
            // If already logged in, go straight to dashboard
            if (localStorage.getItem('tapinx_logged_in') === 'true') {
                showPage('dashboard');
                return;
            }
            isSigningIn = false;
            document.getElementById('signInModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            showSignupStep();
            initCountryList();
        }
        
        function openSignIn() {
            // If already logged in, go straight to dashboard
            if (localStorage.getItem('tapinx_logged_in') === 'true') {
                showPage('dashboard');
                return;
            }
            isSigningIn = true;
            document.getElementById('signInModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            showSigninStep();
            initCountryList();
            initCountryList2();
        }
        
        function closeSignIn(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('signInModal').classList.remove('active');
            document.body.style.overflow = '';
            resetModal();
        }
        
        function resetModal() {
            // Reset all steps
            document.getElementById('signupStep').classList.remove('hidden');
            document.getElementById('otpStep').classList.add('hidden');
            document.getElementById('signinStep').classList.add('hidden');
            
            // Clear all inputs
            document.getElementById('signupName').value = '';
            document.getElementById('signupAge').value = '';
            document.getElementById('phoneInput').value = '';
            if (document.getElementById('phoneInput2')) document.getElementById('phoneInput2').value = '';
            document.getElementById('termsCheckbox').checked = false;
            ['otp1','otp2','otp3','otp4','otp5','otp6'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            // Hide all errors
            document.querySelectorAll('.modal-error').forEach(el => el.style.display = 'none');
            
            // Clear timer
            if (resendTimer) clearInterval(resendTimer);
        }
        
        function showSignupStep() {
            document.getElementById('signupStep').classList.remove('hidden');
            document.getElementById('otpStep').classList.add('hidden');
            document.getElementById('signinStep').classList.add('hidden');
        }
        
        function showSigninStep() {
            document.getElementById('signupStep').classList.add('hidden');
            document.getElementById('otpStep').classList.add('hidden');
            document.getElementById('signinStep').classList.remove('hidden');
        }
        
        function showOtpStep() {
            document.getElementById('signupStep').classList.add('hidden');
            document.getElementById('signinStep').classList.add('hidden');
            document.getElementById('otpStep').classList.remove('hidden');
            document.getElementById('otp1').focus();
            startResendTimer();
        }
        
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            value = value.substring(0, 10);
            
            if (value.length > 6) {
                value = '(' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6);
            } else if (value.length > 3) {
                value = '(' + value.substring(0, 3) + ') ' + value.substring(3);
            } else if (value.length > 0) {
                value = '(' + value;
            }
            
            input.value = value;
        }
        
        function validatePhoneNumber(phone) {
            const digits = phone.replace(/\D/g, '');
            return digits.length >= 10;
        }
        
        function validateSignupForm() {
            const name = document.getElementById('signupName').value.trim();
            const age = document.getElementById('signupAge').value;
            const phone = document.getElementById('phoneInput').value;
            const terms = document.getElementById('termsCheckbox').checked;
            const btn = document.getElementById('submitBtn');
            
            // Check if all fields are valid
            const hasValidName = name && name.split(' ').filter(n => n).length >= 2;
            const hasAge = age !== '';
            const hasValidPhone = validatePhoneNumber(phone);
            const hasTerms = terms;
            
            if (hasValidName && hasAge && hasValidPhone && hasTerms) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }
        
        function submitSignup() {
            const name = document.getElementById('signupName').value.trim();
            const age = document.getElementById('signupAge').value;
            const phone = document.getElementById('phoneInput').value;
            const terms = document.getElementById('termsCheckbox').checked;
            
            let hasError = false;
            
            // Validate name (must have first and last name)
            if (!name || name.split(' ').filter(n => n).length < 2) {
                document.getElementById('nameError').textContent = 'Please enter your full name (first and last)';
                document.getElementById('nameError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('nameError').style.display = 'none';
            }
            
            // Validate age
            if (!age) {
                document.getElementById('ageError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('ageError').style.display = 'none';
            }
            
            // Validate phone
            if (!validatePhoneNumber(phone)) {
                document.getElementById('phoneError').textContent = 'Please enter a valid phone number';
                document.getElementById('phoneError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('phoneError').style.display = 'none';
            }
            
            // Validate terms
            if (!terms) {
                alert('Please agree to the Terms of Service');
                hasError = true;
            }
            
            if (hasError) return;
            
            // Store signup data temporarily
            localStorage.setItem('tapinx_signup_name', name);
            localStorage.setItem('tapinx_signup_age', age);
            localStorage.setItem('tapinx_signup_phone', selectedCountry.code + ' ' + phone);
            
            // Format phone for Firebase (E.164 format)
            const phoneDigits = phone.replace(/\D/g, '');
            const fullPhoneNumber = selectedCountry.code + phoneDigits;
            
            // Show loading state
            const btn = document.getElementById('submitBtn');
            btn.textContent = 'Sending code...';
            btn.disabled = true;
            
            // Store phone display
            document.getElementById('phoneDisplay').textContent = selectedCountry.code + ' ' + phone;
            
            // Check if Firebase is ready
            if (!firebaseReady || !auth) {
                // Demo mode - go straight to OTP step
                console.log('Using demo mode (Firebase not ready)');
                isSigningIn = false;
                showOtpStep();
                btn.textContent = 'Submit';
                btn.disabled = false;
                return;
            }
            
            // Try Firebase phone auth
            try {
                initRecaptcha();
                
                if (!recaptchaVerifier) {
                    // reCAPTCHA failed, use demo mode
                    console.log('Using demo mode (reCAPTCHA not ready)');
                    isSigningIn = false;
                    showOtpStep();
                    btn.textContent = 'Submit';
                    btn.disabled = false;
                    return;
                }
                
                // Format phone for Firebase (E.164 format)
                const phoneDigits = phone.replace(/\D/g, '');
                const fullPhoneNumber = selectedCountry.code + phoneDigits;
                
                auth.signInWithPhoneNumber(fullPhoneNumber, recaptchaVerifier)
                    .then((result) => {
                        confirmationResult = result;
                        isSigningIn = false;
                        showOtpStep();
                        btn.textContent = 'Submit';
                        btn.disabled = false;
                    })
                    .catch((error) => {
                        console.error('SMS Error:', error);
                        // On error, fall back to demo mode
                        console.log('Firebase failed, using demo mode');
                        isSigningIn = false;
                        showOtpStep();
                        btn.textContent = 'Submit';
                        btn.disabled = false;
                        recaptchaVerifier = null;
                    });
            } catch (error) {
                console.error('Firebase error:', error);
                // Fallback to demo mode
                isSigningIn = false;
                showOtpStep();
                btn.textContent = 'Submit';
                btn.disabled = false;
            }
        }
        
        function sendSigninCode() {
            const phone = document.getElementById('phoneInput2').value;
            
            if (!validatePhoneNumber(phone)) {
                document.getElementById('phoneError2').style.display = 'block';
                return;
            }
            
            document.getElementById('phoneError2').style.display = 'none';
            
            // Show loading state
            const btn = document.getElementById('signinBtn');
            btn.textContent = 'Sending code...';
            btn.disabled = true;
            
            // Store phone display
            document.getElementById('phoneDisplay').textContent = selectedCountry.code + ' ' + phone;
            
            // Check if Firebase is ready
            if (!firebaseReady || !auth) {
                // Demo mode
                console.log('Using demo mode (Firebase not ready)');
                isSigningIn = true;
                showOtpStep();
                btn.textContent = 'Send Code';
                btn.disabled = false;
                return;
            }
            
            // Try Firebase phone auth
            try {
                initRecaptcha();
                
                if (!recaptchaVerifier) {
                    console.log('Using demo mode (reCAPTCHA not ready)');
                    isSigningIn = true;
                    showOtpStep();
                    btn.textContent = 'Send Code';
                    btn.disabled = false;
                    return;
                }
                
                const phoneDigits = phone.replace(/\D/g, '');
                const fullPhoneNumber = selectedCountry.code + phoneDigits;
                
                auth.signInWithPhoneNumber(fullPhoneNumber, recaptchaVerifier)
                    .then((result) => {
                        confirmationResult = result;
                        isSigningIn = true;
                        showOtpStep();
                        btn.textContent = 'Send Code';
                        btn.disabled = false;
                    })
                    .catch((error) => {
                        console.error('SMS Error:', error);
                        // Fallback to demo mode
                        console.log('Firebase failed, using demo mode');
                        isSigningIn = true;
                        showOtpStep();
                        btn.textContent = 'Send Code';
                        btn.disabled = false;
                        recaptchaVerifier = null;
                    });
            } catch (error) {
                console.error('Firebase error:', error);
                isSigningIn = true;
                showOtpStep();
                btn.textContent = 'Send Code';
                btn.disabled = false;
            }
        }
        
        function startResendTimer() {
            let seconds = 60;
            const timerEl = document.getElementById('resendTimer');
            const linkEl = document.getElementById('resendLink');
            
            timerEl.style.display = 'inline';
            linkEl.style.display = 'none';
            
            if (resendTimer) clearInterval(resendTimer);
            
            resendTimer = setInterval(() => {
                seconds--;
                timerEl.textContent = `Resend code in ${seconds}s`;
                
                if (seconds <= 0) {
                    clearInterval(resendTimer);
                    timerEl.style.display = 'none';
                    linkEl.style.display = 'inline';
                }
            }, 1000);
        }
        
        function otpInput(current, nextId, prevId) {
            current.value = current.value.replace(/\D/g, '');
            
            if (current.value.length === 1 && nextId) {
                document.getElementById(nextId).focus();
            }
            
            const otp = ['otp1','otp2','otp3','otp4','otp5','otp6'].map(id => document.getElementById(id).value).join('');
            if (otp.length === 6) {
                verifyOtp();
            }
        }
        
        function otpKeydown(event, prevId) {
            if (event.key === 'Backspace' && event.target.value === '' && prevId) {
                document.getElementById(prevId).focus();
            }
        }
        
        function verifyOtp() {
            const otp = ['otp1','otp2','otp3','otp4','otp5','otp6'].map(id => document.getElementById(id).value).join('');
            
            if (otp.length === 6) {
                // Show loading state on verify button
                const verifyBtn = document.querySelector('#otpStep .modal-btn');
                verifyBtn.textContent = 'Verifying...';
                verifyBtn.disabled = true;
                
                // Verify with Firebase
                if (confirmationResult) {
                    confirmationResult.confirm(otp)
                    .then(async (result) => {
                            // User signed in successfully
                            const user = result.user;
                            console.log('User verified:', user.phoneNumber);
                            
                            // Store Firebase UID
                            localStorage.setItem('tapinx_uid', user.uid);
                            
                            verifyBtn.textContent = 'Verify';
                            verifyBtn.disabled = false;
                            closeSignIn();
                            
                            if (isSigningIn) {
                                // Returning user - save phone and sync with backend
                                localStorage.setItem('tapinx_logged_in', 'true');
                                localStorage.setItem('tapinx_user_phone', user.phoneNumber);
                                
                                // Sync with backend to get user ID
                                try {
                                    const API_URL = 'https://tapinx-backend-production.up.railway.app';
                                    const referredBy = localStorage.getItem('tapinx_referred_by');
                                    const referredOpp = localStorage.getItem('tapinx_referred_opportunity');
                                    
                                    const signupData = {
                                        phone: user.phoneNumber,
                                        name: 'User',
                                        referred_by: referredBy ? parseInt(referredBy) : null,
                                        referred_opportunity_id: referredOpp ? parseInt(referredOpp) : null
                                    };
                                    
                                    const response = await fetch(`${API_URL}/api/signup`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(signupData)
                                    });
                                    const data = await response.json();
                                    if (data.success && data.user) {
                                        localStorage.setItem('tapinx_user_id', data.user.id);
                                        if (data.user.name) localStorage.setItem('tapinx_user_name', data.user.name);
                                        console.log('[TapinX] User synced:', data.user.id);
                                        
                                        // Clear referral data after successful signup
                                        localStorage.removeItem('tapinx_referred_by');
                                        localStorage.removeItem('tapinx_referred_opportunity');
                                    }
                                } catch (e) {
                                    console.error('[TapinX] Backend sync error:', e);
                                }
                                
                                Router.navigate('opportunities');
                        } else {
                                // New user - transfer signup data to profile
                                const name = localStorage.getItem('tapinx_signup_name') || '';
                                const age = localStorage.getItem('tapinx_signup_age') || '';
                                const phone = localStorage.getItem('tapinx_signup_phone') || '';
                                const referredBy = localStorage.getItem('tapinx_referred_by');
                                const referredOpp = localStorage.getItem('tapinx_referred_opportunity');
                                
                                localStorage.setItem('tapinx_user_name', name);
                                localStorage.setItem('tapinx_user_age', age);
                                localStorage.setItem('tapinx_user_phone', phone);
                                
                                // Clean up signup data
                                localStorage.removeItem('tapinx_signup_name');
                                localStorage.removeItem('tapinx_signup_age');
                                localStorage.removeItem('tapinx_signup_phone');
                                
                                // Sync profile from backend (in case they have existing data)
                                fetchProfileFromBackend().then(() => {
                                    updateNewSidebar();
                                    
                                    // If referred for specific opportunity, save referral data
                                    if (referredBy || referredOpp) {
                                        const userId = localStorage.getItem('tapinx_user_id');
                                        if (userId) {
                                            fetch(API_URL + '/api/users/' + userId, {
                                                method: 'PATCH',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify({
                                                    referred_by: referredBy ? parseInt(referredBy) : null,
                                                    referred_opportunity_id: referredOpp ? parseInt(referredOpp) : null
                                                })
                                            }).catch(console.error);
                                        }
                                    }
                                    
                                    // Clear referral data after saving
                                    localStorage.removeItem('tapinx_referred_by');
                                    localStorage.removeItem('tapinx_referred_opportunity');
                                });
                                
                                Router.navigate('opportunities');
                                
                                // If referred for specific opportunity, show it
                                if (referredOpp) {
                                    setTimeout(() => {
                                        // The opportunity should appear in their feed
                                        // Could show a banner: "You were referred for this opportunity!"
                                    }, 500);
                                }
                                
                                setTimeout(() => openEditProfileModal(), 300);
                            }
                        })
                        .catch((error) => {
                            console.error('Verification error:', error);
                            verifyBtn.textContent = 'Verify';
                            verifyBtn.disabled = false;
                            
                            if (error.code === 'auth/invalid-verification-code') {
                                alert('Invalid code. Please check and try again.');
                            } else if (error.code === 'auth/code-expired') {
                                alert('Code expired. Please request a new one.');
                            } else {
                                alert('Verification failed. Please try again.');
                            }
                            
                            // Clear OTP inputs
                            ['otp1','otp2','otp3','otp4','otp5','otp6'].forEach(id => {
                                document.getElementById(id).value = '';
                            });
                            document.getElementById('otp1').focus();
                        });
                } else {
                    // No confirmation result - show error
                    alert('Something went wrong. Please try again.');
                    verifyBtn.textContent = 'Verify';
                    verifyBtn.disabled = false;
                }
            }
        }
        
        function resendCode() {
            // Resend OTP using Firebase
            const phone = document.getElementById('phoneDisplay').textContent;
            const phoneDigits = phone.replace(/[^\d+]/g, '');
            
            initRecaptcha();
            
            auth.signInWithPhoneNumber(phoneDigits, recaptchaVerifier)
                .then((result) => {
                    confirmationResult = result;
                    startResendTimer();
                })
                .catch((error) => {
                    console.error('Resend error:', error);
                    alert('Failed to resend code. Please try again.');
                    recaptchaVerifier = null;
                });
        }
        
        // ========== TELEGRAM MODAL ==========
        function showTelegramModal() {
            document.getElementById('telegramModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeTelegramModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('telegramModal').classList.remove('active');
            document.body.style.overflow = '';
            Router.navigate('opportunities');
        }
        
        function goToTelegram() {
            // Close modal and go to opportunities after a short delay
            setTimeout(() => {
                document.getElementById('telegramModal').classList.remove('active');
                document.body.style.overflow = '';
                showNewAppPage('opportunities');
            }, 500);
        }
        
        // ========== EDIT PROFILE MODAL ==========
        let originalProfileData = {};
        
        // Initialize age dropdown for modal
        (function initEditAgeDropdown() {
            const select = document.getElementById('editAgeInput');
            if (select) {
                for (let i = 18; i <= 80; i++) {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = i;
                    select.appendChild(opt);
                }
            }
        })();
        
        function openEditProfileModal() {
            // Close any dropdowns
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            
            // Load current data
            const name = localStorage.getItem('tapinx_user_name') || '';
            const age = localStorage.getItem('tapinx_user_age') || '';
            const bio = localStorage.getItem('tapinx_user_bio') || '';
            const photo = localStorage.getItem('tapinx_user_photo');
            const linkedin = localStorage.getItem('tapinx_user_linkedin') || '';
            const instagram = localStorage.getItem('tapinx_user_instagram') || '';
            const twitter = localStorage.getItem('tapinx_user_twitter') || '';
            const soundcloud = localStorage.getItem('tapinx_user_soundcloud') || '';
            const imdb = localStorage.getItem('tapinx_user_imdb') || '';
            const savedSkills = localStorage.getItem('tapinx_user_skills');
            const skills = savedSkills ? JSON.parse(savedSkills) : [];
            
            // Store original data for comparison (including skills)
            originalProfileData = { name, age, bio, photo, linkedin, instagram, twitter, soundcloud, imdb, skills };
            
            // Populate form
            document.getElementById('editNameInput').value = name;
            document.getElementById('editAgeInput').value = age;
            document.getElementById('editBioInput').value = bio;
            document.getElementById('editLinkedinInput').value = linkedin;
            document.getElementById('editInstagramInput').value = instagram;
            document.getElementById('editTwitterInput').value = twitter;
            document.getElementById('editSoundcloudInput').value = soundcloud;
            document.getElementById('editImdbInput').value = imdb;
            
            // Set photo
            const initial = name ? name.charAt(0).toUpperCase() : 'T';
            document.getElementById('editPhotoPlaceholder').textContent = initial;
            
            if (photo) {
                document.getElementById('editPhotoPreview').src = photo;
                document.getElementById('editPhotoPreview').style.display = 'block';
                document.getElementById('editPhotoPlaceholder').style.display = 'none';
            } else {
                document.getElementById('editPhotoPreview').style.display = 'none';
                document.getElementById('editPhotoPlaceholder').style.display = 'flex';
            }
            
            // Initialize skills
            initSkills();
            
            // Validate links
            validateEditLinks();
            checkEditForm();
            
            // Show modal
            document.getElementById('editProfileOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeEditProfileModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('editProfileOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function handleEditPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editPhotoPreview').src = e.target.result;
                    document.getElementById('editPhotoPreview').style.display = 'block';
                    document.getElementById('editPhotoPlaceholder').style.display = 'none';
                    checkEditForm();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function validateEditUrl(url, type) {
            if (!url) return 'empty';
            const patterns = {
                linkedin: /linkedin\.com\/(in|company)\//i,
                instagram: /instagram\.com\//i,
                twitter: /(twitter\.com|x\.com)\//i,
                soundcloud: /soundcloud\.com\//i,
                imdb: /imdb\.com\/(name|title)\//i
            };
            return patterns[type].test(url) ? 'valid' : 'invalid';
        }
        
        function validateEditLinks() {
            const fields = ['linkedin', 'instagram', 'twitter', 'soundcloud', 'imdb'];
            
            fields.forEach(field => {
                const input = document.getElementById('edit' + field.charAt(0).toUpperCase() + field.slice(1) + 'Input');
                const status = document.getElementById('edit' + field.charAt(0).toUpperCase() + field.slice(1) + 'Status');
                const val = input.value;
                const result = validateEditUrl(val, field);
                
                status.className = 'edit-validation-icon';
                status.textContent = '';
                
                if (result === 'valid') {
                    status.classList.add('valid');
                    status.textContent = '';
                } else if (result === 'invalid') {
                    status.classList.add('invalid');
                    status.textContent = '';
                }
            });
            
            checkEditForm();
        }
        
        function checkEditForm() {
            const name = document.getElementById('editNameInput').value.trim();
            const instagram = document.getElementById('editInstagramInput').value;
            const instagramValid = validateEditUrl(instagram, 'instagram') === 'valid';
            
            const saveBtn = document.getElementById('editSaveBtn');
            if (saveBtn) {
                // Just require name and valid Instagram - no change detection
                saveBtn.disabled = !(name && instagramValid);
            }
        }
        
        function saveEditProfile() {
            const name = document.getElementById('editNameInput').value.trim();
            const instagram = document.getElementById('editInstagramInput').value;
            
            if (!name || validateEditUrl(instagram, 'instagram') !== 'valid') return;
            
            // Gather all profile data
            const profileData = {
                name: name,
                age: document.getElementById('editAgeInput').value,
                bio: document.getElementById('editBioInput').value,
                linkedin: document.getElementById('editLinkedinInput').value,
                instagram: instagram,
                twitter: document.getElementById('editTwitterInput').value,
                soundcloud: document.getElementById('editSoundcloudInput').value,
                imdb: document.getElementById('editImdbInput').value,
                skills: selectedSkills,
                photo: document.getElementById('editPhotoPreview').style.display === 'block' 
                    ? document.getElementById('editPhotoPreview').src 
                    : null
            };
            
            // Save to localStorage (immediate)
            localStorage.setItem('tapinx_logged_in', 'true');
            localStorage.setItem('tapinx_user_name', profileData.name);
            localStorage.setItem('tapinx_user_age', profileData.age);
            localStorage.setItem('tapinx_user_bio', profileData.bio);
            localStorage.setItem('tapinx_user_linkedin', profileData.linkedin);
            localStorage.setItem('tapinx_user_instagram', profileData.instagram);
            localStorage.setItem('tapinx_user_twitter', profileData.twitter);
            localStorage.setItem('tapinx_user_soundcloud', profileData.soundcloud);
            localStorage.setItem('tapinx_user_imdb', profileData.imdb);
            localStorage.setItem('tapinx_user_skills', JSON.stringify(profileData.skills));
            if (profileData.photo) {
                localStorage.setItem('tapinx_user_photo', profileData.photo);
            }
            
            // Save to backend database
            saveProfileToBackend(profileData);
            
            // Close modal and show toast
            closeEditProfileModal();
            showNewToast('Profile saved');
            
            // Update the new sidebar with saved data
            updateNewSidebar();
            
            // Reload dashboard if on it
            if (document.getElementById('dashboardPage').classList.contains('active')) {
                loadDashboard();
            }
            
            // Trigger profile scraping webhook if Instagram was added
            if (instagram && validateEditUrl(instagram, 'instagram') === 'valid') {
                triggerProfileScrape(instagram);
            }
        }
        
        // Save profile to backend database
        async function saveProfileToBackend(profileData) {
            const phone = localStorage.getItem('tapinx_user_phone');
            if (!phone) {
                console.log('No phone number - skipping backend save');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/users/${encodeURIComponent(phone)}/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        full_name: profileData.name,
                        age: profileData.age,
                        bio: profileData.bio,
                        linkedin_url: profileData.linkedin,
                        instagram_url: profileData.instagram,
                        twitter_url: profileData.twitter,
                        soundcloud_url: profileData.soundcloud,
                        imdb_url: profileData.imdb,
                        skills: profileData.skills,
                        photo_url: profileData.photo
                    })
                });
                
                if (response.ok) {
                    console.log('[TapinX] Profile saved to backend');
                } else {
                    console.error('[TapinX] Failed to save profile to backend:', response.status);
                }
            } catch (error) {
                console.error('[TapinX] Error saving profile to backend:', error);
                // Don't show error to user - localStorage save already succeeded
            }
        }
        
        // ========== SKILLS SYSTEM ==========
        let selectedSkills = [];
        const maxSkills = 5;
        
        const skillsData = {
            tech: [
                'JavaScript', 'Python', 'React', 'Node.js', 'TypeScript', 'AWS', 'Machine Learning', 
                'AI/ML', 'Data Science', 'iOS Development', 'Android', 'DevOps', 'Cloud Architecture',
                'Blockchain', 'Cybersecurity', 'Full Stack', 'Frontend', 'Backend', 'Mobile Development',
                'Database Design', 'API Design', 'System Design', 'Product Engineering'
            ],
            creative: [
                'UI/UX Design', 'Graphic Design', 'Brand Design', 'Video Production', 'Photography',
                'Motion Graphics', 'Illustration', '3D Design', 'Animation', 'Art Direction',
                'Content Creation', 'Copywriting', 'Creative Direction', 'Music Production',
                'Sound Design', 'Film Making', 'Podcast Production', 'Social Media Content'
            ],
            business: [
                'Product Management', 'Project Management', 'Strategy', 'Marketing', 'Sales',
                'Business Development', 'Operations', 'Finance', 'Consulting', 'Analytics',
                'Growth Marketing', 'SEO/SEM', 'Partnerships', 'Fundraising', 'Investor Relations',
                'Customer Success', 'Account Management', 'Team Leadership', 'Executive Leadership'
            ],
            other: [
                'Public Speaking', 'Writing', 'Coaching', 'Mentorship', 'Community Building',
                'Event Planning', 'Recruiting', 'HR', 'Legal', 'Real Estate', 'Healthcare',
                'Education', 'Research', 'Non-profit', 'Sustainability', 'Fitness', 'Wellness'
            ]
        };
        
        function initSkills() {
            // Load saved skills
            const saved = localStorage.getItem('tapinx_user_skills');
            if (saved) {
                selectedSkills = JSON.parse(saved);
            } else {
                selectedSkills = [];
            }
            renderSelectedSkills();
            renderSkillsGrid('all');
        }
        
        function renderSelectedSkills() {
            const container = document.getElementById('selectedSkills');
            if (!container) return;
            
            if (selectedSkills.length === 0) {
                container.innerHTML = '<span style="color: #536471; font-size: 13px;">No skills selected yet</span>';
                return;
            }
            
            container.innerHTML = selectedSkills.map(skill => `
                <span class="skill-tag">
                    ${skill}
                    <button class="skill-tag-remove" onclick="removeSkill('${skill}')"></button>
                </span>
            `).join('');
        }
        
        function renderSkillsGrid(category) {
            const grid = document.getElementById('skillsGrid');
            if (!grid) return;
            
            let skills = [];
            if (category === 'all') {
                skills = [...skillsData.tech, ...skillsData.creative, ...skillsData.business, ...skillsData.other];
            } else {
                skills = skillsData[category] || [];
            }
            
            // Sort alphabetically
            skills.sort();
            
            grid.innerHTML = skills.map(skill => {
                const isSelected = selectedSkills.includes(skill);
                const isDisabled = !isSelected && selectedSkills.length >= maxSkills;
                return `
                    <button class="skill-option ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                            onclick="toggleSkill('${skill}')" 
                            ${isDisabled ? 'disabled' : ''}>
                        ${skill}
                    </button>
                `;
            }).join('');
        }
        
        function showSkillCategory(category, btn) {
            document.querySelectorAll('.skills-category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderSkillsGrid(category);
        }
        
        function toggleSkill(skill) {
            if (selectedSkills.includes(skill)) {
                removeSkill(skill);
            } else if (selectedSkills.length < maxSkills) {
                selectedSkills.push(skill);
                renderSelectedSkills();
                renderSkillsGrid(getCurrentCategory());
                checkEditForm();
            }
        }
        
        function removeSkill(skill) {
            selectedSkills = selectedSkills.filter(s => s !== skill);
            renderSelectedSkills();
            renderSkillsGrid(getCurrentCategory());
            checkEditForm();
        }
        
        function getCurrentCategory() {
            const activeBtn = document.querySelector('.skills-category-btn.active');
            if (activeBtn) {
                const text = activeBtn.textContent.toLowerCase();
                if (text === 'all') return 'all';
                return text;
            }
            return 'all';
        }
        
        function filterSkills(query) {
            const dropdown = document.getElementById('skillsDropdown');
            if (!query.trim()) {
                dropdown.classList.remove('show');
                return;
            }
            
            const allSkills = [...skillsData.tech, ...skillsData.creative, ...skillsData.business, ...skillsData.other];
            const filtered = allSkills.filter(s => 
                s.toLowerCase().includes(query.toLowerCase()) && !selectedSkills.includes(s)
            ).slice(0, 5);
            
            let html = filtered.map(skill => `
                <div class="skills-dropdown-item" onclick="selectSkillFromDropdown('${skill}')">${skill}</div>
            `).join('');
            
            // Add custom skill option if no exact match
            const exactMatch = allSkills.some(s => s.toLowerCase() === query.toLowerCase());
            if (!exactMatch && query.trim().length > 1 && selectedSkills.length < maxSkills) {
                html += `<div class="skills-dropdown-item add-custom" onclick="addCustomSkill('${query.trim()}')">+ Add "${query.trim()}"</div>`;
            }
            
            dropdown.innerHTML = html;
            dropdown.classList.add('show');
        }
        
        function showSkillsDropdown() {
            const input = document.getElementById('skillsSearchInput');
            if (input.value.trim()) {
                filterSkills(input.value);
            }
        }
        
        function selectSkillFromDropdown(skill) {
            if (selectedSkills.length < maxSkills) {
                selectedSkills.push(skill);
                renderSelectedSkills();
                renderSkillsGrid(getCurrentCategory());
                document.getElementById('skillsSearchInput').value = '';
                document.getElementById('skillsDropdown').classList.remove('show');
                checkEditForm();
            }
        }
        
        function addCustomSkill(skill) {
            if (selectedSkills.length < maxSkills && !selectedSkills.includes(skill)) {
                selectedSkills.push(skill);
                renderSelectedSkills();
                document.getElementById('skillsSearchInput').value = '';
                document.getElementById('skillsDropdown').classList.remove('show');
                checkEditForm();
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('skillsDropdown');
            const input = document.getElementById('skillsSearchInput');
            if (dropdown && input && !dropdown.contains(e.target) && e.target !== input) {
                dropdown.classList.remove('show');
            }
        });
        
        // ========== PROFILE SCRAPING ==========
        async function triggerProfileScrape(instagramUrl) {
            // This sends a webhook to your n8n workflow
            // The workflow will scrape the profile and update via API
            try {
                const webhookUrl = 'https://your-n8n-instance.com/webhook/scrape-profile';
                const userId = localStorage.getItem('tapinx_user_id') || 'user_' + Date.now();
                
                // Store user ID if not exists
                if (!localStorage.getItem('tapinx_user_id')) {
                    localStorage.setItem('tapinx_user_id', userId);
                }
                
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: userId,
                        instagramUrl: instagramUrl,
                        linkedinUrl: document.getElementById('editLinkedinInput').value || null
                    })
                });
                
                console.log('Profile scrape triggered');
            } catch (error) {
                console.log('Profile scrape webhook not configured');
            }
        }
        
        function showProfileBuilding() {
            document.getElementById('profileBuildingOverlay').classList.add('show');
        }
        
        function hideProfileBuilding() {
            document.getElementById('profileBuildingOverlay').classList.remove('show');
        }
        
        // Function to receive scraped data (called by webhook callback or polling)
        function applyScrapedProfile(data) {
            if (data.name) {
                document.getElementById('editNameInput').value = data.name;
            }
            if (data.bio) {
                document.getElementById('editBioInput').value = data.bio;
            }
            if (data.photo) {
                const preview = document.getElementById('editPhotoPreview');
                preview.src = data.photo;
                preview.style.display = 'block';
                document.getElementById('editPhotoPlaceholder').style.display = 'none';
            }
            if (data.skills && Array.isArray(data.skills)) {
                selectedSkills = data.skills.slice(0, maxSkills);
                renderSelectedSkills();
                renderSkillsGrid(getCurrentCategory());
            }
            
            hideProfileBuilding();
            showNewToast('Profile updated from your social links!');
            checkEditForm();
        }
        
        // ========== PROFILE PAGE ==========
        function handlePhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').src = e.target.result;
                    document.getElementById('photoPreview').style.display = 'block';
                    document.getElementById('photoPlaceholder').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function validateUrl(url, type) {
            if (!url) return 'empty';
            const patterns = {
                linkedin: /linkedin\.com\/(in|company)\//i,
                instagram: /instagram\.com\//i,
                twitter: /(twitter\.com|x\.com)\//i,
                soundcloud: /soundcloud\.com\//i,
                imdb: /imdb\.com\/(name|title)\//i
            };
            return patterns[type].test(url) ? 'valid' : 'invalid';
        }
        
        function validateAllSocials() {
            const fields = ['linkedin', 'instagram', 'twitter', 'soundcloud', 'imdb'];
            fields.forEach(field => {
                const val = document.getElementById(field + 'Input').value;
                const status = validateUrl(val, field);
                const el = document.getElementById(field + 'Status');
                el.className = 'social-status ' + status;
                el.textContent = status === 'valid' ? '' : status === 'invalid' ? '' : '';
            });
            
            const linkedin = document.getElementById('linkedinInput').value;
            document.getElementById('linkedinRequired').style.display = linkedin ? 'none' : 'inline';
            checkForm();
        }
        
        function checkForm() {
            const name = document.getElementById('nameInput').value.trim();
            const linkedin = document.getElementById('linkedinInput').value;
            document.getElementById('doneBtn').disabled = !(name && validateUrl(linkedin, 'linkedin') === 'valid');
        }
        
        function loadProfileData() {
            const name = localStorage.getItem('tapinx_user_name') || '';
            const bio = localStorage.getItem('tapinx_user_bio') || '';
            const photo = localStorage.getItem('tapinx_user_photo');
            
            document.getElementById('nameInput').value = name;
            document.getElementById('bioInput').value = bio;
            document.getElementById('linkedinInput').value = localStorage.getItem('tapinx_user_linkedin') || '';
            document.getElementById('instagramInput').value = localStorage.getItem('tapinx_user_instagram') || '';
            document.getElementById('twitterInput').value = localStorage.getItem('tapinx_user_twitter') || '';
            document.getElementById('soundcloudInput').value = localStorage.getItem('tapinx_user_soundcloud') || '';
            document.getElementById('imdbInput').value = localStorage.getItem('tapinx_user_imdb') || '';
            
            if (photo) {
                document.getElementById('photoPreview').src = photo;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('photoPlaceholder').style.display = 'none';
            }
            
            if (name) {
                document.getElementById('photoPlaceholder').textContent = name.charAt(0).toUpperCase();
            }
            
            validateAllSocials();
            checkForm();
        }
        
        function saveProfile() {
            const name = document.getElementById('nameInput').value.trim();
            const bio = document.getElementById('bioInput').value.trim();
            const linkedin = document.getElementById('linkedinInput').value;
            
            if (!name || validateUrl(linkedin, 'linkedin') !== 'valid') return;
            
            // Check if this is a new user (first time saving)
            const isNewUser = !localStorage.getItem('tapinx_logged_in');
            
            localStorage.setItem('tapinx_logged_in', 'true');
            localStorage.setItem('tapinx_user_name', name);
            localStorage.setItem('tapinx_user_bio', bio);
            localStorage.setItem('tapinx_user_linkedin', linkedin);
            localStorage.setItem('tapinx_user_instagram', document.getElementById('instagramInput').value);
            localStorage.setItem('tapinx_user_twitter', document.getElementById('twitterInput').value);
            localStorage.setItem('tapinx_user_soundcloud', document.getElementById('soundcloudInput').value);
            localStorage.setItem('tapinx_user_imdb', document.getElementById('imdbInput').value);
            
            const photo = document.getElementById('photoPreview');
            if (photo.style.display === 'block') {
                localStorage.setItem('tapinx_user_photo', photo.src);
            }
            
            showToast('Profile saved!');
            
            if (isNewUser) {
                // Show Telegram modal for new users
                setTimeout(() => showTelegramModal(), 1500);
            } else {
                // Go to opportunities for returning users
                setTimeout(() => Router.navigate('opportunities'), 1500);
            }
        }
        
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
    
       // ========== DASHBOARD PAGE ==========
       async function loadDashboard() {
            const name = localStorage.getItem('tapinx_user_name') || 'User';
            const bio = localStorage.getItem('tapinx_user_bio') || 'No bio yet';
            const photo = localStorage.getItem('tapinx_user_photo');
            const initial = name.charAt(0).toUpperCase();
            
            document.getElementById('dashHeaderName').textContent = name;
            document.getElementById('welcomeName').textContent = name.split(' ')[0];
            document.getElementById('dashProfileName').textContent = name;
            document.getElementById('dashProfileBio').textContent = bio;
            document.getElementById('dashAvatarInitial').textContent = initial;
            document.getElementById('dashProfileInitial').textContent = initial;
            
            if (photo) {
                ['dashAvatarImg', 'dashProfileImg'].forEach(id => {
                    document.getElementById(id).src = photo;
                    document.getElementById(id).style.display = 'block';
                });
                document.getElementById('dashAvatarInitial').style.display = 'none';
                document.getElementById('dashProfileInitial').style.display = 'none';
            }
            
            const socials = document.getElementById('dashProfileSocials');
            socials.innerHTML = '';
            const links = [
                ['linkedin', '', 'LinkedIn'],
                ['instagram', '', 'Instagram'],
                ['twitter', '', 'Twitter'],
                ['soundcloud', '', 'SoundCloud'],
                ['imdb', '', 'IMDB']
            ];
            links.forEach(([key, icon, label]) => {
                const url = localStorage.getItem('tapinx_user_' + key);
                if (url) {
                    socials.innerHTML += `<a href="${url}" target="_blank" class="social-badge">${icon} ${label}</a>`;
                }
            });
            
            // Fetch real data from API
            const { count: matchCount } = await fetchMatches();
            const { count: connectionCount } = await fetchConnections();
            
            // Update Attention Required count
            const attentionCard = document.getElementById('attentionCard');
            const attentionDesc = attentionCard ? attentionCard.querySelector('.action-desc') : null;
            if (attentionDesc) {
                if (matchCount === 0) {
                    attentionDesc.textContent = 'No pending requests';
                } else if (matchCount === 1) {
                    attentionDesc.textContent = '1 opportunity waiting';
                } else {
                    attentionDesc.textContent = `${matchCount} opportunities waiting`;
                }
                // Toggle highlight based on match count
                if (matchCount > 0) {
                    attentionCard.classList.add('attention-card-highlight');
                } else {
                    attentionCard.classList.remove('attention-card-highlight');
                }
            }
            
            // Update connections count
            const connectionsCard = document.getElementById('connectionsCard');
            const connectionsDesc = connectionsCard ? connectionsCard.querySelector('.action-desc') : null;
            if (connectionsDesc) {
                if (connectionCount === 0) {
                    connectionsDesc.textContent = 'View your network';
                } else if (connectionCount === 1) {
                    connectionsDesc.textContent = '1 connection';
                } else {
                    connectionsDesc.textContent = `${connectionCount} connections`;
                }
                // Toggle highlight based on connection count
                if (connectionCount > 0) {
                    connectionsCard.classList.add('attention-card-highlight');
                } else {
                    connectionsCard.classList.remove('attention-card-highlight');
                }
            }
        }
        function toggleDropdown(e) {
            e.stopPropagation();
            document.getElementById('dashDropdown').classList.toggle('active');
        }
        
        function toggleConnectionsDropdown(e) {
            e.stopPropagation();
            document.getElementById('connDropdown').classList.toggle('active');
        }
        
        document.addEventListener('click', () => {
            document.getElementById('dashDropdown').classList.remove('active');
            const connDropdown = document.getElementById('connDropdown');
            if (connDropdown) connDropdown.classList.remove('active');
            const attnDropdown = document.getElementById('attnDropdown');
            if (attnDropdown) attnDropdown.classList.remove('active');
        });
        
        function logout() {
            console.log('[Logout] Logging out user');
            
            // Clear all user data
            localStorage.clear();
            
            // Use replace to prevent back-button into logged-in state
            window.location.replace('/');
        }
        
        // ========== CONNECTIONS PAGE ==========
        async function loadConnections() {
            const name = localStorage.getItem('tapinx_user_name') || 'User';
            const photo = localStorage.getItem('tapinx_user_photo');
            const initial = name.charAt(0).toUpperCase();
            
            // Update header
            document.getElementById('connHeaderName').textContent = name;
            document.getElementById('connAvatarInitial').textContent = initial;
            
            if (photo) {
                document.getElementById('connAvatarImg').src = photo;
                document.getElementById('connAvatarImg').style.display = 'block';
                document.getElementById('connAvatarInitial').style.display = 'none';
            }
            
            // Update context rail
            const railInitial = document.getElementById('connRailInitial');
            const railImg = document.getElementById('connRailImg');
            const railName = document.getElementById('connRailName');
            
            if (railInitial) railInitial.textContent = initial;
            if (railName) railName.textContent = name;
            if (railImg && photo) {
                railImg.src = photo;
                railImg.style.display = 'block';
                if (railInitial) railInitial.style.display = 'none';
            }
            
            // Get elements
            const connList = document.getElementById('connList');
            const emptyConnections = document.getElementById('emptyConnections');
            const searchBar = document.getElementById('connSearchBar');
            
            // Show loading
            connList.innerHTML = '<div style="text-align:center;padding:40px;color:#888;">Loading...</div>';
            if (emptyConnections) emptyConnections.style.display = 'none';
            
            // Fetch real connections from API
            const { connections, count } = await fetchConnections();
            
            // Update counts
            const pendingCount = 0; // Will come from API later
            document.getElementById('connAllCount').textContent = count;
            document.getElementById('connPendingCount').textContent = pendingCount;
            document.getElementById('connConnectedCount').textContent = count;
            
            // Update rail counts
            const railConnCount = document.getElementById('railConnCount');
            if (railConnCount) railConnCount.textContent = count;
            
            // Handle tabs - conditional red and softening
            document.querySelectorAll('.workspace-tab').forEach(tab => {
                const countEl = tab.querySelector('.workspace-tab-count');
                const tabCount = countEl ? parseInt(countEl.textContent) : 0;
                
                // Remove all state classes first
                tab.classList.remove('has-action');
            });
            
            // Red only when pending > 0 (action required)
            if (pendingCount > 0) {
                const pendingTab = document.querySelector('.workspace-tab[onclick*="pending"]');
                if (pendingTab) {
                    pendingTab.classList.add('has-action');
                }
            }
            
            // De-emphasize search when empty
            if (searchBar) {
                if (count === 0) {
                    searchBar.classList.add('subdued');
                } else {
                    searchBar.classList.remove('subdued');
                }
            }
            
            if (count === 0) {
                connList.innerHTML = '';
                connList.style.display = 'none';
                if (emptyConnections) emptyConnections.style.display = 'block';
            } else {
                if (emptyConnections) emptyConnections.style.display = 'none';
                connList.style.display = 'block';
                connList.innerHTML = connections.map(c => renderConnectionRow(c)).join('');
            }
        }
        
        function renderConnectionRow(conn) {
            const initial = conn.name ? conn.name.charAt(0).toUpperCase() : '?';
            const timeAgo = formatTimeAgo(conn.connected_at);
            const context = conn.role || conn.title || '';
            
            return `
                <div class="workspace-row" data-conn-status="connected" data-name="${conn.name || 'Unknown'}">
                    <div class="workspace-row-avatar">${initial}</div>
                    <div class="workspace-row-content">
                        <div class="workspace-row-name">${conn.name || 'Unknown'}</div>
                        <div class="workspace-row-context">${context}</div>
                        <div class="workspace-row-meta">Introduced by Taj  ${timeAgo}</div>
                    </div>
                    <div class="workspace-row-actions">
                        <button class="workspace-btn workspace-btn-primary" onclick="messageConnection(this, '${conn.name}')">Message</button>
                        ${conn.linkedin_url ? `<button class="workspace-btn workspace-btn-secondary" onclick="window.open('${conn.linkedin_url}', '_blank')">View</button>` : ''}
                    </div>
                </div>
            `;
        }
        
        // Current connection status view
        let currentConnStatus = 'all';
        
        function setConnStatus(btn, status) {
            document.querySelectorAll('#connectionsPage .workspace-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            currentConnStatus = status;
            
            const connList = document.getElementById('connList');
            const emptyConnections = document.getElementById('emptyConnections');
            
            // Count items
            const connectedCount = document.querySelectorAll('.workspace-row[data-conn-status="connected"]').length;
            
            if (status === 'all' || status === 'connected') {
                if (connectedCount > 0) {
                    connList.style.display = 'block';
                    if (emptyConnections) emptyConnections.style.display = 'none';
                } else {
                    connList.style.display = 'none';
                    if (emptyConnections) emptyConnections.style.display = 'block';
                }
            } else if (status === 'pending') {
                // No pending items yet - show empty
                connList.style.display = 'none';
                if (emptyConnections) emptyConnections.style.display = 'block';
            }
        }
        
        function setConnFilter(btn, category) {
            // Filter pills removed - this function kept for compatibility
        }
        
        function filterConnections() {
            const query = document.getElementById('connSearchInput').value.toLowerCase();
            
            document.querySelectorAll('.workspace-row').forEach(row => {
                const name = row.dataset.name ? row.dataset.name.toLowerCase() : '';
                const context = row.querySelector('.workspace-row-context');
                const contextText = context ? context.textContent.toLowerCase() : '';
                
                if (name.includes(query) || contextText.includes(query)) {
                    row.style.display = 'flex';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function updateConnCounts() {
            const connectedCount = document.querySelectorAll('.workspace-row[data-conn-status="connected"]').length;
            
            document.getElementById('connAllCount').textContent = connectedCount;
            document.getElementById('connPendingCount').textContent = 0;
            document.getElementById('connConnectedCount').textContent = connectedCount;
            document.getElementById('pendingBadge').textContent = pendingCount;
        }
        
        function showConnToast(message) {
            const toast = document.getElementById('connToast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        function acceptConnection(btn) {
            const card = btn.closest('.attention-card');
            const name = card.dataset.name;
            
            // Animate card
            card.classList.add('accepting');
            
            setTimeout(() => {
                // Remove from pending
                card.remove();
                
                // Update counts
                updateConnCounts();
                showConnToast(`Intro accepted! Taj will connect you with ${name}`);
                
                // Check empty state
                checkConnEmptyState();
                
                // Open Telegram
                const message = encodeURIComponent(`Hey Taj, I accepted the intro to ${name}. Please connect us!`);
                window.open(`https://t.me/TapinXBot?text=${message}`, '_blank');
            }, 300);
        }
        
        function declineConnection(btn) {
            const card = btn.closest('.attention-card');
            const name = card.dataset.name;
            
            // Animate card
            card.classList.add('declining');
            
            setTimeout(() => {
                // Remove from pending
                card.remove();
                
                // Update counts
                updateConnCounts();
                showConnToast('Connection declined');
                
                // Check empty state
                checkConnEmptyState();
            }, 300);
        }
        
        function replyToConnection(btn, name) {
            const message = encodeURIComponent(`Hey Taj, I'd like to reply to ${name}'s message: `);
            window.open(`https://t.me/TapinXBot?text=${message}`, '_blank');
        }
        
        function messageConnection(btn, name) {
            const message = encodeURIComponent(`Hey Taj, can you help me reach out to ${name}?`);
            window.open(`https://t.me/TapinXBot?text=${message}`, '_blank');
        }
        
        function checkConnEmptyState() {
            const connectedCount = document.querySelectorAll('.workspace-row[data-conn-status="connected"]').length;
            const connList = document.getElementById('connList');
            const emptyConnections = document.getElementById('emptyConnections');
            
            if (connectedCount === 0) {
                if (connList) connList.style.display = 'none';
                if (emptyConnections) emptyConnections.style.display = 'block';
            } else {
                if (connList) connList.style.display = 'block';
                if (emptyConnections) emptyConnections.style.display = 'none';
            }
        }
        
        // Keyboard shortcut for search
        document.addEventListener('keydown', function(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('connSearchInput');
                if (searchInput) searchInput.focus();
            }
        });
        
        // ========== ATTENTION REQUIRED PAGE ==========
        async function loadAttention() {
            const name = localStorage.getItem('tapinx_user_name') || 'User';
            const photo = localStorage.getItem('tapinx_user_photo');
            const initial = name.charAt(0).toUpperCase();
            
            // Update header
            document.getElementById('attnHeaderName').textContent = name;
            document.getElementById('attnAvatarInitial').textContent = initial;
            
            if (photo) {
                document.getElementById('attnAvatarImg').src = photo;
                document.getElementById('attnAvatarImg').style.display = 'block';
                document.getElementById('attnAvatarInitial').style.display = 'none';
            }
            
            // Update context rail
            const railInitial = document.getElementById('attnRailInitial');
            const railImg = document.getElementById('attnRailImg');
            const railName = document.getElementById('attnRailName');
            
            if (railInitial) railInitial.textContent = initial;
            if (railName) railName.textContent = name;
            if (railImg && photo) {
                railImg.src = photo;
                railImg.style.display = 'block';
                if (railInitial) railInitial.style.display = 'none';
            }
            
            // Get elements
            const attnList = document.getElementById('attnList');
            const emptyAttnActive = document.getElementById('emptyAttnActive');
            
            // Show loading
            if (attnList) attnList.innerHTML = '<div style="text-align:center;padding:40px;color:#888;">Loading...</div>';
            if (emptyAttnActive) emptyAttnActive.style.display = 'none';
            
            // Fetch real matches from API
            const { matches, count } = await fetchMatches();
            
            // Update counts
            const needsCount = document.getElementById('attnNeedsCount');
            const interestedCount = document.getElementById('attnInterestedCount');
            const passedCount = document.getElementById('attnPassedCount');
            
            if (needsCount) needsCount.textContent = count;
            if (interestedCount) interestedCount.textContent = '0';
            if (passedCount) passedCount.textContent = '0';
            
            // Update rail counts
            const railAttnCount = document.getElementById('attnRailAttnCount');
            if (railAttnCount) railAttnCount.textContent = count;
            
            // Handle red tab when action required
            const needsTab = document.getElementById('attnTabNeeds');
            if (needsTab) {
                if (count > 0) {
                    needsTab.classList.add('has-action');
                } else {
                    needsTab.classList.remove('has-action');
                }
            }
            
            if (count === 0) {
                if (attnList) attnList.innerHTML = '';
                if (attnList) attnList.style.display = 'none';
                if (emptyAttnActive) emptyAttnActive.style.display = 'block';
            } else {
                if (emptyAttnActive) emptyAttnActive.style.display = 'none';
                if (attnList) {
                    attnList.style.display = 'block';
                    attnList.innerHTML = matches.map(m => renderAttnRow(m)).join('');
                }
            }
        }
        
        function renderAttnRow(match) {
            const initial = match.other_name ? match.other_name.charAt(0).toUpperCase() : 'T';
            const timeAgo = formatTimeAgo(match.created_at);
            
            return `
                <div class="workspace-row" data-status="active" data-id="${match.id}">
                    <div class="workspace-row-avatar">${initial}</div>
                    <div class="workspace-row-content">
                        <div class="workspace-row-name">${match.other_name || 'New Connection'}</div>
                        <div class="workspace-row-context">${match.intro_message || 'Taj wants to introduce you'}</div>
                        <div class="workspace-row-meta">Introduced by Taj  ${timeAgo}</div>
                    </div>
                    <div class="workspace-row-actions">
                        <button class="workspace-btn workspace-btn-primary" onclick="markInterestedNew(this)">Interested</button>
                        <button class="workspace-btn workspace-btn-secondary" onclick="markPassedNew(this)">Pass</button>
                    </div>
                </div>
            `;
        }
        
        function setAttnStatusNew(btn, status) {
            document.querySelectorAll('#attentionPage .workspace-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const attnList = document.getElementById('attnList');
            const emptyActive = document.getElementById('emptyAttnActive');
            const emptyInterested = document.getElementById('emptyAttnInterested');
            const emptyPassed = document.getElementById('emptyAttnPassed');
            
            // Hide all empty states
            if (emptyActive) emptyActive.style.display = 'none';
            if (emptyInterested) emptyInterested.style.display = 'none';
            if (emptyPassed) emptyPassed.style.display = 'none';
            
            // Show appropriate empty state based on status
            if (status === 'active') {
                const activeRows = document.querySelectorAll('.workspace-row[data-status="active"]');
                if (activeRows.length === 0 && emptyActive) emptyActive.style.display = 'block';
            } else if (status === 'interested') {
                if (emptyInterested) emptyInterested.style.display = 'block';
            } else if (status === 'passed') {
                if (emptyPassed) emptyPassed.style.display = 'block';
            }
        }
        
        function markInterestedNew(btn) {
            const row = btn.closest('.workspace-row');
            row.style.opacity = '0.5';
            setTimeout(() => {
                row.remove();
                showWorkspaceToast('Marked as interested');
                updateAttnCounts();
            }, 200);
        }
        
        function markPassedNew(btn) {
            const row = btn.closest('.workspace-row');
            row.style.opacity = '0.5';
            setTimeout(() => {
                row.remove();
                showWorkspaceToast('Passed');
                updateAttnCounts();
            }, 200);
        }
        
        function updateAttnCounts() {
            const activeCount = document.querySelectorAll('#attnList .workspace-row[data-status="active"]').length;
            const needsCount = document.getElementById('attnNeedsCount');
            if (needsCount) needsCount.textContent = activeCount;
            
            // Update rail
            const railAttnCount = document.getElementById('attnRailAttnCount');
            if (railAttnCount) railAttnCount.textContent = activeCount;
            
            // Show empty state if no more
            if (activeCount === 0) {
                const emptyActive = document.getElementById('emptyAttnActive');
                if (emptyActive) emptyActive.style.display = 'block';
            }
        }
        
        function showWorkspaceToast(message) {
            const toast = document.getElementById('attnToast') || document.getElementById('connToast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2500);
            }
        }
        
        // Keep old functions for compatibility
        function renderProposalCard(match) {
            return renderAttnRow(match);
        }
        
        function formatTimeAgo(dateString) {
            if (!dateString) return 'recently';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            if (diffMins < 60) return diffMins + ' mins ago';
            if (diffHours < 24) return diffHours + ' hours ago';
            if (diffDays < 7) return diffDays + ' days ago';
            return Math.floor(diffDays / 7) + ' weeks ago';
        }
        
        function toggleAttentionDropdown(e) {
            e.stopPropagation();
            document.getElementById('attnDropdown').classList.toggle('active');
        }
        
        // Current status view
        let currentAttnStatus = 'active';
        
        function setAttnStatus(btn, status) {
            document.querySelectorAll('.attn-status-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            currentAttnStatus = status;
            
            // Show/hide cards based on status
            const cards = document.querySelectorAll('.proposal-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                if (card.dataset.status === status) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Show appropriate empty state
            document.getElementById('emptyActive').style.display = (status === 'active' && visibleCount === 0) ? 'block' : 'none';
            document.getElementById('emptyInterested').style.display = (status === 'interested' && visibleCount === 0) ? 'block' : 'none';
            document.getElementById('emptyPassed').style.display = (status === 'passed' && visibleCount === 0) ? 'block' : 'none';
            document.getElementById('attnProposals').style.display = visibleCount > 0 ? 'block' : 'none';
            
            // Show/hide category filters (only for active)
            document.querySelector('.attn-filter-tabs').style.display = status === 'active' ? 'flex' : 'none';
        }
        
        function setAttnFilter(btn, type) {
            document.querySelectorAll('.attn-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            
            const cards = document.querySelectorAll('.proposal-card');
            
            cards.forEach(card => {
                const matchesType = type === 'all' || card.dataset.type === type;
                const matchesStatus = card.dataset.status === currentAttnStatus;
                card.style.display = (matchesType && matchesStatus) ? 'block' : 'none';
            });
        }
        
        function updateCounts() {
            let activeCount = 0;
            let interestedCount = 0;
            let passedCount = 0;
            
            document.querySelectorAll('.proposal-card').forEach(card => {
                if (card.dataset.status === 'active') activeCount++;
                else if (card.dataset.status === 'interested') interestedCount++;
                else if (card.dataset.status === 'passed') passedCount++;
            });
            
            document.getElementById('activeCount').textContent = activeCount;
            document.getElementById('interestedCount').textContent = interestedCount;
            document.getElementById('passedCount').textContent = passedCount;
        }
        
        function showAttnToast(message) {
            const toast = document.getElementById('attnToast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        function markInterested(btn) {
            const card = btn.closest('.proposal-card');
            const title = card.querySelector('.proposal-title').textContent;
            
            // Animate card
            card.classList.add('interested');
            
            setTimeout(() => {
                // Update card status
                card.dataset.status = 'interested';
                card.classList.remove('interested');
                
                // Replace action buttons with status
                const actionsDiv = card.querySelector('.proposal-actions');
                actionsDiv.innerHTML = `
                    <div class="proposal-status">
                        <span class="proposal-status-text interested">Taj will connect you soon</span>
                        <button class="proposal-status-btn message" onclick="window.open('https://t.me/TapinXBot?text=Hey Taj, following up on: ${encodeURIComponent(title)}', '_blank')">Message Taj</button>
                    </div>
                `;
                
                // Hide card if not in interested view
                if (currentAttnStatus !== 'interested') {
                    card.style.display = 'none';
                }
                
                updateCounts();
                showAttnToast('Nice! Taj will connect you shortly');
                
                // Check if we need to show empty state
                checkEmptyState();
            }, 300);
        }
        
        function markPassed(btn) {
            const card = btn.closest('.proposal-card');
            const title = card.querySelector('.proposal-title').textContent;
            
            // Animate card
            card.classList.add('removing');
            
            setTimeout(() => {
                // Update card status
                card.dataset.status = 'passed';
                card.classList.remove('removing');
                
                // Replace action buttons with status
                const actionsDiv = card.querySelector('.proposal-actions');
                actionsDiv.innerHTML = `
                    <div class="proposal-status">
                        <span class="proposal-status-text passed">Passed on this opportunity</span>
                        <button class="proposal-status-btn restore" onclick="restoreCard(this)">Restore</button>
                    </div>
                `;
                
                // Hide card if not in passed view
                if (currentAttnStatus !== 'passed') {
                    card.style.display = 'none';
                }
                
                updateCounts();
                showAttnToast('Removed from your list');
                
                // Check if we need to show empty state
                checkEmptyState();
            }, 300);
        }
        
        function restoreCard(btn) {
            const card = btn.closest('.proposal-card');
            const title = card.querySelector('.proposal-title').textContent;
            
            // Update card status back to active
            card.dataset.status = 'active';
            
            // Restore action buttons
            const actionsDiv = card.querySelector('.proposal-actions');
            actionsDiv.innerHTML = `
                <button class="proposal-btn primary" onclick="markInterested(this)">I'm Interested</button>
                <button class="proposal-btn secondary" onclick="markPassed(this)">Not for me</button>
                <button class="proposal-btn tertiary" onclick="askTajMore(this, '${title}')">Ask Taj more</button>
            `;
            
            // Hide card if not in active view
            if (currentAttnStatus !== 'active') {
                card.style.display = 'none';
            }
            
            updateCounts();
            showAttnToast('Restored to your list');
            
            // Check if we need to show empty state
            checkEmptyState();
        }
        
        function askTajMore(btn, title) {
            const message = encodeURIComponent(`Hey Taj, can you tell me more about: ${title}`);
            window.open(`https://t.me/TapinXBot?text=${message}`, '_blank');
        }
        
        function checkEmptyState() {
            let visibleCount = 0;
            document.querySelectorAll('.proposal-card').forEach(card => {
                if (card.dataset.status === currentAttnStatus && card.style.display !== 'none') {
                    visibleCount++;
                }
            });
            
            // Count all cards with current status (regardless of display)
            let statusCount = 0;
            document.querySelectorAll('.proposal-card').forEach(card => {
                if (card.dataset.status === currentAttnStatus) {
                    statusCount++;
                }
            });
            
            document.getElementById('emptyActive').style.display = (currentAttnStatus === 'active' && statusCount === 0) ? 'block' : 'none';
            document.getElementById('emptyInterested').style.display = (currentAttnStatus === 'interested' && statusCount === 0) ? 'block' : 'none';
            document.getElementById('emptyPassed').style.display = (currentAttnStatus === 'passed' && statusCount === 0) ? 'block' : 'none';
            document.getElementById('attnProposals').style.display = statusCount > 0 ? 'block' : 'none';
        }
        
        // ========== INIT ==========
        // Landing page always shows first
        // User clicks "Sign in" to go to dashboard if already logged in
        
        // ========== ROTATING WORDS ==========
        (function() {
            const words = document.querySelectorAll('.rotating-word .word');
            let currentIndex = 0;
            
            setInterval(() => {
                words[currentIndex].classList.remove('active');
                currentIndex = (currentIndex + 1) % words.length;
                words[currentIndex].classList.add('active');
            }, 3000);
        })();
        
        // ========== NEW X.COM-STYLE APP FUNCTIONS ==========
        let currentNewAppPage = 'opportunities';
        
        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }
        
        function closeMobileMenu() {
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('mobileOverlay');
            if (sidebar) sidebar.classList.remove('mobile-open');
            if (overlay) overlay.classList.remove('active');
        }
        
        function updateMobileHeader(title) {
            const headerTitle = document.getElementById('mobileHeaderTitle');
            if (headerTitle) headerTitle.textContent = title;
        }
        
        function showNewAppPage(page) {
            Router.navigate(page);
        }
        
        // Handle T logo click - different behavior for logged in vs logged out
        function handleLogoClick() {
            const userId = localStorage.getItem('tapinx_user_id');
            const userPhone = localStorage.getItem('tapinx_user_phone');
            const isLoggedIn = userId || userPhone;
            
            if (isLoggedIn) {
                // Logged in - go to opportunities
                Router.navigate('opportunities');
            } else {
                // Not logged in - refresh landing page
                window.location.href = '/';
            }
        }
        
        async function loadNewConnections() {
            try {
                console.log('[TapinX] Loading connections...');
                const { connections: conns, count } = await fetchConnections();
                const list = document.getElementById('newConnectionsList');
                const empty = document.getElementById('newConnectionsEmpty');
                
                if (!list || !empty) {
                    console.error('[TapinX] Connections page DOM elements not found');
                    return;
                }
                
                console.log('[TapinX] Connections loaded:', count, 'connections');
                
                if (count === 0 || !conns || conns.length === 0) {
                    list.innerHTML = '';
                    empty.style.display = 'block';
                    console.log('[TapinX] No connections found, showing empty state');
                } else {
                    empty.style.display = 'none';
                    list.innerHTML = conns.map(c => `
                        <div class="new-feed-item" data-status="${c.status || 'connected'}" onclick='openConnectionModal(${JSON.stringify(c).replace(/'/g, "&#39;")})' style="cursor: pointer;">
                            <div class="new-feed-avatar">${(c.name || 'U').charAt(0).toUpperCase()}</div>
                            <div class="new-feed-content">
                                <div class="new-feed-header">
                                    <span class="new-feed-name">${c.name || 'Unknown'}</span>
                                    <span class="new-feed-status ${c.status || 'connected'}">${(c.status || 'Connected').charAt(0).toUpperCase() + (c.status || 'connected').slice(1)}</span>
                                </div>
                                <div class="new-feed-context">${c.ask_title || c.role || c.title || 'Introduction from Taj'}</div>
                                <div class="new-feed-time">${formatNewDate(c.connected_at)}</div>
                            </div>
                        </div>
                    `).join('');
                    console.log('[TapinX] Connections rendered successfully');
                }
            } catch (error) {
                console.error('[TapinX] Error in loadNewConnections:', error);
                const list = document.getElementById('newConnectionsList');
                const empty = document.getElementById('newConnectionsEmpty');
                if (list) list.innerHTML = '';
                if (empty) empty.style.display = 'block';
            }
        }
        
        let currentConnectionData = null;

        function openConnectionModal(connectionData) {
            currentConnectionData = connectionData;
            document.getElementById('connModalAvatar').textContent = (connectionData.name || 'U').charAt(0).toUpperCase();
            document.getElementById('connModalName').textContent = connectionData.name || 'Unknown';
            
            const isConnected = connectionData.status === 'connected';
            const status = document.getElementById('connModalStatus');
            status.textContent = isConnected ? 'Connected' : 'Pending';
            status.className = 'connection-modal-status ' + (isConnected ? 'connected' : 'pending');
            
            document.getElementById('connModalContextText').textContent = connectionData.ask_title || 'Introduction from Taj';
            
            const bioSection = document.getElementById('connModalBio');
            if (connectionData.bio) { bioSection.style.display = 'block'; document.getElementById('connModalBioText').textContent = connectionData.bio; } 
            else { bioSection.style.display = 'none'; }
            
            const skillsSection = document.getElementById('connModalSkills');
            if (connectionData.skills && connectionData.skills.length > 0) {
                skillsSection.style.display = 'block';
                document.getElementById('connModalSkillsList').innerHTML = connectionData.skills.map(s => '<span class="connection-modal-skill">' + s + '</span>').join('');
            } else { skillsSection.style.display = 'none'; }
            
            const message = document.getElementById('connModalMessage');
            const footer = document.getElementById('connModalFooter');
            
            if (isConnected) {
                message.className = 'connection-modal-message success';
                message.innerHTML = '<div class="connection-modal-message-icon"></div><div class="connection-modal-message-title">You\'re connected!</div><div class="connection-modal-message-text">Taj has introduced you both via Telegram. Check your messages to start the conversation!</div>';
                footer.innerHTML = '<button class="connection-modal-btn primary" onclick="window.open(\'https://t.me/TapinXBot\', \'_blank\'); closeConnectionModal();">Open Telegram</button><button class="connection-modal-btn secondary" onclick="closeConnectionModal()">Close</button>';
            } else {
                message.className = 'connection-modal-message waiting';
                message.innerHTML = '<div class="connection-modal-message-icon"></div><div class="connection-modal-message-title">Waiting for response</div><div class="connection-modal-message-text">' + (connectionData.name || 'They') + ' hasn\'t responded yet. We\'ll notify you via Telegram as soon as they accept!</div>';
                footer.innerHTML = '<button class="connection-modal-btn secondary" onclick="closeConnectionModal()">Got it</button>';
            }
            
            document.getElementById('connectionModal').classList.add('show');
        }

        function closeConnectionModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('connectionModal').classList.remove('show');
        }
        
        // Request Modal Functions
        let currentRequestData = null;

        function openRequestModal(requestData) {
            currentRequestData = requestData;
            
            // Status labels mapping
            const statusLabels = {
                'active': 'In progress',
                'waiting': 'Waiting',
                'matched': 'Matched',
                'completed': 'Completed'
            };
            
            // Intent to category mapping
            const intentLabels = {
                'professional': 'Professional',
                'community': 'Community',
                'personal': 'Personal'
            };
            
            document.getElementById('requestModalTitle').textContent = requestData.title || requestData.description || 'Request';
            
            const status = requestData.status || 'active';
            document.getElementById('requestModalStatus').textContent = statusLabels[status] || 'Active';
            
            const intent = requestData.intent || requestData.category || 'professional';
            document.getElementById('requestModalCategory').textContent = intentLabels[intent] || 'Professional';
            
            // Format date - try formatNewDate first, fallback to formatRequestTime or raw date
            let dateText = 'Just now';
            if (requestData.created_at) {
                try {
                    dateText = formatNewDate(requestData.created_at);
                } catch (e) {
                    try {
                        dateText = formatRequestTime ? formatRequestTime(requestData.created_at) : new Date(requestData.created_at).toLocaleDateString();
                    } catch (e2) {
                        dateText = requestData.created_at;
                    }
                }
            }
            document.getElementById('requestModalDate').textContent = dateText;
            
            const skillsContainer = document.getElementById('requestModalSkills');
            if (requestData.skills_needed && requestData.skills_needed.length > 0) {
                skillsContainer.innerHTML = requestData.skills_needed.map(s => 
                    '<span class="request-modal-skill">' + s + '</span>'
                ).join('');
            } else {
                skillsContainer.innerHTML = '<span class="request-modal-value">Not specified</span>';
            }
            
            const matchSection = document.getElementById('requestModalMatchSection');
            if (requestData.match_name) {
                matchSection.style.display = 'block';
                document.getElementById('requestModalMatch').textContent = requestData.match_name;
            } else {
                matchSection.style.display = 'none';
            }
            
            document.getElementById('requestModal').classList.add('show');
        }

        function closeRequestModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('requestModal').classList.remove('show');
            currentRequestData = null;
        }

        function followUpRequestFromModal() {
            const requestTitle = currentRequestData ? (currentRequestData.title || currentRequestData.description || 'request') : 'request';
            window.open('https://t.me/TapinXBot?text=' + encodeURIComponent("What's the update on my " + requestTitle + " request I had asked you about?"), '_blank');
            closeRequestModal();
        }
        
        function setNewConnectionsTab(btn, tab) {
            document.querySelectorAll('#newConnectionsPage .new-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            filterNewConnections(tab, true);
        }
        
        function filterNewConnections(status, fromHorizontalTab = false) {
            document.querySelectorAll('#newConnectionsList .new-feed-item').forEach(item => {
                const itemStatus = item.dataset.status;
                if (status === 'all') {
                    item.style.display = 'flex';
                } else {
                    item.style.display = itemStatus === status ? 'flex' : 'none';
                }
            });
            
            // Update sidebar sublinks for connections only
            document.querySelectorAll('#connectionsExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
            const sublinks = document.querySelectorAll('#connectionsExpand .new-sidebar-sublink');
            if (status === 'all' && sublinks[0]) sublinks[0].classList.add('active');
            if (status === 'connected' && sublinks[1]) sublinks[1].classList.add('active');
            if (status === 'pending' && sublinks[2]) sublinks[2].classList.add('active');
            
            // Also update horizontal tabs when clicking from sidebar
            if (!fromHorizontalTab) {
                const tabs = document.querySelectorAll('#newConnectionsPage .new-tab');
                tabs.forEach(t => t.classList.remove('active'));
                if (status === 'all' && tabs[0]) tabs[0].classList.add('active');
                if (status === 'connected' && tabs[1]) tabs[1].classList.add('active');
                if (status === 'pending' && tabs[2]) tabs[2].classList.add('active');
            }
        }
        
        async function loadNewOpportunities() {
            const { matches, count } = await fetchMatches();
            const list = document.getElementById('newOpportunitiesList');
            const empty = document.getElementById('newOpportunitiesEmpty');
            
            // Update badge
            const badge = document.getElementById('opportunitiesBadge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
            
            if (count === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
                const matchTypes = ['professional', 'community'];
                const matchLabels = { professional: 'Professional match', community: 'Community-relevant' };
                
                list.innerHTML = matches.map(m => {
                    const matchType = m.match_type || matchTypes[Math.floor(Math.random() * matchTypes.length)];
                    const oppDataStr = JSON.stringify(m).replace(/"/g, '&quot;');
                    return `
                    <div class="new-feed-item" data-id="${m.id}" data-type="${matchType}" data-opportunity='${oppDataStr}' onclick="handleOppCardClick(this)" style="cursor: pointer;">
                        <div class="new-feed-avatar">${(m.other_name || 'T').charAt(0).toUpperCase()}</div>
                        <div class="new-feed-content">
                            <div class="new-feed-header">
                                <span class="new-feed-name">${m.other_name || 'New opportunity'}</span>
                                <span class="new-match-type ${matchType}">${matchLabels[matchType]}</span>
                            </div>
                            <div class="new-feed-text">Taj wants to introduce you to ${m.other_name || 'someone'}${m.intro_reason ? ' for ' + m.intro_reason : ''}</div>
                            <div class="new-feed-time">${formatNewTimeAgo(m.created_at)}</div>
                            <div class="new-feed-actions" onclick="event.stopPropagation()">
                                <button class="new-feed-btn primary" onclick="acceptNewOpportunity('${m.id}')">Approve</button>
                                <button class="new-feed-btn secondary" onclick="declineNewOpportunity('${m.id}')">Decline</button>
                                <button class="opportunity-refer-btn" onclick="event.stopPropagation(); handleOppReferClick(this)">Refer a Friend</button>
                            </div>
                        </div>
                    </div>
                `}).join('');
            }
        }
        
        function filterNewOpportunities(type, btn) {
            // Update active tab
            document.querySelectorAll('#newOpportunitiesPage .new-tab').forEach(t => t.classList.remove('active'));
            if (btn) btn.classList.add('active');
            
            if (type === 'archive') {
                loadArchivedOpportunities();
                return;
            }
            
            filterOpportunitiesItems(type);
            
            // Also update sidebar sublinks
            updateOpportunitiesSidebarSublinks(type);
        }
        
        function filterOpportunitiesFromSidebar(type) {
            if (type === 'archive') {
                loadArchivedOpportunities();
                // Update horizontal tabs
                const tabs = document.querySelectorAll('#newOpportunitiesPage .new-tab');
                tabs.forEach(t => t.classList.remove('active'));
                if (tabs[3]) tabs[3].classList.add('active'); // Archive is 4th tab
                return;
            }
            
            filterOpportunitiesItems(type);
            
            // Update sidebar sublinks
            updateOpportunitiesSidebarSublinks(type);
            
            // Update horizontal tabs
            const tabs = document.querySelectorAll('#newOpportunitiesPage .new-tab');
            tabs.forEach(t => t.classList.remove('active'));
            if (type === 'all' && tabs[0]) tabs[0].classList.add('active');
            if (type === 'professional' && tabs[1]) tabs[1].classList.add('active');
            if (type === 'community' && tabs[2]) tabs[2].classList.add('active');
            if (type === 'archive' && tabs[3]) tabs[3].classList.add('active');
        }
        
        function filterOpportunitiesItems(type) {
            document.querySelectorAll('#newOpportunitiesList .new-feed-item').forEach(item => {
                const itemType = item.dataset.type;
                if (type === 'all') {
                    item.style.display = 'flex';
                } else if (type === 'saved') {
                    item.style.display = item.dataset.saved === 'true' ? 'flex' : 'none';
                } else {
                    item.style.display = itemType === type ? 'flex' : 'none';
                }
            });
        }
        
        function updateOpportunitiesSidebarSublinks(type) {
            document.querySelectorAll('#opportunitiesExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
            const sublinks = document.querySelectorAll('#opportunitiesExpand .new-sidebar-sublink');
            if (type === 'all' && sublinks[0]) sublinks[0].classList.add('active');
            if (type === 'professional' && sublinks[1]) sublinks[1].classList.add('active');
            if (type === 'community' && sublinks[2]) sublinks[2].classList.add('active');
            if (type === 'saved' && sublinks[3]) sublinks[3].classList.add('active');
        }
        
        async function acceptNewOpportunity(id) {
            await respondToMatch(id, 'accept');
            showNewToast('Introduction accepted!');
            loadNewOpportunities();
        }
        
        async function declineNewOpportunity(id) {
            await respondToMatch(id, 'decline');
            showNewToast('Passed');
            loadNewOpportunities();
        }
        
        async function loadArchivedOpportunities() {
            const userId = localStorage.getItem('tapinx_user_id');
            if (!userId) return;
            
            try {
                const response = await fetch(API_URL + '/opportunities/' + userId + '/archive');
                const data = await response.json();
                
                if (data.success) {
                    renderArchivedOpportunities(data.opportunities || []);
                } else {
                    renderArchivedOpportunities([]);
                }
            } catch (e) {
                console.error('Error loading archive:', e);
                renderArchivedOpportunities([]);
            }
        }
        
        function renderArchivedOpportunities(opportunities) {
            const list = document.getElementById('newOpportunitiesList');
            const empty = document.getElementById('newOpportunitiesEmpty');
            
            if (!opportunities || opportunities.length === 0) {
                if (list) list.innerHTML = '';
                if (empty) {
                    empty.style.display = 'flex';
                    empty.innerHTML = `
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1">
                            <path d="M21 8v13H3V8M1 3h22v5H1zM10 12h4"/>
                        </svg>
                        <h3 class="new-empty-title">Archive is empty</h3>
                        <p class="new-empty-text">Opportunities you decline or refer will appear here.</p>
                    `;
                }
                return;
            }
            
            if (empty) empty.style.display = 'none';
            
            list.innerHTML = opportunities.map(o => {
                const statusLabel = o.status === 'declined' ? 'Declined' : 'Referred';
                const statusClass = o.status === 'declined' ? 'declined' : 'referred';
                const statusMessage = o.status === 'declined' 
                    ? 'You passed on this opportunity'
                    : 'You referred this to a friend';
                const initial = (o.requester_name || o.other_name || 'S').charAt(0).toUpperCase();
                const title = escapeHtml(o.ask_title || o.title || 'Opportunity');
                
                return `
                    <div class="new-feed-item archived">
                        <div class="new-feed-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600;">${initial}</div>
                        <div class="new-feed-content" style="flex: 1;">
                            <div class="new-feed-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                <span class="new-feed-name" style="font-weight: 600;">${escapeHtml(o.requester_name || o.other_name || 'Someone')}</span>
                                <span class="archive-badge ${statusClass}">${statusLabel}</span>
                            </div>
                            <div class="new-feed-text" style="font-size: 15px; color: #333; margin-bottom: 4px;">${title}</div>
                            <div class="new-feed-meta" style="font-size: 13px; color: #666;">${statusMessage}</div>
                            <div class="archive-actions" style="margin-top: 12px; display: flex; gap: 8px;">
                                ${o.status === 'referred' ? `<button class="archive-btn" onclick="referAgain(${o.id}, ${o.ask_id}, '${title.replace(/'/g, "\\'")}')">Refer Again</button>` : ''}
                                <button class="archive-btn" onclick="restoreOpportunity(${o.id})">Restore</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ========== OPPORTUNITY MODAL STATE ==========
        let currentOppData = null;
        
        // ========== HELPER FUNCTION ==========
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ========== DETAIL MODAL FUNCTIONS ==========
        
        function handleOppCardClick(element) {
            const oppData = element.getAttribute('data-opportunity');
            if (oppData) {
                try {
                    const opportunity = JSON.parse(oppData.replace(/&quot;/g, '"'));
                    openOppDetailModal(opportunity);
                } catch (e) {
                    console.error('[Modal] Error parsing opportunity data:', e);
                }
            }
        }
        
        function handleOppReferClick(element) {
            const card = element.closest('.new-feed-item');
            const oppData = card ? card.getAttribute('data-opportunity') : null;
            if (oppData) {
                try {
                    const opportunity = JSON.parse(oppData.replace(/&quot;/g, '"'));
                    openReferFromCard(opportunity);
                } catch (e) {
                    console.error('[Modal] Error parsing opportunity data:', e);
                }
            }
        }
        
        function openOppDetailModal(opportunity) {
            console.log('[Modal] Opening detail modal for:', opportunity);
            
            if (!opportunity) {
                console.error('[Modal] No opportunity data provided');
                return;
            }
            
            currentOppData = opportunity;
            
            // Set avatar and name
            const name = opportunity.requester_name || opportunity.other_name || 'Someone';
            const avatarEl = document.getElementById('oppDetailAvatar');
            const nameEl = document.getElementById('oppDetailName');
            const bioEl = document.getElementById('oppDetailBio');
            
            if (avatarEl) avatarEl.textContent = name.charAt(0).toUpperCase();
            if (nameEl) nameEl.textContent = name;
            if (bioEl) bioEl.textContent = opportunity.requester_bio || 'TapinX member';
            
            // Set opportunity details
            const titleEl = document.getElementById('oppDetailTitle');
            const descEl = document.getElementById('oppDetailDesc');
            
            if (titleEl) titleEl.textContent = opportunity.ask_title || opportunity.title || 'Connection Request';
            if (descEl) descEl.textContent = opportunity.ask_text || opportunity.intro_reason || 'No description provided.';
            
            // Set skills
            const skillsContainer = document.getElementById('oppDetailSkills');
            const skillsSection = document.getElementById('oppDetailSkillsSection');
            if (skillsContainer && skillsSection) {
                if (opportunity.skills_needed && opportunity.skills_needed.length > 0) {
                    skillsSection.style.display = 'block';
                    skillsContainer.innerHTML = opportunity.skills_needed.map(s => 
                        '<span class="opp-detail-skill">' + escapeHtml(s) + '</span>'
                    ).join('');
                } else {
                    skillsSection.style.display = 'none';
                }
            }
            
            // Set match score
            const scoreEl = document.getElementById('oppDetailScore');
            if (scoreEl) {
                const score = opportunity.match_score || 0;
                scoreEl.textContent = Math.round(score) + '% match';
            }
            
            const modal = document.getElementById('oppDetailModal');
            if (modal) {
                modal.classList.add('show');
                console.log('[Modal] Modal shown successfully');
            } else {
                console.error('[Modal] Modal element not found - check HTML');
            }
        }
        
        function closeOppDetailModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('oppDetailModal').classList.remove('show');
        }
        
        function handleOppInterested() {
            if (!currentOppData) return;
            closeOppDetailModal();
            acceptNewOpportunity(currentOppData.id);
        }
        
        function handleOppDecline() {
            if (!currentOppData) return;
            // Show decline confirmation
            document.getElementById('declineConfirmOppTitle').textContent = currentOppData.ask_title || currentOppData.title || 'this opportunity';
            document.getElementById('declineConfirmModal').classList.add('show');
        }
        
        function handleOppRefer() {
            if (!currentOppData) return;
            closeOppDetailModal();
            // Show referral confirmation
            document.getElementById('referConfirmOppTitle').textContent = currentOppData.ask_title || currentOppData.title || 'this opportunity';
            document.getElementById('referFriendName').value = '';
            document.getElementById('referConfirmModal').classList.add('show');
        }
        
        function openReferFromCard(opportunity) {
            currentOppData = opportunity;
            document.getElementById('referConfirmOppTitle').textContent = opportunity.ask_title || opportunity.title || 'this opportunity';
            document.getElementById('referFriendName').value = '';
            document.getElementById('referConfirmModal').classList.add('show');
        }
        
        // ========== DECLINE MODAL FUNCTIONS ==========
        
        function closeDeclineConfirmModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('declineConfirmModal').classList.remove('show');
        }
        
        function confirmDecline() {
            if (!currentOppData) return;
            closeDeclineConfirmModal();
            closeOppDetailModal();
            declineNewOpportunity(currentOppData.id);
        }
        
        // ========== REFERRAL MODAL FUNCTIONS ==========
        
        function closeReferConfirmModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('referConfirmModal').classList.remove('show');
        }
        
        async function sendReferral() {
            if (!currentOppData) return;
            
            const friendName = document.getElementById('referFriendName').value.trim();
            const matchId = currentOppData.id;
            const title = currentOppData.ask_title || currentOppData.title || 'an opportunity';
            const oppId = currentOppData.ask_id;
            const userId = localStorage.getItem('tapinx_user_id');
            
            // Close confirmation modal
            closeReferConfirmModal();
            
            // Update match status to 'referred' in backend
            try {
                await fetch(API_URL + '/matches/' + matchId + '/respond', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        response: 'referred',
                        user_id: userId
                    })
                });
            } catch (e) {
                console.error('Error updating match status:', e);
            }
            
            // Create referral link
            const referralLink = 'https://tapinx.com?ref=' + userId + '&opp=' + oppId;
            
            // Create share message
            let shareMessage = "Hey";
            if (friendName) {
                shareMessage += " " + friendName;
            }
            shareMessage += "! I found an opportunity on TapinX that might be perfect for you: \"" + title + "\". Check it out: " + referralLink;
            
            // Open share/SMS
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = 'sms:?body=' + encodeURIComponent(shareMessage);
            } else {
                if (navigator.share) {
                    navigator.share({
                        title: 'TapinX Opportunity',
                        text: shareMessage
                    }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(shareMessage).then(() => {
                        // Show success after copy
                    }).catch(() => {
                        window.open(referralLink, '_blank');
                    });
                }
            }
            
            // Show success modal
            document.getElementById('referSuccessModal').classList.add('show');
            
            // Reload opportunities
            loadNewOpportunities();
        }
        
        // ========== SUCCESS MODAL FUNCTIONS ==========
        
        function closeReferSuccessModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('referSuccessModal').classList.remove('show');
            currentOppData = null;
        }
        
        function goToArchive() {
            closeReferSuccessModal();
            // Click the archive tab
            const archiveTab = document.querySelector('.new-tab[onclick*="archive"]');
            if (archiveTab) {
                filterNewOpportunities('archive', archiveTab);
            }
        }
        
        // ========== ARCHIVE ACTIONS ==========
        
        async function referAgain(matchId, askId, title) {
            const userId = localStorage.getItem('tapinx_user_id');
            const referralLink = 'https://tapinx.com?ref=' + userId + '&opp=' + askId;
            const shareMessage = "Hey! I found an opportunity on TapinX that might be perfect for you: \"" + title + "\". Check it out: " + referralLink;
            
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = 'sms:?body=' + encodeURIComponent(shareMessage);
            } else {
                if (navigator.share) {
                    navigator.share({ title: 'TapinX Opportunity', text: shareMessage }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(shareMessage).then(() => {
                        alert('Message copied! Share it with your friend.');
                    });
                }
            }
        }
        
        async function restoreOpportunity(matchId) {
            const userId = localStorage.getItem('tapinx_user_id');
            
            try {
                const response = await fetch(API_URL + '/matches/' + matchId + '/restore', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Reload archive
                    loadArchivedOpportunities();
                    // Show confirmation
                    alert('Opportunity restored! Check your Opportunities.');
                } else {
                    alert('Could not restore opportunity. Please try again.');
                }
            } catch (e) {
                console.error('Error restoring opportunity:', e);
                alert('Error restoring opportunity.');
            }
        }
        
        async function referOpportunity(opportunity) {
            const matchId = opportunity.id;
            const title = opportunity.ask_title || opportunity.title || opportunity.other_name || 'an opportunity';
            const oppId = opportunity.ask_id;
            const userId = localStorage.getItem('tapinx_user_id');
            
            // 1. Update match status to 'referred' in backend
            try {
                await fetch(API_URL + '/matches/' + matchId + '/respond', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        response: 'referred',
                        user_id: userId
                    })
                });
            } catch (e) {
                console.error('Error updating match status:', e);
            }
            
            // 2. Create referral link
            const referralLink = 'https://tapinx.com?ref=' + userId + '&opp=' + oppId;
            
            // 3. Message to send to friend
            const shareMessage = "Hey! I found an opportunity on TapinX that might be perfect for you: \"" + title + "\". Check it out: " + referralLink;
            
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = 'sms:?body=' + encodeURIComponent(shareMessage);
            } else {
                if (navigator.share) {
                    navigator.share({
                        title: 'TapinX Opportunity',
                        text: shareMessage
                    }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(shareMessage).then(() => {
                        alert('Message copied! Share it with your friend.');
                    }).catch(() => {
                        window.open(referralLink, '_blank');
                    });
                }
            }
            
            // 4. Reload opportunities to remove the referred one
            loadNewOpportunities();
        }
        
        function inviteFriend() {
            const inviteMessage = "Hey! I've been using TapinX to make professional connections. You should check it out - just text the bot and tell Taj who you want to meet: https://t.me/TapinXBot";
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join TapinX',
                    text: inviteMessage,
                    url: 'https://t.me/TapinXBot'
                }).catch(console.error);
            } else {
                window.open('https://t.me/share/url?url=' + encodeURIComponent('https://t.me/TapinXBot') + '&text=' + encodeURIComponent('Check out TapinX - text Taj who you want to meet and get introduced!'), '_blank');
            }
        }
        
        function submitNewReferral() {
            const name = document.getElementById('newReferralName').value;
            const contact = document.getElementById('newReferralContact').value;
            if (name && contact) {
                showNewToast('Referral sent!');
                document.getElementById('newReferralName').value = '';
                document.getElementById('newReferralContact').value = '';
                document.getElementById('newReferralContext').value = '';
            }
        }
        
        async function loadNewRequests() {
            const list = document.getElementById('newRequestsList');
            const empty = document.getElementById('newRequestsEmpty');
            
            // Try to fetch from API
            let requests = [];
            try {
                const userPhone = localStorage.getItem('tapinx_user_phone');
                if (userPhone) {
                    // Clean phone format for API
                    const cleanPhone = userPhone.replace(/\s/g, '').replace(/[()-]/g, '');
                    const API_URL = 'https://tapinx-backend-production.up.railway.app';
                    const response = await fetch(`${API_URL}/api/requests/${encodeURIComponent(cleanPhone)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            requests = data.requests || [];
                        }
                    }
                }
            } catch (e) {
                console.log('[TapinX] Could not fetch requests:', e.message);
            }
            
            // Fallback to localStorage for demo
            if (requests.length === 0) {
                requests = JSON.parse(localStorage.getItem('tapinx_requests') || '[]');
            }
            
            // Update badge
            const activeCount = requests.filter(r => r.status === 'active' || r.status === 'matched').length;
            const badge = document.getElementById('requestsBadge');
            if (activeCount > 0) {
                badge.textContent = activeCount;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
            
            if (requests.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
                
                // Status styling
                const statusLabels = {
                    'active': 'In progress',
                    'waiting': 'Waiting',
                    'matched': 'Matched',
                    'completed': 'Completed'
                };
                
                // Intent badge styling
                const intentLabels = {
                    'professional': 'Professional',
                    'community': 'Community',
                    'personal': 'Personal'
                };
                
                list.innerHTML = requests.map(r => {
                    const status = r.status || 'active';
                    const intent = r.intent || 'professional';
                    const timestamp = r.created_at ? formatRequestTime(r.created_at) : 'Just now';
                    
                    // Determine actions based on status
                    let actions = '';
                    if (status === 'active' || status === 'waiting') {
                        actions = `
                            <button class="new-request-action" onclick="event.stopPropagation(); openRequestModal(${JSON.stringify(r).replace(/"/g, "&quot;")})">View details</button>
                            <button class="new-request-action" onclick="event.stopPropagation(); followUpRequest('${r.id}')">Follow up</button>
                        `;
                    } else if (status === 'matched') {
                        actions = `
                            <button class="new-request-action" onclick="event.stopPropagation(); openRequestModal(${JSON.stringify(r).replace(/"/g, "&quot;")})">View details</button>
                        `;
                    } else if (status === 'completed') {
                        actions = `
                            <button class="new-request-action" onclick="event.stopPropagation(); openRequestModal(${JSON.stringify(r).replace(/"/g, "&quot;")})">View details</button>
                            <button class="new-request-action" onclick="event.stopPropagation(); archiveRequest('${r.id}')">Archive</button>
                        `;
                    }
                    
                    return `
                    <div class="new-feed-item new-request-row" data-id="${r.id}" data-status="${status}" onclick='openRequestModal(${JSON.stringify(r).replace(/"/g, "&quot;")})' style="cursor: pointer;">
                        <div class="new-request-content">
                            <div class="new-request-header">
                                <span class="new-request-title">${r.title || r.description || 'Introduction request'}</span>
                                <div class="new-request-badges">
                                    <span class="new-request-intent">${intentLabels[intent] || 'Professional'}</span>
                                    <span class="new-request-status ${status}">${statusLabels[status] || 'In progress'}</span>
                                </div>
                            </div>
                            <div class="new-request-meta">
                                <span class="new-request-time">Requested ${timestamp}</span>
                            </div>
                        </div>
                        <div class="new-request-actions">
                            ${actions}
                        </div>
                    </div>
                `}).join('');
            }
        }
        
        function formatRequestTime(dateStr) {
            if (!dateStr) return 'Just now';
            const now = new Date();
            const d = new Date(dateStr);
            const diffMs = now - d;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            if (diffDays === 1) return 'yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function filterRequests(status, btn) {
            if (btn) {
                document.querySelectorAll('#newRequestsPage .new-tab').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');
            }
            
            filterRequestsItems(status);
            
            // Update sidebar sublinks
            updateRequestsSidebarSublinks(status);
        }
        
        function filterRequestsFromSidebar(status) {
            filterRequestsItems(status);
            
            // Update sidebar sublinks
            updateRequestsSidebarSublinks(status);
            
            // Update horizontal tabs
            const tabs = document.querySelectorAll('#newRequestsPage .new-tab');
            tabs.forEach(t => t.classList.remove('active'));
            if (status === 'all' && tabs[0]) tabs[0].classList.add('active');
            if (status === 'active' && tabs[1]) tabs[1].classList.add('active');
            if (status === 'matched' && tabs[2]) tabs[2].classList.add('active');
            if (status === 'completed' && tabs[3]) tabs[3].classList.add('active');
        }
        
        function filterRequestsItems(status) {
            document.querySelectorAll('#newRequestsList .new-feed-item').forEach(item => {
                const itemStatus = item.dataset.status;
                if (status === 'all') {
                    item.style.display = 'flex';
                } else {
                    item.style.display = itemStatus === status ? 'flex' : 'none';
                }
            });
        }
        
        function updateRequestsSidebarSublinks(status) {
            document.querySelectorAll('#requestsExpand .new-sidebar-sublink').forEach(l => l.classList.remove('active'));
            const sublinks = document.querySelectorAll('#requestsExpand .new-sidebar-sublink');
            if (status === 'all' && sublinks[0]) sublinks[0].classList.add('active');
            if (status === 'active' && sublinks[1]) sublinks[1].classList.add('active');
            if (status === 'matched' && sublinks[2]) sublinks[2].classList.add('active');
            if (status === 'completed' && sublinks[3]) sublinks[3].classList.add('active');
        }
        
        function viewRequestDetails(requestId) {
            // Show request details - could open a modal or navigate
            showNewToast('Opening request details...');
        }
        
        function followUpRequest(requestId) {
            // Open Telegram to follow up with Taj
            window.open('https://t.me/TapinXBot', '_blank');
            showNewToast('Following up with Taj...');
        }
        
        function archiveRequest(requestId) {
            // Archive the request
            let requests = JSON.parse(localStorage.getItem('tapinx_requests') || '[]');
            requests = requests.filter(r => r.id !== requestId);
            localStorage.setItem('tapinx_requests', JSON.stringify(requests));
            loadNewRequests();
            showNewToast('Request archived');
        }
        
        function cancelRequest(requestId) {
            // Update in localStorage
            let requests = JSON.parse(localStorage.getItem('tapinx_requests') || '[]');
            requests = requests.map(r => {
                if (r.id === requestId) {
                    r.status = 'cancelled';
                }
                return r;
            });
            localStorage.setItem('tapinx_requests', JSON.stringify(requests));
            loadNewRequests();
            showNewToast('Request cancelled');
        }
        // ========== END MY REQUESTS FUNCTIONS ==========
        
        function showBlockedContacts() {
            // For now, show a toast - can be expanded to a modal later
            showNewToast('No blocked contacts');
        }
        
        function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                // Clear all user data
                localStorage.clear();
                showNewToast('Account deleted');
                setTimeout(() => {
                    showPage('landing');
                }, 1500);
            }
        }
        
        // ========== TASKS SYSTEM ==========
        let tasks = [];
        
        function initTasks() {
            // Load saved tasks from localStorage
            const saved = localStorage.getItem('tapinx_tasks');
            if (saved) {
                tasks = JSON.parse(saved);
            }
            
            // Add system tasks based on state
            generateSystemTasks();
            renderTasks();
        }
        
        function generateSystemTasks() {
            // Remove old system tasks
            tasks = tasks.filter(t => t.type !== 'system');
            
            // Check profile completion (Instagram is required)
            const hasProfile = localStorage.getItem('tapinx_user_instagram');
            if (!hasProfile) {
                tasks.unshift({
                    id: 'sys_profile',
                    title: 'Complete your profile',
                    meta: 'Help Taj make better matches',
                    type: 'system',
                    action: 'openNewEditProfile()',
                    done: false
                });
            }
            
            // Check if user has messaged Taj
            const hasMessaged = localStorage.getItem('tapinx_has_messaged');
            if (!hasMessaged) {
                tasks.unshift({
                    id: 'sys_message',
                    title: 'Message Taj',
                    meta: 'Tell Taj who you want to meet',
                    type: 'system',
                    action: "window.open('https://t.me/TapinXBot', '_blank')",
                    done: false
                });
            }
            
            // Check for pending opportunities (mock - would be real data)
            const pendingCount = parseInt(localStorage.getItem('tapinx_pending_opps') || '0');
            if (pendingCount > 0) {
                tasks.unshift({
                    id: 'sys_opportunities',
                    title: `Review ${pendingCount} new ${pendingCount === 1 ? 'opportunity' : 'opportunities'}`,
                    meta: 'Pending introductions',
                    type: 'system',
                    action: "showNewAppPage('opportunities')",
                    done: false
                });
            }
        }
        
        function renderTasks() {
            const list = document.getElementById('tasksList');
            const empty = document.getElementById('tasksEmpty');
            
            if (!list) return;
            
            // Filter out done tasks that are older than 5 seconds (auto-dismiss)
            const activeTasks = tasks.filter(t => !t.done || (t.doneAt && Date.now() - t.doneAt < 5000));
            
            if (activeTasks.length === 0) {
                list.innerHTML = '';
                if (empty) empty.style.display = 'block';
                return;
            }
            
            if (empty) empty.style.display = 'none';
            
            // Separate system and custom tasks
            const systemTasks = activeTasks.filter(t => t.type === 'system');
            const customTasks = activeTasks.filter(t => t.type === 'custom');
            
            let html = '';
            
            // System tasks
            if (systemTasks.length > 0) {
                html += '<div class="new-tasks-divider">To do</div>';
                systemTasks.forEach(task => {
                    html += renderTaskItem(task);
                });
            }
            
            // Custom tasks
            if (customTasks.length > 0) {
                if (systemTasks.length > 0) {
                    html += '<div class="new-tasks-divider">My tasks</div>';
                }
                customTasks.forEach(task => {
                    html += renderTaskItem(task);
                });
            }
            
            list.innerHTML = html;
        }
        
        function renderTaskItem(task) {
            const doneClass = task.done ? 'done' : '';
            const checkmark = task.done ? '' : '';
            const typeClass = task.type === 'system' ? 'system' : '';
            
            return `
                <div class="new-task-item ${doneClass}" onclick="handleTaskClick('${task.id}')" data-id="${task.id}">
                    <div class="new-task-checkbox">${checkmark}</div>
                    <div class="new-task-content">
                        <div class="new-task-title">${task.title}</div>
                        ${task.meta ? `<div class="new-task-meta">${task.meta}</div>` : ''}
                    </div>
                    <button class="new-task-dismiss" onclick="event.stopPropagation(); dismissTask('${task.id}')" title="Dismiss">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            `;
        }
        
        function handleTaskClick(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            if (task.done) return; // Already done
            
            // If it has an action, execute it
            if (task.action) {
                eval(task.action);
            }
            
            // Mark as done
            task.done = true;
            task.doneAt = Date.now();
            saveTasks();
            renderTasks();
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                renderTasks();
            }, 3000);
        }
        
        function dismissTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
        }
        
        function openAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            modal.classList.add('show');
            document.getElementById('taskModalInput').focus();
        }
        
        function closeAddTaskModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('addTaskModal');
            modal.classList.remove('show');
            document.getElementById('taskModalInput').value = '';
            document.getElementById('taskModalNote').value = '';
        }
        
        function handleTaskModalKeypress(e) {
            if (e.key === 'Enter') {
                addCustomTaskFromModal();
            }
        }
        
        function addCustomTaskFromModal() {
            const titleInput = document.getElementById('taskModalInput');
            const noteInput = document.getElementById('taskModalNote');
            const title = titleInput.value.trim();
            const note = noteInput.value.trim();
            
            if (!title) return;
            
            tasks.push({
                id: 'custom_' + Date.now(),
                title: title,
                meta: note || null,
                type: 'custom',
                done: false,
                createdAt: Date.now()
            });
            
            saveTasks();
            renderTasks();
            closeAddTaskModal();
            showNewToast('Task added');
        }
        
        function saveTasks() {
            // Only save custom tasks
            const customTasks = tasks.filter(t => t.type === 'custom');
            localStorage.setItem('tapinx_tasks', JSON.stringify(customTasks));
        }
        
        function openNewEditProfile() {
            openEditProfileModal();
        }
        
        function formatNewDate(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function formatNewTimeAgo(dateStr) {
            if (!dateStr) return '';
            const now = new Date();
            const d = new Date(dateStr);
            const diffMs = now - d;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }
        
        // Intent selector
        function setIntent(intent, btn) {
            // Update UI
            document.querySelectorAll('.intent-seg-btn').forEach(opt => opt.classList.remove('active'));
            btn.classList.add('active');
            
            // Save to localStorage
            localStorage.setItem('tapinx_user_intent', intent);
            
            // Show confirmation
            showNewToast(`Intent set to ${intent.charAt(0).toUpperCase() + intent.slice(1)}`);
        }
        
        // Load saved intent on page load
        function loadSavedIntent() {
            const savedIntent = localStorage.getItem('tapinx_user_intent') || 'professional';
            const intentBtn = document.querySelector(`.intent-seg-btn[data-intent="${savedIntent}"]`);
            if (intentBtn) {
                document.querySelectorAll('.intent-seg-btn').forEach(opt => opt.classList.remove('active'));
                intentBtn.classList.add('active');
            }
        }
        
        function showNewToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'conn-toast show';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Update sidebar with user data
        function updateNewSidebar() {
            const name = localStorage.getItem('tapinx_user_name') || 'User';
            const photo = localStorage.getItem('tapinx_user_photo');
            
            document.getElementById('newSidebarName').textContent = name;
            document.getElementById('newSidebarAvatarInitial').textContent = name.charAt(0).toUpperCase();
            
            if (photo) {
                document.getElementById('newSidebarAvatarImg').src = photo;
                document.getElementById('newSidebarAvatarImg').style.display = 'block';
                document.getElementById('newSidebarAvatarInitial').style.display = 'none';
            } else {
                document.getElementById('newSidebarAvatarImg').style.display = 'none';
                document.getElementById('newSidebarAvatarInitial').style.display = 'flex';
            }
            
            // Refresh tasks when sidebar updates
            if (typeof initTasks === 'function') {
                initTasks();
            }
        }
        
        // Call when page loads
        if (document.getElementById('dashboardPage')) {
            updateNewSidebar();
            loadSavedIntent();
            initTasks();
        }
    </script>
</body>
</html>
